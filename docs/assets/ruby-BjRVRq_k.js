function d(e){for(var n={},t=0,i=e.length;t<i;++t)n[e[t]]=!0;return n}var k="alias.and.BEGIN.begin.break.case.class.def.defined?.do.else.elsif.END.end.ensure.false.for.if.in.module.next.not.or.redo.rescue.retry.return.self.super.then.true.undef.unless.until.when.while.yield.nil.raise.throw.catch.fail.loop.callcc.caller.lambda.proc.public.protected.private.require.load.require_relative.extend.autoload.__END__.__FILE__.__LINE__.__dir__".split("."),h=d(k),x=d(["def","class","case","for","while","until","module","catch","loop","proc","begin"]),v=d(["end","until"]),m={"[":"]","{":"}","(":")"},z={"]":"[","}":"{",")":"("},o;function s(e,n,t){return t.tokenize.push(e),e(n,t)}function c(e,n){if(e.sol()&&e.match("=begin")&&e.eol())return n.tokenize.push(y),"comment";if(e.eatSpace())return null;var t=e.next(),i;if(t=="`"||t=="'"||t=='"')return s(f(t,"string",t=='"'||t=="`"),e,n);if(t=="/")return b(e)?s(f(t,"string.special",!0),e,n):"operator";if(t=="%"){var a="string",r=!0;e.eat("s")?a="atom":e.eat(/[WQ]/)?a="string":e.eat(/[r]/)?a="string.special":e.eat(/[wxq]/)&&(a="string",r=!1);var u=e.eat(/[^\w\s=]/);return u?(m.propertyIsEnumerable(u)&&(u=m[u]),s(f(u,a,r,!0),e,n)):"operator"}else{if(t=="#")return e.skipToEnd(),"comment";if(t=="<"&&(i=e.match(/^<([-~])[\`\"\']?([a-zA-Z_?]\w*)[\`\"\']?(?:;|$)/)))return s(g(i[2],i[1]),e,n);if(t=="0")return e.eat("x")?e.eatWhile(/[\da-fA-F]/):e.eat("b")?e.eatWhile(/[01]/):e.eatWhile(/[0-7]/),"number";if(/\d/.test(t))return e.match(/^[\d_]*(?:\.[\d_]+)?(?:[eE][+\-]?[\d_]+)?/),"number";if(t=="?"){for(;e.match(/^\\[CM]-/););return e.eat("\\")?e.eatWhile(/\w/):e.next(),"string"}else{if(t==":")return e.eat("'")?s(f("'","atom",!1),e,n):e.eat('"')?s(f('"',"atom",!0),e,n):e.eat(/[\<\>]/)?(e.eat(/[\<\>]/),"atom"):e.eat(/[\+\-\*\/\&\|\:\!]/)?"atom":e.eat(/[a-zA-Z$@_\xa1-\uffff]/)?(e.eatWhile(/[\w$\xa1-\uffff]/),e.eat(/[\?\!\=]/),"atom"):"operator";if(t=="@"&&e.match(/^@?[a-zA-Z_\xa1-\uffff]/))return e.eat("@"),e.eatWhile(/[\w\xa1-\uffff]/),"propertyName";if(t=="$")return e.eat(/[a-zA-Z_]/)?e.eatWhile(/[\w]/):e.eat(/\d/)?e.eat(/\d/):e.next(),"variableName.special";if(/[a-zA-Z_\xa1-\uffff]/.test(t))return e.eatWhile(/[\w\xa1-\uffff]/),e.eat(/[\?\!]/),e.eat(":")?"atom":"variable";if(t=="|"&&(n.varList||n.lastTok=="{"||n.lastTok=="do"))return o="|",null;if(/[\(\)\[\]{}\\;]/.test(t))return o=t,null;if(t=="-"&&e.eat(">"))return"operator";if(/[=+\-\/*:\.^%<>~|]/.test(t)){var l=e.eatWhile(/[=+\-\/*:\.^%<>~|]/);return t=="."&&!l&&(o="."),"operator"}else return null}}}function b(e){for(var n=e.pos,t=0,i,a=!1,r=!1;(i=e.next())!=null;)if(r)r=!1;else{if("[{(".indexOf(i)>-1)t++;else if("]})".indexOf(i)>-1){if(t--,t<0)break}else if(i=="/"&&t==0){a=!0;break}r=i=="\\"}return e.backUp(e.pos-n),a}function p(e){return e||(e=1),function(n,t){if(n.peek()=="}"){if(e==1)return t.tokenize.pop(),t.tokenize[t.tokenize.length-1](n,t);t.tokenize[t.tokenize.length-1]=p(e-1)}else n.peek()=="{"&&(t.tokenize[t.tokenize.length-1]=p(e+1));return c(n,t)}}function _(){var e=!1;return function(n,t){return e?(t.tokenize.pop(),t.tokenize[t.tokenize.length-1](n,t)):(e=!0,c(n,t))}}function f(e,n,t,i){return function(a,r){var u=!1,l;for(r.context.type==="read-quoted-paused"&&(r.context=r.context.prev,a.eat("}"));(l=a.next())!=null;){if(l==e&&(i||!u)){r.tokenize.pop();break}if(t&&l=="#"&&!u){if(a.eat("{")){e=="}"&&(r.context={prev:r.context,type:"read-quoted-paused"}),r.tokenize.push(p());break}else if(/[@\$]/.test(a.peek())){r.tokenize.push(_());break}}u=!u&&l=="\\"}return n}}function g(e,n){return function(t,i){return n&&t.eatSpace(),t.match(e)?i.tokenize.pop():t.skipToEnd(),"string"}}function y(e,n){return e.sol()&&e.match("=end")&&e.eol()&&n.tokenize.pop(),e.skipToEnd(),"comment"}const w={name:"ruby",startState:function(e){return{tokenize:[c],indented:0,context:{type:"top",indented:-e},continuedLine:!1,lastTok:null,varList:!1}},token:function(e,n){o=null,e.sol()&&(n.indented=e.indentation());var t=n.tokenize[n.tokenize.length-1](e,n),i,a=o;if(t=="variable"){var r=e.current();t=n.lastTok=="."?"property":h.propertyIsEnumerable(e.current())?"keyword":/^[A-Z]/.test(r)?"tag":n.lastTok=="def"||n.lastTok=="class"||n.varList?"def":"variable",t=="keyword"&&(a=r,x.propertyIsEnumerable(r)?i="indent":v.propertyIsEnumerable(r)?i="dedent":((r=="if"||r=="unless")&&e.column()==e.indentation()||r=="do"&&n.context.indented<n.indented)&&(i="indent"))}return(o||t&&t!="comment")&&(n.lastTok=a),o=="|"&&(n.varList=!n.varList),i=="indent"||/[\(\[\{]/.test(o)?n.context={prev:n.context,type:o||t,indented:n.indented}:(i=="dedent"||/[\)\]\}]/.test(o))&&n.context.prev&&(n.context=n.context.prev),e.eol()&&(n.continuedLine=o=="\\"||t=="operator"),t},indent:function(e,n,t){if(e.tokenize[e.tokenize.length-1]!=c)return null;var i=n&&n.charAt(0),a=e.context,r=a.type==z[i]||a.type=="keyword"&&/^(?:end|until|else|elsif|when|rescue)\b/.test(n);return a.indented+(r?0:t.unit)+(e.continuedLine?t.unit:0)},languageData:{indentOnInput:/^\s*(?:end|rescue|elsif|else|\})$/,commentTokens:{line:"#"},autocomplete:k}};export{w as t};
