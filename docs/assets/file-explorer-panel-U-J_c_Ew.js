var Se=Object.defineProperty;var Pe=(t,e,i)=>e in t?Se(t,e,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[e]=i;var O=(t,e,i)=>Pe(t,typeof e!="symbol"?e+"":e,i);import{s as U}from"./chunk-DZLz74EQ.js";import{c as _e,d as ce,n as Oe,s as me}from"./jotai-DDOP7CKM.js";import{t as Me}from"./react-BcIddLXZ.js";import{Cn as ae,E as ze,It as Re}from"./cells-B6jS0AIj.js";import"./react-dom-D6bRRS5R.js";import"./zod-U2NFpcFA.js";import{n as re,t as Ae}from"./jsx-runtime-DvsdsEjx.js";import"./_Uint8Array-D5Z9rM2X.js";import"./isSymbol-xTSywenE.js";import"./_arrayMap-DQI2GUNb.js";import"./toString-CBnct2wx.js";import"./toNumber-CTOPJrpu.js";import"./toInteger-Bor4StOs.js";import"./isArrayLikeObject-DKyJYtr8.js";import"./_getTag-CVRrQL_Q.js";import"./_baseIsEqual-BF8660ot.js";import"./merge-BgA7kxZb.js";import"./_baseSlice-B27Cqkm6.js";import"./upperFirst-DOlTOwhh.js";import"./_hasUnicode-CPHpt5EV.js";import"./capitalize-CkrfIDeS.js";import"./_arrayReduce-DDpPg0Qh.js";import"./startCase-DOk4LYuA.js";import"./_baseProperty-CIKnF2iY.js";import"./now-B6JN1xKT.js";import"./debounce-70y9MzDK.js";import"./loader-g7OmFu5O.js";import"./range-CPekNdzi.js";import{d as Ie,u as We}from"./hotkeys-Lbk6RHir.js";import{t as Ee}from"./invariant-DPGusy7Z.js";import{f as He}from"./utils-DnJCRgaX.js";import"./constants-DIZnpo2K.js";import{g as Q}from"./config-BjdJmdrN.js";import"./ErrorBoundary-7JQlouA1.js";import"./useEventListener-C5BS4xuN.js";import{t as ie}from"./cn-C5VTNYKf.js";import{n as qe,t as V}from"./button-nRVaalxL.js";import{bt as Be,rt as Te}from"./dist-BPcMnGQn.js";import"./dist-pZAIwcZo.js";import{c as $e,d as Ve,l as Le,s as Ue,u as Ke}from"./columns-BnRpK2Sj.js";import"./once-Co7xi2Ip.js";import"./capabilities-DdXtcIOa.js";import"./createReducer-80xvKyHq.js";import{n as Ye,r as oe}from"./requests-D3Z6okhb.js";import"./preload-helper-BpItL31i.js";import"./dist-C13bkrcz.js";import"./dist-DZNGKufD.js";import"./dist-DBeOBCHw.js";import"./dist-Ba10OKR3.js";import"./dist-D-CsU-_R.js";import"./dist-ClBFnEcy.js";import"./stex-LEaAsvUb.js";import"./Deferred-zIiWPYX3.js";import"./uuid-Dj56ryH_.js";import"./key-DWQdrH_J.js";import{t as z}from"./use-toast-BiL_AQz9.js";import"./main-CD7jouuS.js";import"./marked.esm-DCf1d_lA.js";import"./connection-DnLUBy9M.js";import"./dist-Q3T6mWQ0.js";import{r as Ze}from"./useTheme-BMknLtnH.js";import{t as L}from"./createLucideIcon-DA8ZBm4D.js";import{t as Ge}from"./arrow-left-CPrWJ5DO.js";import{t as Je}from"./between-horizontal-start-T2r-KWkg.js";import"./type-Cpth3na1.js";import"./check-BUgsJwxM.js";import{_ as Qe}from"./select-DJ0A_oCR.js";import{n as Xe,t as pe}from"./download-C6eeMKzw.js";import{t as et}from"./chevron-right-WxQzIptp.js";import{f as se}from"./maps-C9sj23qe.js";import{n as tt}from"./ansi_up-HmF1kpkv.js";import"./toDate-sQp07c5U.js";import{a as F,c as K,p as at,r as rt,t as it}from"./dropdown-menu-1SGi7wHR.js";import{t as he}from"./copy-CWjpIcfl.js";import{t as fe}from"./download-B7wrfIWv.js";import{t as ot}from"./ellipsis-vertical-SNPN0sGP.js";import{n as xe,r as st,t as nt}from"./types-BT_Kor11.js";import"./file-video-camera-DxgiJa0r.js";import{t as ue}from"./file-plus-2-_KjXiFA5.js";import"./file-text-Cng4_CT2.js";import"./file-CEq0dl8f.js";import"./list-filter-pQvV7yyl.js";import{t as lt}from"./spinner-FaMZ5NTl.js";import"./MarimoErrorOutput-okxire5Y.js";import{t as dt}from"./refresh-ccw-q_wAM7pz.js";import{t as ct}from"./save-D8ZS9wXm.js";import"./input-BPw9p_8N.js";import"./sparkles-CyIU0Xy_.js";import{t as mt}from"./trash-2-DtsdG6Pf.js";import{i as pt,n as ht,t as ft}from"./es-xBjOufca.js";import"./datasource-CzmVjgw7.js";import"./useNonce-DECX9FAH.js";import"./badge-CFi0nvIx.js";import"./Combination-DR4iFoRS.js";import"./dist-Cei_8ikW.js";import{t as M}from"./tooltip-BQKXsEoT.js";import"./useLifecycle-CuZnZLRp.js";import"./menu-items-DOc2hwO2.js";import"./tslib.es6-sakIzgHM.js";import"./dates-CSR6KU2P.js";import"./en-US-CUvYxyLA.js";import"./isValid-BcG0nMKW.js";import"./mode-BdfAcJv1.js";import{o as xt}from"./alert-dialog-DM1h8RhU.js";import"./dialog-CEqVOFHc.js";import"./context-BMtIGcq8.js";import"./useDateFormatter-B6Y_k710.js";import"./useNumberFormatter-DynX1ecE.js";import"./shim-Bk8nzKPV.js";import"./numbers-Hxwz5HuE.js";import{n as R}from"./useEvent-d8iQXgui.js";import"./useDebounce-BDmbJDbT.js";import{n as ge}from"./ImperativeModal-CmOSTULR.js";import"./strings-DSmr2a_p.js";import{n as ut}from"./errors-5BnWGoql.js";import"./vega-loader.browser.module-B-icPEAc.js";import"./precisionRound-BIK1W-Pu.js";import"./defaultLocale-DEOAvdte.js";import"./defaultLocale-Ca1Ci3kv.js";import{t as X}from"./copy-DAqXDCGN.js";import"./copy-icon-5DWltDxB.js";import"./purify.es-D83HMRRD.js";import"./useRunCells-uzADaSkg.js";import"./RenderHTML-CUSvJfTV.js";import"./accordion-BlX0p_kD.js";import"./delay-mount-BvJt70jv.js";import"./emotion-is-prop-valid.esm-BgfwcIY_.js";import"./extends-C-tvimwN.js";import"./prop-types-BdSU55sL.js";import"./objectWithoutPropertiesLoose-DDvr5cHq.js";import{n as ne,t as gt}from"./tree-Cj3QVqlL.js";import"./with-selector-B_mpCvmo.js";import"./alert-CBA2m-3_.js";import{n as je}from"./useAsyncData-CsBCDF11.js";import{n as ye}from"./error-banner-RIuTelB8.js";import"./kbd-CZFOBQmt.js";import{a as jt}from"./renderShortcut-GP8-boTA.js";import{t as yt}from"./LazyAnyLanguageCodeMirror-PGusm5pp.js";import"./popover-BM0PuIZH.js";import"./cell-link-D9FNaXGs.js";import"./es-Bvr8zSR1.js";import{n as bt}from"./blob-COEMBEnt.js";import"./fast-deep-equal-BmkHHxS9.js";import"./command-BqJiTpIC.js";import"./table-mB7CFPse.js";import"./formats-Q84dqqph.js";import"./links-DCKgyNFq.js";import"./state-CMOQfD_O.js";import"./useIframeCapabilities-w06PAeNM.js";import"./tabs-CwHEUPW2.js";import{t as vt}from"./bundle.esm-DY-5mqxG.js";import{o as wt}from"./focus-NSCHuycv.js";import{t as kt}from"./links-CiWl9iWp.js";import{t as Ft}from"./icon-32x32-C8DWp-q1.js";import{t as ee}from"./Inputs-BOv_AsYA.js";var Ct=L("copy-minus",[["line",{x1:"12",x2:"18",y1:"15",y2:"15",key:"1nscbv"}],["rect",{width:"14",height:"14",x:"8",y:"8",rx:"2",ry:"2",key:"17jyea"}],["path",{d:"M4 16c-1.1 0-2-.9-2-2V4c0-1.1.9-2 2-2h10c1.1 0 2 .9 2 2",key:"zix9uf"}]]),be=L("folder-plus",[["path",{d:"M12 10v6",key:"1bos4e"}],["path",{d:"M9 13h6",key:"1uhe8q"}],["path",{d:"M20 20a2 2 0 0 0 2-2V8a2 2 0 0 0-2-2h-7.9a2 2 0 0 1-1.69-.9L9.6 3.9A2 2 0 0 0 7.93 3H4a2 2 0 0 0-2 2v13a2 2 0 0 0 2 2Z",key:"1kt360"}]]),ve=L("list-tree",[["path",{d:"M21 12h-8",key:"1bmf0i"}],["path",{d:"M21 6H8",key:"1pqkrb"}],["path",{d:"M21 18h-8",key:"1tm79t"}],["path",{d:"M3 6v4c0 1.1.9 2 2 2h3",key:"1ywdgy"}],["path",{d:"M3 10v6c0 1.1.9 2 2 2h3",key:"2wc746"}]]),Nt=L("pen-line",[["path",{d:"M13 21h8",key:"1jsn5i"}],["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]),Dt=L("square-play",[["rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",key:"h1oib"}],["path",{d:"M9 9.003a1 1 0 0 1 1.517-.859l4.997 2.997a1 1 0 0 1 0 1.718l-4.997 2.997A1 1 0 0 1 9 14.996z",key:"kmsa83"}]]),St=L("view",[["path",{d:"M21 17v2a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-2",key:"mrq65r"}],["path",{d:"M21 7V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v2",key:"be3xqs"}],["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["path",{d:"M18.944 12.33a1 1 0 0 0 0-.66 7.5 7.5 0 0 0-13.888 0 1 1 0 0 0 0 .66 7.5 7.5 0 0 0 13.888 0",key:"11ak4c"}]]),Pt=U(re(),1),S=U(Me(),1),a=U(Ae(),1),le=new Map;const _t=({file:t,onOpenNotebook:e})=>{let{theme:i}=Ze(),{sendFileDetails:s,sendUpdateFile:r}=oe(),l=_e(He),[n,u]=(0,S.useState)(""),{data:o,isPending:x,error:h,setData:f}=je(async()=>{let j=await s({path:t.path}),v=j.contents||"";return u(le.get(t.path)||v),j},[t.path]),g=async()=>{n!==(o==null?void 0:o.contents)&&await r({path:t.path,contents:n}).then(j=>{j.success&&(f(v=>({...v,contents:n})),u(n))})},p=(0,S.useRef)(n);if(p.current=n,(0,S.useEffect)(()=>()=>{if(!(o!=null&&o.contents))return;let j=p.current;j===o.contents?le.delete(t.path):le.set(t.path,j)},[t.path,o==null?void 0:o.contents]),h)return(0,a.jsx)(ye,{error:h});if(x||!o)return null;let c=o.mimeType||"text/plain",k=c in de;if(!o.contents&&!k)return(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-2 p-6",children:[(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Name"}),(0,a.jsx)("div",{children:o.file.name}),(0,a.jsx)("div",{className:"font-bold text-muted-foreground",children:"Type"}),(0,a.jsx)("div",{children:c})]});let b=(0,a.jsxs)("div",{className:"text-xs text-muted-foreground p-1 flex justify-end gap-2 border-b",children:[t.isMarimoFile&&!Q()&&(0,a.jsx)(M,{content:"Open notebook",children:(0,a.jsx)(ee,{size:"small",onClick:j=>e(j),children:(0,a.jsx)(se,{})})}),(0,a.jsx)(M,{content:"Download",children:(0,a.jsx)(ee,{size:"small",onClick:()=>{if(we(c)){Xe(tt(o.contents,c),o.file.name);return}pe(new Blob([o.contents||n],{type:c}),o.file.name)},children:(0,a.jsx)(fe,{})})}),!we(c)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(M,{content:"Copy contents to clipboard",children:(0,a.jsx)(ee,{size:"small",onClick:async()=>{await X(n)},children:(0,a.jsx)(he,{})})}),(0,a.jsx)(M,{content:jt("global.save"),children:(0,a.jsx)(ee,{size:"small",color:n===o.contents?void 0:"green",onClick:g,disabled:n===o.contents,children:(0,a.jsx)(ct,{})})})]})]});return c.startsWith("image/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Le,{base64:o.contents,mime:c})})]}):c==="text/csv"&&o.contents?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)($e,{contents:o.contents})})]}):c.startsWith("audio/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ue,{base64:o.contents,mime:c})})]}):c.startsWith("video/")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ve,{base64:o.contents,mime:c})})]}):c.startsWith("application/pdf")?(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-hidden flex flex-col",children:(0,a.jsx)(Ke,{base64:o.contents,mime:c})})]}):(0,a.jsxs)(a.Fragment,{children:[b,(0,a.jsx)("div",{className:"flex-1 overflow-auto",children:(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(yt,{theme:i==="dark"?"dark":"light",language:de[c]||de.default,className:"border-b",extensions:[Te.lineWrapping,Be.of([{key:l.getHotkey("global.save").key,stopPropagation:!0,run:()=>n===o.contents?!1:(g(),!0)}])],value:n,onChange:u})})})]})};var we=t=>t?t.startsWith("image/")||t.startsWith("audio/")||t.startsWith("video/")||t.startsWith("application/pdf"):!1,de={"application/javascript":"javascript","text/markdown":"markdown","text/html":"html","text/css":"css","text/x-python":"python","application/json":"json","application/xml":"xml","text/x-yaml":"yaml","text/csv":"markdown","text/plain":"markdown",default:"markdown"},Ot=class{constructor(t){O(this,"delegate",new ne([]));O(this,"rootPath","");O(this,"onChange",Ie.NOOP);O(this,"path",new ae("/"));O(this,"initialize",async t=>{if(this.onChange=t,this.delegate.data.length===0)try{let e=await this.callbacks.listFiles({path:this.rootPath});this.delegate=new ne(e.files),this.rootPath=e.root,this.path=ae.guessDeliminator(e.root)}catch(e){z({title:"Failed",description:ut(e)})}this.onChange(this.delegate.data)});O(this,"refreshAll",async t=>{let e=[this.rootPath,...t.map(s=>{var r;return(r=this.delegate.find(s))==null?void 0:r.data.path})].filter(Boolean),i=await Promise.all(e.map(s=>this.callbacks.listFiles({path:s}).catch(()=>({files:[]}))));for(let[s,r]of e.entries()){let l=i[s];r===this.rootPath?this.delegate=new ne(l.files):this.delegate.update({id:r,changes:{children:l.files}})}this.onChange(this.delegate.data)});O(this,"relativeFromRoot",t=>{let e=this.rootPath.endsWith(this.path.deliminator)?this.rootPath:`${this.rootPath}${this.path.deliminator}`;return t.startsWith(e)?t.slice(e.length):t});O(this,"handleResponse",t=>t.success?t:(z({title:"Failed",description:t.message}),null));this.callbacks=t}async expand(t){let e=this.delegate.find(t);if(!e||!e.data.isDirectory)return!1;if(e.children&&e.children.length>0)return!0;let i=await this.callbacks.listFiles({path:e.data.path});return this.delegate.update({id:t,changes:{children:i.files}}),this.onChange(this.delegate.data),!0}async rename(t,e){let i=this.delegate.find(t);if(!i)return;let s=i.data.path,r=this.path.join(this.path.dirname(s),e);await this.callbacks.renameFileOrFolder({path:s,newPath:r}).then(this.handleResponse),this.delegate.update({id:t,changes:{name:e,path:r}}),this.onChange(this.delegate.data),await this.refreshAll([r])}async move(t,e){var s;let i=e?((s=this.delegate.find(e))==null?void 0:s.data.path)??e:this.rootPath;await Promise.all(t.map(r=>{this.delegate.move({id:r,parentId:e,index:0});let l=this.delegate.find(r);if(!l)return Promise.resolve();let n=this.path.join(i,this.path.basename(l.data.path));return this.delegate.update({id:r,changes:{path:n}}),this.callbacks.renameFileOrFolder({path:l.data.path,newPath:n}).then(this.handleResponse)})),this.onChange(this.delegate.data),await this.refreshAll([i])}async createFile(t,e){var r;let i=e?((r=this.delegate.find(e))==null?void 0:r.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:i,type:"file",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([i]))}async createFolder(t,e){var r;let i=e?((r=this.delegate.find(e))==null?void 0:r.data.path)??e:this.rootPath,s=await this.callbacks.createFileOrFolder({path:i,type:"directory",name:t}).then(this.handleResponse);s!=null&&s.info&&(this.delegate.create({parentId:e,index:0,data:s.info}),this.onChange(this.delegate.data),await this.refreshAll([i]))}async delete(t){let e=this.delegate.find(t);e&&(await this.callbacks.deleteFileOrFolder({path:e.data.path}).then(this.handleResponse),this.delegate.drop({id:t}),this.onChange(this.delegate.data))}};const ke=ce(t=>{let e=t(Ye);return Ee(e,"no requestClientAtom set"),new Ot({listFiles:e.sendListFiles,createFileOrFolder:e.sendCreateFileOrFolder,deleteFileOrFolder:e.sendDeleteFileOrFolder,renameFileOrFolder:e.sendRenameFileOrFolder})}),Mt=ce({});async function zt(){await Oe.get(ke).refreshAll([])}var Rt=1024*1024*100;function Fe(t){let e=(0,Pt.c)(7),i;e[0]===t?i=e[1]:(i=t===void 0?{}:t,e[0]=t,e[1]=i);let s=i,{sendCreateFileOrFolder:r}=oe(),l;e[2]===r?l=e[3]:(l=async u=>{for(let o of u){let x=qt(Ht(o)),h="";x&&(h=ae.guessDeliminator(x).dirname(x));let f=(await bt(o)).split(",")[1];await r({path:h,type:"file",name:o.name,contents:f})}await zt()},e[2]=r,e[3]=l);let n;return e[4]!==s||e[5]!==l?(n={multiple:!0,maxSize:Rt,onError:Et,onDropRejected:At,onDrop:l,...s},e[4]=s,e[5]=l,e[6]=n):n=e[6],ft(n)}function At(t){z({title:"File upload failed",description:(0,a.jsx)("div",{className:"flex flex-col gap-1",children:t.map(It)}),variant:"danger"})}function It(t){return(0,a.jsxs)("div",{children:[t.file.name," (",t.errors.map(Wt).join(", "),")"]},t.file.name)}function Wt(t){return t.message}function Et(t){We.error(t),z({title:"File upload failed",description:t.message,variant:"danger"})}function Ht(t){if(t.webkitRelativePath)return t.webkitRelativePath;if("path"in t&&typeof t.path=="string")return t.path;if("relativePath"in t&&typeof t.relativePath=="string")return t.relativePath}function qt(t){if(t)return t.replace(/^\/+/,"")}var Y=U(re(),1),Ce=S.createContext(null);const Bt=t=>{let e=(0,Y.c)(60),{height:i}=t,s=(0,S.useRef)(null),[r]=me(ke),l;e[0]===Symbol.for("react.memo_cache_sentinel")?(l=[],e[0]=l):l=e[0];let[n,u]=(0,S.useState)(l),[o,x]=(0,S.useState)(null),{openPrompt:h}=ge(),[f,g]=me(Mt),p;e[1]===r?p=e[2]:(p=()=>r.initialize(u),e[1]=r,e[2]=p);let c;e[3]===Symbol.for("react.memo_cache_sentinel")?(c=[],e[3]=c):c=e[3];let{isPending:k,error:b}=je(p,c),j;e[4]!==f||e[5]!==r?(j=()=>{r.refreshAll(Object.keys(f).filter(m=>f[m]))},e[4]=f,e[5]=r,e[6]=j):j=e[6];let v=R(j),P;e[7]!==h||e[8]!==r?(P=async()=>{h({title:"Folder name",onConfirm:async m=>{r.createFolder(m,null)}})},e[7]=h,e[8]=r,e[9]=P):P=e[9];let d=R(P),y;e[10]!==h||e[11]!==r?(y=async()=>{h({title:"File name",onConfirm:async m=>{r.createFile(m,null)}})},e[10]=h,e[11]=r,e[12]=y):y=e[12];let C=R(y),N;e[13]===g?N=e[14]:(N=()=>{var m;(m=s.current)==null||m.closeAll(),g({})},e[13]=g,e[14]=N);let A=R(N);if(k){let m;return e[15]===Symbol.for("react.memo_cache_sentinel")?(m=(0,a.jsx)(lt,{size:"medium",centered:!0}),e[15]=m):m=e[15],m}if(b){let m;return e[16]===b?m=e[17]:(m=(0,a.jsx)(ye,{error:b}),e[16]=b,e[17]=m),m}if(o){let m;e[18]===Symbol.for("react.memo_cache_sentinel")?(m=()=>x(null),e[18]=m):m=e[18];let w;e[19]===Symbol.for("react.memo_cache_sentinel")?(w=(0,a.jsx)(V,{onClick:m,"data-testid":"file-explorer-back-button",variant:"text",size:"xs",className:"mb-0",children:(0,a.jsx)(Ge,{size:16})}),e[19]=w):w=e[19];let D;e[20]===o.name?D=e[21]:(D=(0,a.jsxs)("div",{className:"flex items-center pl-1 pr-3 shrink-0 border-b justify-between",children:[w,(0,a.jsx)("span",{className:"font-bold",children:o.name})]}),e[20]=o.name,e[21]=D);let T;e[22]!==o.path||e[23]!==r?(T=De=>Ne(De,r.relativeFromRoot(o.path)),e[22]=o.path,e[23]=r,e[24]=T):T=e[24];let $;e[25]!==o||e[26]!==T?($=(0,a.jsx)(S.Suspense,{children:(0,a.jsx)(_t,{onOpenNotebook:T,file:o})}),e[25]=o,e[26]=T,e[27]=$):$=e[27];let J;return e[28]!==D||e[29]!==$?(J=(0,a.jsxs)(a.Fragment,{children:[D,$]}),e[28]=D,e[29]=$,e[30]=J):J=e[30],J}let _;e[31]!==A||e[32]!==C||e[33]!==d||e[34]!==v||e[35]!==r?(_=(0,a.jsx)($t,{onRefresh:v,onCreateFile:C,onCreateFolder:d,onCollapseAll:A,tree:r}),e[31]=A,e[32]=C,e[33]=d,e[34]=v,e[35]=r,e[36]=_):_=e[36];let te=i-33,I,W,E;e[37]===r?(I=e[38],W=e[39],E=e[40]):(I=async m=>{let{ids:w}=m;for(let D of w)await r.delete(D)},W=async m=>{let{id:w,name:D}=m;await r.rename(w,D)},E=async m=>{let{dragIds:w,parentId:D}=m;await r.move(w,D)},e[37]=r,e[38]=I,e[39]=W,e[40]=E);let Z;e[41]===Symbol.for("react.memo_cache_sentinel")?(Z=m=>{let w=m[0];w&&(w.data.isDirectory||x(w.data))},e[41]=Z):Z=e[41];let H;e[42]!==f||e[43]!==g||e[44]!==r?(H=async m=>{if(await r.expand(m)){let w=f[m]??!1;g({...f,[m]:!w})}},e[42]=f,e[43]=g,e[44]=r,e[45]=H):H=e[45];let q;e[46]!==n||e[47]!==f||e[48]!==I||e[49]!==W||e[50]!==E||e[51]!==H||e[52]!==te?(q=(0,a.jsx)(gt,{width:"100%",ref:s,height:te,className:"h-full",data:n,initialOpenState:f,openByDefault:!1,renderCursor:Yt,disableDrop:Zt,onDelete:I,onRename:W,onMove:E,onSelect:Z,onToggle:H,padding:15,rowHeight:30,indent:Tt,overscanCount:1e3,disableMultiSelection:!0,children:Ut}),e[46]=n,e[47]=f,e[48]=I,e[49]=W,e[50]=E,e[51]=H,e[52]=te,e[53]=q):q=e[53];let B;e[54]!==q||e[55]!==r?(B=(0,a.jsx)(Ce,{value:r,children:q}),e[54]=q,e[55]=r,e[56]=B):B=e[56];let G;return e[57]!==B||e[58]!==_?(G=(0,a.jsxs)(a.Fragment,{children:[_,B]}),e[57]=B,e[58]=_,e[59]=G):G=e[59],G};var Tt=15,$t=t=>{let e=(0,Y.c)(30),{onRefresh:i,onCreateFile:s,onCreateFolder:r,onCollapseAll:l}=t,n;e[0]===Symbol.for("react.memo_cache_sentinel")?(n={noDrag:!0,noDragEventsBubbling:!0},e[0]=n):n=e[0];let{getRootProps:u,getInputProps:o}=Fe(n),x;e[1]===Symbol.for("react.memo_cache_sentinel")?(x=(0,a.jsx)(ue,{size:16}),e[1]=x):x=e[1];let h;e[2]===s?h=e[3]:(h=(0,a.jsx)(M,{content:"Add file",children:(0,a.jsx)(V,{"data-testid":"file-explorer-add-file-button",onClick:s,variant:"text",size:"xs",children:x})}),e[2]=s,e[3]=h);let f;e[4]===Symbol.for("react.memo_cache_sentinel")?(f=(0,a.jsx)(be,{size:16}),e[4]=f):f=e[4];let g;e[5]===r?g=e[6]:(g=(0,a.jsx)(M,{content:"Add folder",children:(0,a.jsx)(V,{"data-testid":"file-explorer-add-folder-button",onClick:r,variant:"text",size:"xs",children:f})}),e[5]=r,e[6]=g);let p;e[7]===u?p=e[8]:(p=u({}),e[7]=u,e[8]=p);let c,k;e[9]===Symbol.for("react.memo_cache_sentinel")?(c=qe({variant:"text",size:"xs"}),k=(0,a.jsx)(pt,{size:16}),e[9]=c,e[10]=k):(c=e[9],k=e[10]);let b;e[11]===p?b=e[12]:(b=(0,a.jsx)(M,{content:"Upload file",children:(0,a.jsx)("button",{"data-testid":"file-explorer-upload-button",...p,className:c,children:k})}),e[11]=p,e[12]=b);let j;e[13]===o?j=e[14]:(j=o({}),e[13]=o,e[14]=j);let v;e[15]===j?v=e[16]:(v=(0,a.jsx)("input",{...j,type:"file"}),e[15]=j,e[16]=v);let P;e[17]===Symbol.for("react.memo_cache_sentinel")?(P=(0,a.jsx)(dt,{size:16}),e[17]=P):P=e[17];let d;e[18]===i?d=e[19]:(d=(0,a.jsx)(M,{content:"Refresh",children:(0,a.jsx)(V,{"data-testid":"file-explorer-refresh-button",onClick:i,variant:"text",size:"xs",children:P})}),e[18]=i,e[19]=d);let y;e[20]===Symbol.for("react.memo_cache_sentinel")?(y=(0,a.jsx)(Ct,{size:16}),e[20]=y):y=e[20];let C;e[21]===l?C=e[22]:(C=(0,a.jsx)(M,{content:"Collapse all folders",children:(0,a.jsx)(V,{"data-testid":"file-explorer-collapse-button",onClick:l,variant:"text",size:"xs",children:y})}),e[21]=l,e[22]=C);let N;return e[23]!==v||e[24]!==d||e[25]!==C||e[26]!==h||e[27]!==g||e[28]!==b?(N=(0,a.jsxs)("div",{className:"flex items-center justify-end px-2 shrink-0 border-b",children:[h,g,b,v,d,C]}),e[23]=v,e[24]=d,e[25]=C,e[26]=h,e[27]=g,e[28]=b,e[29]=N):N=e[29],N},Vt=t=>{let e=(0,Y.c)(9),{node:i,onOpenMarimoFile:s}=t,r;e[0]===i?r=e[1]:(r=u=>{i.data.isDirectory||(u.stopPropagation(),i.select())},e[0]=i,e[1]=r);let l;e[2]!==i.data.isMarimoFile||e[3]!==s?(l=i.data.isMarimoFile&&!Q()&&(0,a.jsxs)("span",{className:"shrink-0 ml-2 text-sm hidden group-hover:inline hover:underline",onClick:s,children:["open ",(0,a.jsx)(se,{className:"inline ml-1",size:12})]}),e[2]=i.data.isMarimoFile,e[3]=s,e[4]=l):l=e[4];let n;return e[5]!==i.data.name||e[6]!==r||e[7]!==l?(n=(0,a.jsxs)("span",{className:"flex-1 overflow-hidden text-ellipsis",onClick:r,children:[i.data.name,l]}),e[5]=i.data.name,e[6]=r,e[7]=l,e[8]=n):n=e[8],n},Lt=t=>{let e=(0,Y.c)(10),{node:i}=t,s=(0,S.useRef)(null),r,l;e[0]===i.data.name?(r=e[1],l=e[2]):(r=()=>{var x,h;(x=s.current)==null||x.focus(),(h=s.current)==null||h.setSelectionRange(0,i.data.name.lastIndexOf("."))},l=[i.data.name],e[0]=i.data.name,e[1]=r,e[2]=l),(0,S.useEffect)(r,l);let n,u;e[3]===i?(n=e[4],u=e[5]):(n=()=>i.reset(),u=x=>{x.key==="Escape"&&i.reset(),x.key==="Enter"&&i.submit(x.currentTarget.value)},e[3]=i,e[4]=n,e[5]=u);let o;return e[6]!==i.data.name||e[7]!==n||e[8]!==u?(o=(0,a.jsx)("input",{ref:s,className:"flex-1 bg-transparent border border-border text-muted-foreground",defaultValue:i.data.name,onClick:Gt,onBlur:n,onKeyDown:u}),e[6]=i.data.name,e[7]=n,e[8]=u,e[9]=o):o=e[9],o},Ut=({node:t,style:e,dragHandle:i})=>{let{openFile:s,sendCreateFileOrFolder:r,sendFileDetails:l}=oe(),n=t.data.isDirectory?"directory":st(t.data.name),u=nt[n],{openConfirm:o,openPrompt:x}=ge(),{createNewCell:h}=ze(),f=wt(),g=d=>{h({code:d,before:!1,cellId:f??"__end__"})},p=(0,S.use)(Ce),c=async d=>{Ne(d,p?p.relativeFromRoot(t.data.path):t.data.path)},k=async d=>{d.stopPropagation(),d.preventDefault(),o({title:"Delete file",description:`Are you sure you want to delete ${t.data.name}?`,confirmAction:(0,a.jsx)(xt,{onClick:async()=>{await t.tree.delete(t.id)},"aria-label":"Confirm",children:"Delete"})})},b=R(async()=>{t.open(),x({title:"Folder name",onConfirm:async d=>{p==null||p.createFolder(d,t.id)}})}),j=R(async()=>{t.open(),x({title:"File name",onConfirm:async d=>{p==null||p.createFile(d,t.id)}})}),v=R(async()=>{var N;if(!p||t.data.isDirectory)return;let[d,y]=ht(t.data.name),C=`${d}_copy${y}`;try{let A=await l({path:t.data.path}),_=((N=t.parent)==null?void 0:N.data.path)||"";await r({path:_,type:"file",name:C,contents:A.contents?btoa(A.contents):void 0}),await p.refreshAll([_])}catch{z({title:"Failed to duplicate file",description:"Unable to create a duplicate of the file",variant:"danger"})}}),P=()=>{let d={size:14,strokeWidth:1.5,className:"mr-2"};return(0,a.jsxs)(rt,{align:"end",className:"no-print w-[220px]",onClick:y=>y.stopPropagation(),onCloseAutoFocus:y=>y.preventDefault(),children:[!t.data.isDirectory&&(0,a.jsxs)(F,{onSelect:()=>t.select(),children:[(0,a.jsx)(St,{...d}),"Open file"]}),!t.data.isDirectory&&!Q()&&(0,a.jsxs)(F,{onSelect:()=>{s({path:t.data.path})},children:[(0,a.jsx)(se,{...d}),"Open file in external editor"]}),t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(F,{onSelect:()=>j(),children:[(0,a.jsx)(ue,{...d}),"Create file"]}),(0,a.jsxs)(F,{onSelect:()=>b(),children:[(0,a.jsx)(be,{...d}),"Create folder"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(F,{onSelect:()=>t.edit(),children:[(0,a.jsx)(Nt,{...d}),"Rename"]}),!t.data.isDirectory&&(0,a.jsxs)(F,{onSelect:v,children:[(0,a.jsx)(he,{...d}),"Duplicate"]}),(0,a.jsxs)(F,{onSelect:async()=>{await X(t.data.path),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(ve,{...d}),"Copy path"]}),p&&(0,a.jsxs)(F,{onSelect:async()=>{await X(p.relativeFromRoot(t.data.path)),z({title:"Copied to clipboard"})},children:[(0,a.jsx)(ve,{...d}),"Copy relative path"]}),(0,a.jsx)(K,{}),(0,a.jsxs)(F,{onSelect:()=>{let{path:y}=t.data;g(xe[n](y))},children:[(0,a.jsx)(Je,{...d}),"Insert snippet for reading file"]}),(0,a.jsxs)(F,{onSelect:async()=>{z({title:"Copied to clipboard",description:"Code to open the file has been copied to your clipboard. You can also drag and drop this file into the editor"});let{path:y}=t.data;await X(xe[n](y))},children:[(0,a.jsx)(Re,{...d}),"Copy snippet for reading file"]}),t.data.isMarimoFile&&!Q()&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(K,{}),(0,a.jsxs)(F,{onSelect:c,children:[(0,a.jsx)(Dt,{...d}),"Open notebook"]})]}),(0,a.jsx)(K,{}),!t.data.isDirectory&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)(F,{onSelect:async()=>{let y=(await l({path:t.data.path})).contents||"";pe(new Blob([y]),t.data.name)},children:[(0,a.jsx)(fe,{...d}),"Download"]}),(0,a.jsx)(K,{})]}),(0,a.jsxs)(F,{onSelect:k,variant:"danger",children:[(0,a.jsx)(mt,{...d}),"Delete"]})]})};return(0,a.jsxs)("div",{style:e,ref:i,className:ie("flex items-center cursor-pointer ml-1 text-muted-foreground whitespace-nowrap group"),draggable:!0,onClick:d=>{d.stopPropagation(),t.data.isDirectory&&t.toggle()},children:[(0,a.jsx)(Kt,{node:t}),(0,a.jsxs)("span",{className:ie("flex items-center pl-1 py-1 cursor-pointer hover:bg-accent/50 hover:text-accent-foreground rounded-l flex-1 overflow-hidden group",t.willReceiveDrop&&t.data.isDirectory&&"bg-accent/80 hover:bg-accent/80 text-accent-foreground"),children:[t.data.isMarimoFile?(0,a.jsx)("img",{src:Ft,className:"w-5 h-5 shrink-0 mr-2 filter grayscale",alt:"Marimo"}):(0,a.jsx)(u,{className:"w-5 h-5 shrink-0 mr-2",strokeWidth:1.5}),t.isEditing?(0,a.jsx)(Lt,{node:t}):(0,a.jsx)(Vt,{node:t,onOpenMarimoFile:c}),(0,a.jsxs)(it,{modal:!1,children:[(0,a.jsx)(at,{asChild:!0,tabIndex:-1,onClick:d=>d.stopPropagation(),children:(0,a.jsx)(V,{"data-testid":"file-explorer-more-button",variant:"text",tabIndex:-1,size:"xs",className:"mb-0","aria-label":"More options",children:(0,a.jsx)(ot,{strokeWidth:2,className:"w-5 h-5 hidden group-hover:block"})})}),P()]})]})]})},Kt=t=>{let e=(0,Y.c)(3),{node:i}=t;if(!i.data.isDirectory){let r;return e[0]===Symbol.for("react.memo_cache_sentinel")?(r=(0,a.jsx)("span",{className:"w-5 h-5 shrink-0"}),e[0]=r):r=e[0],r}let s;return e[1]===i.isOpen?s=e[2]:(s=i.isOpen?(0,a.jsx)(Qe,{className:"w-5 h-5 shrink-0"}):(0,a.jsx)(et,{className:"w-5 h-5 shrink-0"}),e[1]=i.isOpen,e[2]=s),s};function Ne(t,e){t.stopPropagation(),t.preventDefault(),kt(e)}function Yt(){return null}function Zt(t){let{parentNode:e}=t;return!e.data.isDirectory}function Gt(t){return t.stopPropagation()}var Jt=U(re(),1),Qt=()=>{let t=(0,Jt.c)(20),{ref:e,height:i}=vt(),s=i===void 0?1:i,r;t[0]===Symbol.for("react.memo_cache_sentinel")?(r={noClick:!0,noKeyboard:!0},t[0]=r):r=t[0];let{getRootProps:l,getInputProps:n,isDragActive:u}=Fe(r),o;t[1]===l?o=t[2]:(o=l(),t[1]=l,t[2]=o);let x;t[3]===Symbol.for("react.memo_cache_sentinel")?(x=ie("flex flex-col flex-1 overflow-hidden relative"),t[3]=x):x=t[3];let h;t[4]===n?h=t[5]:(h=n(),t[4]=n,t[5]=h);let f;t[6]===h?f=t[7]:(f=(0,a.jsx)("input",{...h}),t[6]=h,t[7]=f);let g;t[8]===u?g=t[9]:(g=u&&(0,a.jsx)("div",{className:"absolute inset-0 flex items-center uppercase justify-center text-xl font-bold text-primary/90 bg-accent/85 z-10 border-2 border-dashed border-primary/90 rounded-lg pointer-events-none",children:"Drop files here"}),t[8]=u,t[9]=g);let p;t[10]===s?p=t[11]:(p=(0,a.jsx)(Bt,{height:s}),t[10]=s,t[11]=p);let c;t[12]!==e||t[13]!==p?(c=(0,a.jsx)("div",{ref:e,className:"flex flex-col flex-1 overflow-hidden",children:p}),t[12]=e,t[13]=p,t[14]=c):c=t[14];let k;return t[15]!==o||t[16]!==f||t[17]!==g||t[18]!==c?(k=(0,a.jsxs)("div",{...o,className:x,children:[f,g,c]}),t[15]=o,t[16]=f,t[17]=g,t[18]=c,t[19]=k):k=t[19],k};export{Qt as default};
