import{s as q}from"./chunk-DZLz74EQ.js";import{c as C,d as R,l as G}from"./jotai-DDOP7CKM.js";import{t as J}from"./react-BcIddLXZ.js";import{n as B}from"./jsx-runtime-DvsdsEjx.js";import{a as V,c as U,d as K,u as $}from"./hotkeys-Lbk6RHir.js";import{f as Q}from"./utils-DnJCRgaX.js";import{r as D}from"./config-BjdJmdrN.js";import{t as z}from"./useEventListener-C5BS4xuN.js";import{n as T}from"./useEvent-d8iQXgui.js";import{t as N}from"./strings-DSmr2a_p.js";function X(){try{return window.__MARIMO_MOUNT_CONFIG__.version}catch{return $.warn("Failed to get version from mount config"),null}}const Y=R(X()||"latest"),Z=R(!0),ee=R(null);var te={"Content-Type":"application/json"},re=/\{[^{}]+\}/g,oe=class extends Request{constructor(r,t){for(let e in super(r,t),t)e in this||(this[e]=t[e])}};function ne(r){let{baseUrl:t="",fetch:e=globalThis.fetch,querySerializer:n,bodySerializer:o,headers:s,...a}={...r};t.endsWith("/")&&(t=t.substring(0,t.length-1)),s=M(te,s);let i=[];async function c(l,u){let{fetch:p=e,headers:b,params:d={},parseAs:w="json",querySerializer:j,bodySerializer:O=o??ae,...F}=u||{},v=typeof n=="function"?n:H(n);j&&(v=typeof j=="function"?j:H({...typeof n=="object"?n:{},...j}));let m={redirect:"follow",...a,...F,headers:M(s,b,d.header)};m.body&&(m.body=O(m.body)),m.body instanceof FormData&&m.headers.delete("Content-Type");let g=new oe(ie(l,{baseUrl:t,params:d,querySerializer:v}),m),P={baseUrl:t,fetch:p,parseAs:w,querySerializer:v,bodySerializer:O};for(let h of i)if(h&&typeof h=="object"&&typeof h.onRequest=="function"){g.schemaPath=l,g.params=d;let y=await h.onRequest(g,P);if(y){if(!(y instanceof Request))throw Error("Middleware must return new Request() when modifying the request");g=y}}let f=await p(g);for(let h=i.length-1;h>=0;h--){let y=i[h];if(y&&typeof y=="object"&&typeof y.onResponse=="function"){let E=await y.onResponse(f,P);if(E){if(!(E instanceof Response))throw Error("Middleware must return new Response() when modifying the response");f=E}}}if(f.status===204||f.headers.get("Content-Length")==="0")return f.ok?{data:{},response:f}:{error:{},response:f};if(f.ok)return w==="stream"?{data:f.body,response:f}:{data:await f[w](),response:f};let x=await f.text();try{x=JSON.parse(x)}catch{}return{error:x,response:f}}return{async GET(l,u){return c(l,{...u,method:"GET"})},async PUT(l,u){return c(l,{...u,method:"PUT"})},async POST(l,u){return c(l,{...u,method:"POST"})},async DELETE(l,u){return c(l,{...u,method:"DELETE"})},async OPTIONS(l,u){return c(l,{...u,method:"OPTIONS"})},async HEAD(l,u){return c(l,{...u,method:"HEAD"})},async PATCH(l,u){return c(l,{...u,method:"PATCH"})},async TRACE(l,u){return c(l,{...u,method:"TRACE"})},use(...l){for(let u of l)if(u){if(typeof u!="object"||!("onRequest"in u||"onResponse"in u))throw Error("Middleware must be an object with one of `onRequest()` or `onResponse()`");i.push(u)}},eject(...l){for(let u of l){let p=i.indexOf(u);p!==-1&&i.splice(p,1)}}}}function S(r,t,e){if(t==null)return"";if(typeof t=="object")throw Error("Deeply-nested arrays/objects aren\u2019t supported. Provide your own `querySerializer()` to handle these.");return`${r}=${(e==null?void 0:e.allowReserved)===!0?t:encodeURIComponent(t)}`}function k(r,t,e){if(!t||typeof t!="object")return"";let n=[],o={simple:",",label:".",matrix:";"}[e.style]||"&";if(e.style!=="deepObject"&&e.explode===!1){for(let i in t)n.push(i,e.allowReserved===!0?t[i]:encodeURIComponent(t[i]));let a=n.join(",");switch(e.style){case"form":return`${r}=${a}`;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return a}}for(let a in t){let i=e.style==="deepObject"?`${r}[${a}]`:a;n.push(S(i,t[a],e))}let s=n.join(o);return e.style==="label"||e.style==="matrix"?`${o}${s}`:s}function I(r,t,e){if(!Array.isArray(t))return"";if(e.explode===!1){let s={form:",",spaceDelimited:"%20",pipeDelimited:"|"}[e.style]||",",a=(e.allowReserved===!0?t:t.map(i=>encodeURIComponent(i))).join(s);switch(e.style){case"simple":return a;case"label":return`.${a}`;case"matrix":return`;${r}=${a}`;default:return`${r}=${a}`}}let n={simple:",",label:".",matrix:";"}[e.style]||"&",o=[];for(let s of t)e.style==="simple"||e.style==="label"?o.push(e.allowReserved===!0?s:encodeURIComponent(s)):o.push(S(r,s,e));return e.style==="label"||e.style==="matrix"?`${n}${o.join(n)}`:o.join(n)}function H(r){return function(t){let e=[];if(t&&typeof t=="object")for(let n in t){let o=t[n];if(o!=null){if(Array.isArray(o)){e.push(I(n,o,{style:"form",explode:!0,...r==null?void 0:r.array,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}if(typeof o=="object"){e.push(k(n,o,{style:"deepObject",explode:!0,...r==null?void 0:r.object,allowReserved:(r==null?void 0:r.allowReserved)||!1}));continue}e.push(S(n,o,r))}}return e.join("&")}}function se(r,t){let e=r;for(let n of r.match(re)??[]){let o=n.substring(1,n.length-1),s=!1,a="simple";if(o.endsWith("*")&&(s=!0,o=o.substring(0,o.length-1)),o.startsWith(".")?(a="label",o=o.substring(1)):o.startsWith(";")&&(a="matrix",o=o.substring(1)),!t||t[o]===void 0||t[o]===null)continue;let i=t[o];if(Array.isArray(i)){e=e.replace(n,I(o,i,{style:a,explode:s}));continue}if(typeof i=="object"){e=e.replace(n,k(o,i,{style:a,explode:s}));continue}if(a==="matrix"){e=e.replace(n,`;${S(o,i)}`);continue}e=e.replace(n,a==="label"?`.${i}`:i)}return e}function ae(r){return JSON.stringify(r)}function ie(r,t){var o;let e=`${t.baseUrl}${r}`;(o=t.params)!=null&&o.path&&(e=se(e,t.params.path));let n=t.querySerializer(t.params.query??{});return n.startsWith("?")&&(n=n.substring(1)),n&&(e+=`?${n}`),e}function M(...r){let t=new Headers;for(let e of r){if(!e||typeof e!="object")continue;let n=e instanceof Headers?e.entries():Object.entries(e);for(let[o,s]of n)if(s===null)t.delete(o);else if(Array.isArray(s))for(let a of s)t.append(o,a);else s!==void 0&&t.set(o,s)}return t}function le(r){return ne(r)}function W(){let r=D().httpURL;return r.search="",r.hash="",r.toString()}const A={post(r,t,e={}){let n=`${N.withTrailingSlash(e.baseUrl??W())}api${r}`;return fetch(n,{method:"POST",headers:{"Content-Type":"application/json",...A.headers(),...e.headers},body:JSON.stringify(t),signal:e.signal}).then(async o=>{var a;let s=(a=o.headers.get("Content-Type"))==null?void 0:a.startsWith("application/json");if(!o.ok){let i=s?await o.json():await o.text();throw Error(o.statusText,{cause:i})}return s?o.json():o.text()}).catch(o=>{throw $.error(`Error requesting ${n}`,o),o})},get(r,t={}){let e=`${N.withTrailingSlash(t.baseUrl??W())}api${r}`;return fetch(e,{method:"GET",headers:{...A.headers(),...t.headers}}).then(n=>{var o;if(!n.ok)throw Error(n.statusText);return(o=n.headers.get("Content-Type"))!=null&&o.startsWith("application/json")?n.json():null}).catch(n=>{throw $.error(`Error requesting ${e}`,n),n})},headers(){return D().headers()},handleResponse:r=>r.error?Promise.reject(r.error):Promise.resolve(r.data),handleResponseReturnNull:r=>r.error?Promise.reject(r.error):Promise.resolve(null)};function ue(r){let t=le({baseUrl:r.httpURL.toString()});return t.use({onRequest:e=>{let n=r.headers();for(let[o,s]of Object.entries(n))e.headers.set(o,s);return e}}),t}var _=R({});function fe(){return C(_)}function ce(){let r=G(_);return{registerAction:T((t,e)=>{r(n=>({...n,[t]:e}))}),unregisterAction:T(t=>{r(e=>{let{[t]:n,...o}=e;return o})})}}var L=q(B(),1),pe=q(J(),1);function de(r,t){let e=(0,L.c)(13),{registerAction:n,unregisterAction:o}=ce(),s=C(Q),a=t===K.NOOP,i;e[0]===t?i=e[1]:(i=d=>t(d),e[0]=t,e[1]=i);let c=T(i),l;e[2]!==t||e[3]!==s||e[4]!==r?(l=d=>{let w=s.getHotkey(r).key;U(w)(d)&&t(d)!==!1&&(d.preventDefault(),d.stopPropagation())},e[2]=t,e[3]=s,e[4]=r,e[5]=l):l=e[5];let u=T(l);z(document,"keydown",u);let p,b;e[6]!==a||e[7]!==c||e[8]!==n||e[9]!==r||e[10]!==o?(p=()=>{if(!a)return n(r,c),()=>o(r)},b=[c,r,a,n,o],e[6]=a,e[7]=c,e[8]=n,e[9]=r,e[10]=o,e[11]=p,e[12]=b):(p=e[11],b=e[12]),(0,pe.useEffect)(p,b)}function he(r,t){let e=(0,L.c)(2),n;e[0]===t?n=e[1]:(n=o=>{for(let[s,a]of V.entries(t))U(s)(o)&&($.debug("Satisfied",s,o),a(o)!==!1&&(o.preventDefault(),o.stopPropagation()))},e[0]=t,e[1]=n),z(r,"keydown",n)}export{ue as a,Z as c,A as i,he as n,Y as o,fe as r,ee as s,de as t};
