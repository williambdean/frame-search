var zn=Object.defineProperty;var Un=(t,e,a)=>e in t?zn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[e]=a;var P=(t,e,a)=>Un(t,typeof e!="symbol"?e+"":e,a);import{s as ct,t as Vn}from"./chunk-DZLz74EQ.js";import{c as Bn,i as Wn,n as Mr,s as qn,u as jr}from"./jotai-DDOP7CKM.js";import{t as Kn}from"./react-BcIddLXZ.js";import{Ar as Jn,E as Pr,Er as Yn,Gt as Zr,Ht as Gn,Mr as Hn,Mt as Qn,Rr as $r,St as Xn,Wt as ei,Zn as ti,bn as ai,bt as ri,dr as si,ft as ni,mr as ii,o as oi,p as li,rt as Lr,un as Dr,x as at,zr as di}from"./cells-B6jS0AIj.js";import{A as k,D as ui,E as ae,F as T,G as Fr,H as re,I as de,L as Nt,N as ke,O as zr,P as _t,R as G,S as ci,T as Ur,U as pi,V as le,Y as Vr,b as Xt,j as bt,k as mi,w as Ce,x as ea,z as m}from"./zod-U2NFpcFA.js";import{n as Ra,t as hi}from"./jsx-runtime-DvsdsEjx.js";import{o as fi,u as ue}from"./hotkeys-Lbk6RHir.js";import{a as gi}from"./config-BjdJmdrN.js";import{t as Br}from"./cn-C5VTNYKf.js";import{t as $e}from"./button-nRVaalxL.js";import{Gt as ta,Jt as yi,Kt as aa,Rt as vi,Vt as Wr,bt as ra,ot as _i,rt as qr,st as Kr,tt as Ma,yt as bi,zt as xi}from"./dist-BPcMnGQn.js";import{t as wi}from"./createReducer-80xvKyHq.js";import{r as ki,t as Ci}from"./requests-D3Z6okhb.js";import{h as Ii,n as Ti,o as Ei,r as Si}from"./dist-C13bkrcz.js";import{i as Ai}from"./dist-DZNGKufD.js";import{t as Jr}from"./use-toast-BiL_AQz9.js";import{r as Oi}from"./useTheme-BMknLtnH.js";import{t as Yr}from"./createLucideIcon-DA8ZBm4D.js";import{t as Ni}from"./ai-model-dropdown-CtXN4x7s.js";import{h as Ri}from"./select-DJ0A_oCR.js";import{c as Gr,n as Mi,u as ji}from"./ansi_up-HmF1kpkv.js";import{a as Hr,c as Pi,p as Zi,r as $i,t as Li}from"./dropdown-menu-1SGi7wHR.js";import{n as Di}from"./spinner-FaMZ5NTl.js";import{t as Fi}from"./play-BOSd7i5f.js";import{t as zi}from"./sparkles-CyIU0Xy_.js";import{a as Rt,i as xt,o as Mt,r as wt,s as Ui,t as Vi}from"./datasource-CzmVjgw7.js";import{r as Bi}from"./useNonce-DECX9FAH.js";import{t as Wi}from"./tooltip-BQKXsEoT.js";import{t as qi}from"./shim-Bk8nzKPV.js";import{n as Ki}from"./useEvent-d8iQXgui.js";import{n as Ji}from"./errors-5BnWGoql.js";import{n as Yi}from"./useRunCells-uzADaSkg.js";import{n as jt}from"./renderShortcut-GP8-boTA.js";import{i as ja}from"./cell-link-D9FNaXGs.js";import{t as Gi}from"./es-Bvr8zSR1.js";import{n as Hi}from"./dom-DaBOvHqM.js";import{t as Qi}from"./blob-COEMBEnt.js";import{t as Xi}from"./useDeleteCell-BSTJX7_O.js";import{n as eo}from"./add-missing-import-BJfCTctT.js";import{r as to,t as ao}from"./esm-ChGlv0th.js";import{n as ro}from"./icons-j8BJ30se.js";var so=Yr("at-sign",[["circle",{cx:"12",cy:"12",r:"4",key:"4exip2"}],["path",{d:"M16 8v5a3 3 0 0 0 6 0v-1a10 10 0 1 0-4 8",key:"7n84p3"}]]),no=Yr("send-horizontal",[["path",{d:"M3.714 3.048a.498.498 0 0 0-.683.627l2.843 7.627a2 2 0 0 1 0 1.396l-2.842 7.627a.498.498 0 0 0 .682.627l18-8.5a.5.5 0 0 0 0-.904z",key:"117uat"}],["path",{d:"M6 12h16",key:"s4cdu5"}]]),Qr="vercel.ai.error",io=Symbol.for(Qr),Xr,oo=class Mn extends Error{constructor({name:e,message:a,cause:r}){super(a),this[Xr]=!0,this.name=e,this.cause=r}static isInstance(e){return Mn.hasMarker(e,Qr)}static hasMarker(e,a){let r=Symbol.for(a);return typeof e=="object"&&!!e&&r in e&&typeof e[r]=="boolean"&&e[r]===!0}};Xr=io;var rt=oo;function es(t){return t==null?"unknown error":typeof t=="string"?t:t instanceof Error?t.message:JSON.stringify(t)}var ts="AI_InvalidArgumentError",as=`vercel.ai.error.${ts}`,lo=Symbol.for(as),rs,uo=class extends rt{constructor({message:t,cause:e,argument:a}){super({name:ts,message:t,cause:e}),this[rs]=!0,this.argument=a}static isInstance(t){return rt.hasMarker(t,as)}};rs=lo;var ss="AI_JSONParseError",ns=`vercel.ai.error.${ss}`,co=Symbol.for(ns),is,os=class extends rt{constructor({text:t,cause:e}){super({name:ss,message:`JSON parsing failed: Text: ${t}.
Error message: ${es(e)}`,cause:e}),this[is]=!0,this.text=t}static isInstance(t){return rt.hasMarker(t,ns)}};is=co;var ls="AI_TypeValidationError",ds=`vercel.ai.error.${ls}`,po=Symbol.for(ds),us,mo=class Er extends rt{constructor({value:e,cause:a}){super({name:ls,message:`Type validation failed: Value: ${JSON.stringify(e)}.
Error message: ${es(a)}`,cause:a}),this[us]=!0,this.value=e}static isInstance(e){return rt.hasMarker(e,ds)}static wrap({value:e,cause:a}){return Er.isInstance(a)&&a.value===e?a:new Er({value:e,cause:a})}};us=po;var sa=mo,cs=class extends Error{constructor(t,e){super(t),this.name="ParseError",this.type=e.type,this.field=e.field,this.value=e.value,this.line=e.line}};function Pa(t){}function ho(t){if(typeof t=="function")throw TypeError("`callbacks` must be an object, got a function instead. Did you mean `{onEvent: fn}`?");let{onEvent:e=Pa,onError:a=Pa,onRetry:r=Pa,onComment:s}=t,n="",i=!0,o,l="",d="";function u(f){let p=i?f.replace(/^\xEF\xBB\xBF/,""):f,[h,b]=fo(`${n}${p}`);for(let C of h)c(C);n=b,i=!1}function c(f){if(f===""){v();return}if(f.startsWith(":")){s&&s(f.slice(f.startsWith(": ")?2:1));return}let p=f.indexOf(":");if(p!==-1){let h=f.slice(0,p),b=f[p+1]===" "?2:1;g(h,f.slice(p+b),f);return}g(f,"",f)}function g(f,p,h){switch(f){case"event":d=p;break;case"data":l=`${l}${p}
`;break;case"id":o=p.includes("\0")?void 0:p;break;case"retry":/^\d+$/.test(p)?r(parseInt(p,10)):a(new cs(`Invalid \`retry\` value: "${p}"`,{type:"invalid-retry",value:p,line:h}));break;default:a(new cs(`Unknown field "${f.length>20?`${f.slice(0,20)}\u2026`:f}"`,{type:"unknown-field",field:f,value:p,line:h}));break}}function v(){l.length>0&&e({id:o,event:d||void 0,data:l.endsWith(`
`)?l.slice(0,-1):l}),o=void 0,l="",d=""}function _(f={}){n&&f.consume&&c(n),i=!0,o=void 0,l="",d="",n=""}return{feed:u,reset:_}}function fo(t){let e=[],a="",r=0;for(;r<t.length;){let s=t.indexOf("\r",r),n=t.indexOf(`
`,r),i=-1;if(s!==-1&&n!==-1?i=Math.min(s,n):s===-1?n!==-1&&(i=n):i=s===t.length-1?-1:s,i===-1){a=t.slice(r);break}else{let o=t.slice(r,i);e.push(o),r=i+1,t[r-1]==="\r"&&t[r]===`
`&&r++}}return[e,a]}var go=class extends TransformStream{constructor({onError:t,onRetry:e,onComment:a}={}){let r;super({start(s){r=ho({onEvent:n=>{s.enqueue(n)},onError(n){t==="terminate"?s.error(n):typeof t=="function"&&t(n)},onRetry:e,onComment:a})},transform(s){r.feed(s)}})}},U;(function(t){t.assertEqual=s=>{};function e(s){}t.assertIs=e;function a(s){throw Error()}t.assertNever=a,t.arrayToEnum=s=>{let n={};for(let i of s)n[i]=i;return n},t.getValidEnumValues=s=>{let n=t.objectKeys(s).filter(o=>typeof s[s[o]]!="number"),i={};for(let o of n)i[o]=s[o];return t.objectValues(i)},t.objectValues=s=>t.objectKeys(s).map(function(n){return s[n]}),t.objectKeys=typeof Object.keys=="function"?s=>Object.keys(s):s=>{let n=[];for(let i in s)Object.prototype.hasOwnProperty.call(s,i)&&n.push(i);return n},t.find=(s,n)=>{for(let i of s)if(n(i))return i},t.isInteger=typeof Number.isInteger=="function"?s=>Number.isInteger(s):s=>typeof s=="number"&&Number.isFinite(s)&&Math.floor(s)===s;function r(s,n=" | "){return s.map(i=>typeof i=="string"?`'${i}'`:i).join(n)}t.joinValues=r,t.jsonStringifyReplacer=(s,n)=>typeof n=="bigint"?n.toString():n})(U||(U={}));var yo;(function(t){t.mergeShapes=(e,a)=>({...e,...a})})(yo||(yo={}));const I=U.arrayToEnum(["string","nan","number","integer","float","boolean","date","bigint","symbol","function","undefined","null","array","object","unknown","promise","void","never","map","set"]),st=t=>{switch(typeof t){case"undefined":return I.undefined;case"string":return I.string;case"number":return Number.isNaN(t)?I.nan:I.number;case"boolean":return I.boolean;case"function":return I.function;case"bigint":return I.bigint;case"symbol":return I.symbol;case"object":return Array.isArray(t)?I.array:t===null?I.null:t.then&&typeof t.then=="function"&&t.catch&&typeof t.catch=="function"?I.promise:typeof Map<"u"&&t instanceof Map?I.map:typeof Set<"u"&&t instanceof Set?I.set:typeof Date<"u"&&t instanceof Date?I.date:I.object;default:return I.unknown}},y=U.arrayToEnum(["invalid_type","invalid_literal","custom","invalid_union","invalid_union_discriminator","invalid_enum_value","unrecognized_keys","invalid_arguments","invalid_return_type","invalid_date","invalid_string","too_small","too_big","invalid_intersection_types","not_multiple_of","not_finite"]);var Le=class jn extends Error{get errors(){return this.issues}constructor(e){super(),this.issues=[],this.addIssue=r=>{this.issues=[...this.issues,r]},this.addIssues=(r=[])=>{this.issues=[...this.issues,...r]};let a=new.target.prototype;Object.setPrototypeOf?Object.setPrototypeOf(this,a):this.__proto__=a,this.name="ZodError",this.issues=e}format(e){let a=e||function(n){return n.message},r={_errors:[]},s=n=>{for(let i of n.issues)if(i.code==="invalid_union")i.unionErrors.map(s);else if(i.code==="invalid_return_type")s(i.returnTypeError);else if(i.code==="invalid_arguments")s(i.argumentsError);else if(i.path.length===0)r._errors.push(a(i));else{let o=r,l=0;for(;l<i.path.length;){let d=i.path[l];l===i.path.length-1?(o[d]=o[d]||{_errors:[]},o[d]._errors.push(a(i))):o[d]=o[d]||{_errors:[]},o=o[d],l++}}};return s(this),r}static assert(e){if(!(e instanceof jn))throw Error(`Not a ZodError: ${e}`)}toString(){return this.message}get message(){return JSON.stringify(this.issues,U.jsonStringifyReplacer,2)}get isEmpty(){return this.issues.length===0}flatten(e=a=>a.message){let a={},r=[];for(let s of this.issues)if(s.path.length>0){let n=s.path[0];a[n]=a[n]||[],a[n].push(e(s))}else r.push(e(s));return{formErrors:r,fieldErrors:a}}get formErrors(){return this.flatten()}};Le.create=t=>new Le(t);var Pt=(t,e)=>{let a;switch(t.code){case y.invalid_type:a=t.received===I.undefined?"Required":`Expected ${t.expected}, received ${t.received}`;break;case y.invalid_literal:a=`Invalid literal value, expected ${JSON.stringify(t.expected,U.jsonStringifyReplacer)}`;break;case y.unrecognized_keys:a=`Unrecognized key(s) in object: ${U.joinValues(t.keys,", ")}`;break;case y.invalid_union:a="Invalid input";break;case y.invalid_union_discriminator:a=`Invalid discriminator value. Expected ${U.joinValues(t.options)}`;break;case y.invalid_enum_value:a=`Invalid enum value. Expected ${U.joinValues(t.options)}, received '${t.received}'`;break;case y.invalid_arguments:a="Invalid function arguments";break;case y.invalid_return_type:a="Invalid function return type";break;case y.invalid_date:a="Invalid date";break;case y.invalid_string:typeof t.validation=="object"?"includes"in t.validation?(a=`Invalid input: must include "${t.validation.includes}"`,typeof t.validation.position=="number"&&(a=`${a} at one or more positions greater than or equal to ${t.validation.position}`)):"startsWith"in t.validation?a=`Invalid input: must start with "${t.validation.startsWith}"`:"endsWith"in t.validation?a=`Invalid input: must end with "${t.validation.endsWith}"`:U.assertNever(t.validation):a=t.validation==="regex"?"Invalid":`Invalid ${t.validation}`;break;case y.too_small:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at least":"more than"} ${t.minimum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at least":"over"} ${t.minimum} character(s)`:t.type==="number"||t.type==="bigint"?`Number must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${t.minimum}`:t.type==="date"?`Date must be ${t.exact?"exactly equal to ":t.inclusive?"greater than or equal to ":"greater than "}${new Date(Number(t.minimum))}`:"Invalid input";break;case y.too_big:a=t.type==="array"?`Array must contain ${t.exact?"exactly":t.inclusive?"at most":"less than"} ${t.maximum} element(s)`:t.type==="string"?`String must contain ${t.exact?"exactly":t.inclusive?"at most":"under"} ${t.maximum} character(s)`:t.type==="number"?`Number must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="bigint"?`BigInt must be ${t.exact?"exactly":t.inclusive?"less than or equal to":"less than"} ${t.maximum}`:t.type==="date"?`Date must be ${t.exact?"exactly":t.inclusive?"smaller than or equal to":"smaller than"} ${new Date(Number(t.maximum))}`:"Invalid input";break;case y.custom:a="Invalid input";break;case y.invalid_intersection_types:a="Intersection results could not be merged";break;case y.not_multiple_of:a=`Number must be a multiple of ${t.multipleOf}`;break;case y.not_finite:a="Number must be finite";break;default:a=e.defaultError,U.assertNever(t)}return{message:a}},vo=Pt;function Za(){return vo}const $a=t=>{let{data:e,path:a,errorMaps:r,issueData:s}=t,n=[...a,...s.path||[]],i={...s,path:n};if(s.message!==void 0)return{...s,path:n,message:s.message};let o="",l=r.filter(d=>!!d).slice().reverse();for(let d of l)o=d(i,{data:e,defaultError:o}).message;return{...s,path:n,message:o}};function w(t,e){let a=Za(),r=$a({issueData:e,data:t.data,path:t.path,errorMaps:[t.common.contextualErrorMap,t.schemaErrorMap,a,a===Pt?void 0:Pt].filter(s=>!!s)});t.common.issues.push(r)}var be=class Pn{constructor(){this.value="valid"}dirty(){this.value==="valid"&&(this.value="dirty")}abort(){this.value!=="aborted"&&(this.value="aborted")}static mergeArray(e,a){let r=[];for(let s of a){if(s.status==="aborted")return N;s.status==="dirty"&&e.dirty(),r.push(s.value)}return{status:e.value,value:r}}static async mergeObjectAsync(e,a){let r=[];for(let s of a){let n=await s.key,i=await s.value;r.push({key:n,value:i})}return Pn.mergeObjectSync(e,r)}static mergeObjectSync(e,a){let r={};for(let s of a){let{key:n,value:i}=s;if(n.status==="aborted"||i.status==="aborted")return N;n.status==="dirty"&&e.dirty(),i.status==="dirty"&&e.dirty(),n.value!=="__proto__"&&(i.value!==void 0||s.alwaysSet)&&(r[n.value]=i.value)}return{status:e.value,value:r}}};const N=Object.freeze({status:"aborted"}),La=t=>({status:"dirty",value:t}),ye=t=>({status:"valid",value:t}),ps=t=>t.status==="aborted",ms=t=>t.status==="dirty",kt=t=>t.status==="valid",na=t=>typeof Promise<"u"&&t instanceof Promise;var E;(function(t){t.errToObj=e=>typeof e=="string"?{message:e}:e||{},t.toString=e=>typeof e=="string"?e:e==null?void 0:e.message})(E||(E={}));var De=class{constructor(t,e,a,r){this._cachedPath=[],this.parent=t,this.data=e,this._path=a,this._key=r}get path(){return this._cachedPath.length||(Array.isArray(this._key)?this._cachedPath.push(...this._path,...this._key):this._cachedPath.push(...this._path,this._key)),this._cachedPath}},hs=(t,e)=>{if(kt(e))return{success:!0,data:e.value};if(!t.common.issues.length)throw Error("Validation failed but no issues detected.");return{success:!1,get error(){return this._error||(this._error=new Le(t.common.issues)),this._error}}};function j(t){if(!t)return{};let{errorMap:e,invalid_type_error:a,required_error:r,description:s}=t;if(e&&(a||r))throw Error(`Can't use "invalid_type_error" or "required_error" in conjunction with custom error map.`);return e?{errorMap:e,description:s}:{errorMap:(n,i)=>{let{message:o}=t;return n.code==="invalid_enum_value"?{message:o??i.defaultError}:i.data===void 0?{message:o??r??i.defaultError}:n.code==="invalid_type"?{message:o??a??i.defaultError}:{message:i.defaultError}},description:s}}var Z=class{get description(){return this._def.description}_getType(t){return st(t.data)}_getOrReturnCtx(t,e){return e||{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}_processInputParams(t){return{status:new be,ctx:{common:t.parent.common,data:t.data,parsedType:st(t.data),schemaErrorMap:this._def.errorMap,path:t.path,parent:t.parent}}}_parseSync(t){let e=this._parse(t);if(na(e))throw Error("Synchronous parse encountered promise.");return e}_parseAsync(t){let e=this._parse(t);return Promise.resolve(e)}parse(t,e){let a=this.safeParse(t,e);if(a.success)return a.data;throw a.error}safeParse(t,e){let a={common:{issues:[],async:(e==null?void 0:e.async)??!1,contextualErrorMap:e==null?void 0:e.errorMap},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)};return hs(a,this._parseSync({data:t,path:a.path,parent:a}))}"~validate"(t){var a,r;let e={common:{issues:[],async:!!this["~standard"].async},path:[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)};if(!this["~standard"].async)try{let s=this._parseSync({data:t,path:[],parent:e});return kt(s)?{value:s.value}:{issues:e.common.issues}}catch(s){(r=(a=s==null?void 0:s.message)==null?void 0:a.toLowerCase())!=null&&r.includes("encountered")&&(this["~standard"].async=!0),e.common={issues:[],async:!0}}return this._parseAsync({data:t,path:[],parent:e}).then(s=>kt(s)?{value:s.value}:{issues:e.common.issues})}async parseAsync(t,e){let a=await this.safeParseAsync(t,e);if(a.success)return a.data;throw a.error}async safeParseAsync(t,e){let a={common:{issues:[],contextualErrorMap:e==null?void 0:e.errorMap,async:!0},path:(e==null?void 0:e.path)||[],schemaErrorMap:this._def.errorMap,parent:null,data:t,parsedType:st(t)},r=this._parse({data:t,path:a.path,parent:a});return hs(a,await(na(r)?r:Promise.resolve(r)))}refine(t,e){let a=r=>typeof e=="string"||e===void 0?{message:e}:typeof e=="function"?e(r):e;return this._refinement((r,s)=>{let n=t(r),i=()=>s.addIssue({code:y.custom,...a(r)});return typeof Promise<"u"&&n instanceof Promise?n.then(o=>o?!0:(i(),!1)):n?!0:(i(),!1)})}refinement(t,e){return this._refinement((a,r)=>t(a)?!0:(r.addIssue(typeof e=="function"?e(a,r):e),!1))}_refinement(t){return new Ke({schema:this,typeName:x.ZodEffects,effect:{type:"refinement",refinement:t}})}superRefine(t){return this._refinement(t)}constructor(t){this.spa=this.safeParseAsync,this._def=t,this.parse=this.parse.bind(this),this.safeParse=this.safeParse.bind(this),this.parseAsync=this.parseAsync.bind(this),this.safeParseAsync=this.safeParseAsync.bind(this),this.spa=this.spa.bind(this),this.refine=this.refine.bind(this),this.refinement=this.refinement.bind(this),this.superRefine=this.superRefine.bind(this),this.optional=this.optional.bind(this),this.nullable=this.nullable.bind(this),this.nullish=this.nullish.bind(this),this.array=this.array.bind(this),this.promise=this.promise.bind(this),this.or=this.or.bind(this),this.and=this.and.bind(this),this.transform=this.transform.bind(this),this.brand=this.brand.bind(this),this.default=this.default.bind(this),this.catch=this.catch.bind(this),this.describe=this.describe.bind(this),this.pipe=this.pipe.bind(this),this.readonly=this.readonly.bind(this),this.isNullable=this.isNullable.bind(this),this.isOptional=this.isOptional.bind(this),this["~standard"]={version:1,vendor:"zod",validate:e=>this["~validate"](e)}}optional(){return Je.create(this,this._def)}nullable(){return mt.create(this,this._def)}nullish(){return this.nullable().optional()}array(){return It.create(this)}promise(){return Zt.create(this,this._def)}or(t){return da.create([this,t],this._def)}and(t){return ua.create(this,t,this._def)}transform(t){return new Ke({...j(this._def),schema:this,typeName:x.ZodEffects,effect:{type:"transform",transform:t}})}default(t){let e=typeof t=="function"?t:()=>t;return new fa({...j(this._def),innerType:this,defaultValue:e,typeName:x.ZodDefault})}brand(){return new _s({typeName:x.ZodBranded,type:this,...j(this._def)})}catch(t){let e=typeof t=="function"?t:()=>t;return new ga({...j(this._def),innerType:this,catchValue:e,typeName:x.ZodCatch})}describe(t){let e=this.constructor;return new e({...this._def,description:t})}pipe(t){return bs.create(this,t)}readonly(){return ya.create(this)}isOptional(){return this.safeParse(void 0).success}isNullable(){return this.safeParse(null).success}},_o=/^c[^\s-]{8,}$/i,bo=/^[0-9a-z]+$/,xo=/^[0-9A-HJKMNP-TV-Z]{26}$/i,wo=/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/i,ko=/^[a-z0-9_-]{21}$/i,Co=/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/,Io=/^[-+]?P(?!$)(?:(?:[-+]?\d+Y)|(?:[-+]?\d+[.,]\d+Y$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:(?:[-+]?\d+W)|(?:[-+]?\d+[.,]\d+W$))?(?:(?:[-+]?\d+D)|(?:[-+]?\d+[.,]\d+D$))?(?:T(?=[\d+-])(?:(?:[-+]?\d+H)|(?:[-+]?\d+[.,]\d+H$))?(?:(?:[-+]?\d+M)|(?:[-+]?\d+[.,]\d+M$))?(?:[-+]?\d+(?:[.,]\d+)?S)?)??$/,To=/^(?!\.)(?!.*\.\.)([A-Z0-9_'+\-\.]*)[A-Z0-9_+-]@([A-Z0-9][A-Z0-9\-]*\.)+[A-Z]{2,}$/i,Eo="^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$",fs,So=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,Ao=/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,Oo=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))$/,No=/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,Ro=/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,Mo=/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,gs="((\\d\\d[2468][048]|\\d\\d[13579][26]|\\d\\d0[48]|[02468][048]00|[13579][26]00)-02-29|\\d{4}-((0[13578]|1[02])-(0[1-9]|[12]\\d|3[01])|(0[469]|11)-(0[1-9]|[12]\\d|30)|(02)-(0[1-9]|1\\d|2[0-8])))",jo=RegExp(`^${gs}$`);function ys(t){let e="[0-5]\\d";t.precision?e=`${e}\\.\\d{${t.precision}}`:t.precision??(e=`${e}(\\.\\d+)?`);let a=t.precision?"+":"?";return`([01]\\d|2[0-3]):[0-5]\\d(:${e})${a}`}function Po(t){return RegExp(`^${ys(t)}$`)}function Zo(t){let e=`${gs}T${ys(t)}`,a=[];return a.push(t.local?"Z?":"Z"),t.offset&&a.push("([+-]\\d{2}:?\\d{2})"),e=`${e}(${a.join("|")})`,RegExp(`^${e}$`)}function $o(t,e){return!!((e==="v4"||!e)&&So.test(t)||(e==="v6"||!e)&&Oo.test(t))}function Lo(t,e){if(!Co.test(t))return!1;try{let[a]=t.split(".");if(!a)return!1;let r=a.replace(/-/g,"+").replace(/_/g,"/").padEnd(a.length+(4-a.length%4)%4,"="),s=JSON.parse(atob(r));return!(typeof s!="object"||!s||"typ"in s&&(s==null?void 0:s.typ)!=="JWT"||!s.alg||e&&s.alg!==e)}catch{return!1}}function Do(t,e){return!!((e==="v4"||!e)&&Ao.test(t)||(e==="v6"||!e)&&No.test(t))}var ia=class Yt extends Z{_parse(e){if(this._def.coerce&&(e.data=String(e.data)),this._getType(e)!==I.string){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:I.string,received:s.parsedType}),N}let a=new be,r;for(let s of this._def.checks)if(s.kind==="min")e.data.length<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="max")e.data.length>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!1,message:s.message}),a.dirty());else if(s.kind==="length"){let n=e.data.length>s.value,i=e.data.length<s.value;(n||i)&&(r=this._getOrReturnCtx(e,r),n?w(r,{code:y.too_big,maximum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}):i&&w(r,{code:y.too_small,minimum:s.value,type:"string",inclusive:!0,exact:!0,message:s.message}),a.dirty())}else if(s.kind==="email")To.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"email",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="emoji")fs||(fs=new RegExp(Eo,"u")),fs.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"emoji",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="uuid")wo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"uuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="nanoid")ko.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"nanoid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid")_o.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="cuid2")bo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cuid2",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="ulid")xo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ulid",code:y.invalid_string,message:s.message}),a.dirty());else if(s.kind==="url")try{new URL(e.data)}catch{r=this._getOrReturnCtx(e,r),w(r,{validation:"url",code:y.invalid_string,message:s.message}),a.dirty()}else s.kind==="regex"?(s.regex.lastIndex=0,s.regex.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"regex",code:y.invalid_string,message:s.message}),a.dirty())):s.kind==="trim"?e.data=e.data.trim():s.kind==="includes"?e.data.includes(s.value,s.position)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{includes:s.value,position:s.position},message:s.message}),a.dirty()):s.kind==="toLowerCase"?e.data=e.data.toLowerCase():s.kind==="toUpperCase"?e.data=e.data.toUpperCase():s.kind==="startsWith"?e.data.startsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{startsWith:s.value},message:s.message}),a.dirty()):s.kind==="endsWith"?e.data.endsWith(s.value)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:{endsWith:s.value},message:s.message}),a.dirty()):s.kind==="datetime"?Zo(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"datetime",message:s.message}),a.dirty()):s.kind==="date"?jo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"date",message:s.message}),a.dirty()):s.kind==="time"?Po(s).test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{code:y.invalid_string,validation:"time",message:s.message}),a.dirty()):s.kind==="duration"?Io.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"duration",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="ip"?$o(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"ip",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="jwt"?Lo(e.data,s.alg)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"jwt",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="cidr"?Do(e.data,s.version)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"cidr",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64"?Ro.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64",code:y.invalid_string,message:s.message}),a.dirty()):s.kind==="base64url"?Mo.test(e.data)||(r=this._getOrReturnCtx(e,r),w(r,{validation:"base64url",code:y.invalid_string,message:s.message}),a.dirty()):U.assertNever(s);return{status:a.value,value:e.data}}_regex(e,a,r){return this.refinement(s=>e.test(s),{validation:a,code:y.invalid_string,...E.errToObj(r)})}_addCheck(e){return new Yt({...this._def,checks:[...this._def.checks,e]})}email(e){return this._addCheck({kind:"email",...E.errToObj(e)})}url(e){return this._addCheck({kind:"url",...E.errToObj(e)})}emoji(e){return this._addCheck({kind:"emoji",...E.errToObj(e)})}uuid(e){return this._addCheck({kind:"uuid",...E.errToObj(e)})}nanoid(e){return this._addCheck({kind:"nanoid",...E.errToObj(e)})}cuid(e){return this._addCheck({kind:"cuid",...E.errToObj(e)})}cuid2(e){return this._addCheck({kind:"cuid2",...E.errToObj(e)})}ulid(e){return this._addCheck({kind:"ulid",...E.errToObj(e)})}base64(e){return this._addCheck({kind:"base64",...E.errToObj(e)})}base64url(e){return this._addCheck({kind:"base64url",...E.errToObj(e)})}jwt(e){return this._addCheck({kind:"jwt",...E.errToObj(e)})}ip(e){return this._addCheck({kind:"ip",...E.errToObj(e)})}cidr(e){return this._addCheck({kind:"cidr",...E.errToObj(e)})}datetime(e){return typeof e=="string"?this._addCheck({kind:"datetime",precision:null,offset:!1,local:!1,message:e}):this._addCheck({kind:"datetime",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,offset:(e==null?void 0:e.offset)??!1,local:(e==null?void 0:e.local)??!1,...E.errToObj(e==null?void 0:e.message)})}date(e){return this._addCheck({kind:"date",message:e})}time(e){return typeof e=="string"?this._addCheck({kind:"time",precision:null,message:e}):this._addCheck({kind:"time",precision:(e==null?void 0:e.precision)===void 0?null:e==null?void 0:e.precision,...E.errToObj(e==null?void 0:e.message)})}duration(e){return this._addCheck({kind:"duration",...E.errToObj(e)})}regex(e,a){return this._addCheck({kind:"regex",regex:e,...E.errToObj(a)})}includes(e,a){return this._addCheck({kind:"includes",value:e,position:a==null?void 0:a.position,...E.errToObj(a==null?void 0:a.message)})}startsWith(e,a){return this._addCheck({kind:"startsWith",value:e,...E.errToObj(a)})}endsWith(e,a){return this._addCheck({kind:"endsWith",value:e,...E.errToObj(a)})}min(e,a){return this._addCheck({kind:"min",value:e,...E.errToObj(a)})}max(e,a){return this._addCheck({kind:"max",value:e,...E.errToObj(a)})}length(e,a){return this._addCheck({kind:"length",value:e,...E.errToObj(a)})}nonempty(e){return this.min(1,E.errToObj(e))}trim(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"trim"}]})}toLowerCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toLowerCase"}]})}toUpperCase(){return new Yt({...this._def,checks:[...this._def.checks,{kind:"toUpperCase"}]})}get isDatetime(){return!!this._def.checks.find(e=>e.kind==="datetime")}get isDate(){return!!this._def.checks.find(e=>e.kind==="date")}get isTime(){return!!this._def.checks.find(e=>e.kind==="time")}get isDuration(){return!!this._def.checks.find(e=>e.kind==="duration")}get isEmail(){return!!this._def.checks.find(e=>e.kind==="email")}get isURL(){return!!this._def.checks.find(e=>e.kind==="url")}get isEmoji(){return!!this._def.checks.find(e=>e.kind==="emoji")}get isUUID(){return!!this._def.checks.find(e=>e.kind==="uuid")}get isNANOID(){return!!this._def.checks.find(e=>e.kind==="nanoid")}get isCUID(){return!!this._def.checks.find(e=>e.kind==="cuid")}get isCUID2(){return!!this._def.checks.find(e=>e.kind==="cuid2")}get isULID(){return!!this._def.checks.find(e=>e.kind==="ulid")}get isIP(){return!!this._def.checks.find(e=>e.kind==="ip")}get isCIDR(){return!!this._def.checks.find(e=>e.kind==="cidr")}get isBase64(){return!!this._def.checks.find(e=>e.kind==="base64")}get isBase64url(){return!!this._def.checks.find(e=>e.kind==="base64url")}get minLength(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxLength(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};ia.create=t=>new ia({checks:[],typeName:x.ZodString,coerce:(t==null?void 0:t.coerce)??!1,...j(t)});function Fo(t,e){let a=(t.toString().split(".")[1]||"").length,r=(e.toString().split(".")[1]||"").length,s=a>r?a:r;return Number.parseInt(t.toFixed(s).replace(".",""))%Number.parseInt(e.toFixed(s).replace(".",""))/10**s}var Da=class Sr extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte,this.step=this.multipleOf}_parse(e){if(this._def.coerce&&(e.data=Number(e.data)),this._getType(e)!==I.number){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:I.number,received:s.parsedType}),N}let a,r=new be;for(let s of this._def.checks)s.kind==="int"?U.isInteger(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:y.invalid_type,expected:"integer",received:"float",message:s.message}),r.dirty()):s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_small,minimum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_big,maximum:s.value,type:"number",inclusive:s.inclusive,exact:!1,message:s.message}),r.dirty()):s.kind==="multipleOf"?Fo(e.data,s.value)!==0&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):s.kind==="finite"?Number.isFinite(e.data)||(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_finite,message:s.message}),r.dirty()):U.assertNever(s);return{status:r.value,value:e.data}}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new Sr({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new Sr({...this._def,checks:[...this._def.checks,e]})}int(e){return this._addCheck({kind:"int",message:E.toString(e)})}positive(e){return this._addCheck({kind:"min",value:0,inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:0,inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:0,inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:0,inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}finite(e){return this._addCheck({kind:"finite",message:E.toString(e)})}safe(e){return this._addCheck({kind:"min",inclusive:!0,value:-(2**53-1),message:E.toString(e)})._addCheck({kind:"max",inclusive:!0,value:2**53-1,message:E.toString(e)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}get isInt(){return!!this._def.checks.find(e=>e.kind==="int"||e.kind==="multipleOf"&&U.isInteger(e.value))}get isFinite(){let e=null,a=null;for(let r of this._def.checks){if(r.kind==="finite"||r.kind==="int"||r.kind==="multipleOf")return!0;r.kind==="min"?(a===null||r.value>a)&&(a=r.value):r.kind==="max"&&(e===null||r.value<e)&&(e=r.value)}return Number.isFinite(a)&&Number.isFinite(e)}};Da.create=t=>new Da({checks:[],typeName:x.ZodNumber,coerce:(t==null?void 0:t.coerce)||!1,...j(t)});var Fa=class Ar extends Z{constructor(){super(...arguments),this.min=this.gte,this.max=this.lte}_parse(e){if(this._def.coerce)try{e.data=BigInt(e.data)}catch{return this._getInvalidInput(e)}if(this._getType(e)!==I.bigint)return this._getInvalidInput(e);let a,r=new be;for(let s of this._def.checks)s.kind==="min"?(s.inclusive?e.data<s.value:e.data<=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_small,type:"bigint",minimum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="max"?(s.inclusive?e.data>s.value:e.data>=s.value)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.too_big,type:"bigint",maximum:s.value,inclusive:s.inclusive,message:s.message}),r.dirty()):s.kind==="multipleOf"?e.data%s.value!==BigInt(0)&&(a=this._getOrReturnCtx(e,a),w(a,{code:y.not_multiple_of,multipleOf:s.value,message:s.message}),r.dirty()):U.assertNever(s);return{status:r.value,value:e.data}}_getInvalidInput(e){let a=this._getOrReturnCtx(e);return w(a,{code:y.invalid_type,expected:I.bigint,received:a.parsedType}),N}gte(e,a){return this.setLimit("min",e,!0,E.toString(a))}gt(e,a){return this.setLimit("min",e,!1,E.toString(a))}lte(e,a){return this.setLimit("max",e,!0,E.toString(a))}lt(e,a){return this.setLimit("max",e,!1,E.toString(a))}setLimit(e,a,r,s){return new Ar({...this._def,checks:[...this._def.checks,{kind:e,value:a,inclusive:r,message:E.toString(s)}]})}_addCheck(e){return new Ar({...this._def,checks:[...this._def.checks,e]})}positive(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!1,message:E.toString(e)})}negative(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!1,message:E.toString(e)})}nonpositive(e){return this._addCheck({kind:"max",value:BigInt(0),inclusive:!0,message:E.toString(e)})}nonnegative(e){return this._addCheck({kind:"min",value:BigInt(0),inclusive:!0,message:E.toString(e)})}multipleOf(e,a){return this._addCheck({kind:"multipleOf",value:e,message:E.toString(a)})}get minValue(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e}get maxValue(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e}};Fa.create=t=>new Fa({checks:[],typeName:x.ZodBigInt,coerce:(t==null?void 0:t.coerce)??!1,...j(t)});var za=class extends Z{_parse(t){if(this._def.coerce&&(t.data=!!t.data),this._getType(t)!==I.boolean){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.boolean,received:e.parsedType}),N}return ye(t.data)}};za.create=t=>new za({typeName:x.ZodBoolean,coerce:(t==null?void 0:t.coerce)||!1,...j(t)});var Ua=class Zn extends Z{_parse(e){if(this._def.coerce&&(e.data=new Date(e.data)),this._getType(e)!==I.date){let s=this._getOrReturnCtx(e);return w(s,{code:y.invalid_type,expected:I.date,received:s.parsedType}),N}if(Number.isNaN(e.data.getTime()))return w(this._getOrReturnCtx(e),{code:y.invalid_date}),N;let a=new be,r;for(let s of this._def.checks)s.kind==="min"?e.data.getTime()<s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_small,message:s.message,inclusive:!0,exact:!1,minimum:s.value,type:"date"}),a.dirty()):s.kind==="max"?e.data.getTime()>s.value&&(r=this._getOrReturnCtx(e,r),w(r,{code:y.too_big,message:s.message,inclusive:!0,exact:!1,maximum:s.value,type:"date"}),a.dirty()):U.assertNever(s);return{status:a.value,value:new Date(e.data.getTime())}}_addCheck(e){return new Zn({...this._def,checks:[...this._def.checks,e]})}min(e,a){return this._addCheck({kind:"min",value:e.getTime(),message:E.toString(a)})}max(e,a){return this._addCheck({kind:"max",value:e.getTime(),message:E.toString(a)})}get minDate(){let e=null;for(let a of this._def.checks)a.kind==="min"&&(e===null||a.value>e)&&(e=a.value);return e==null?null:new Date(e)}get maxDate(){let e=null;for(let a of this._def.checks)a.kind==="max"&&(e===null||a.value<e)&&(e=a.value);return e==null?null:new Date(e)}};Ua.create=t=>new Ua({checks:[],coerce:(t==null?void 0:t.coerce)||!1,typeName:x.ZodDate,...j(t)});var Va=class extends Z{_parse(t){if(this._getType(t)!==I.symbol){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.symbol,received:e.parsedType}),N}return ye(t.data)}};Va.create=t=>new Va({typeName:x.ZodSymbol,...j(t)});var oa=class extends Z{_parse(t){if(this._getType(t)!==I.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.undefined,received:e.parsedType}),N}return ye(t.data)}};oa.create=t=>new oa({typeName:x.ZodUndefined,...j(t)});var la=class extends Z{_parse(t){if(this._getType(t)!==I.null){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.null,received:e.parsedType}),N}return ye(t.data)}};la.create=t=>new la({typeName:x.ZodNull,...j(t)});var Ba=class extends Z{constructor(){super(...arguments),this._any=!0}_parse(t){return ye(t.data)}};Ba.create=t=>new Ba({typeName:x.ZodAny,...j(t)});var Ct=class extends Z{constructor(){super(...arguments),this._unknown=!0}_parse(t){return ye(t.data)}};Ct.create=t=>new Ct({typeName:x.ZodUnknown,...j(t)});var nt=class extends Z{_parse(t){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.never,received:e.parsedType}),N}};nt.create=t=>new nt({typeName:x.ZodNever,...j(t)});var Wa=class extends Z{_parse(t){if(this._getType(t)!==I.undefined){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.void,received:e.parsedType}),N}return ye(t.data)}};Wa.create=t=>new Wa({typeName:x.ZodVoid,...j(t)});var It=class Oa extends Z{_parse(e){let{ctx:a,status:r}=this._processInputParams(e),s=this._def;if(a.parsedType!==I.array)return w(a,{code:y.invalid_type,expected:I.array,received:a.parsedType}),N;if(s.exactLength!==null){let i=a.data.length>s.exactLength.value,o=a.data.length<s.exactLength.value;(i||o)&&(w(a,{code:i?y.too_big:y.too_small,minimum:o?s.exactLength.value:void 0,maximum:i?s.exactLength.value:void 0,type:"array",inclusive:!0,exact:!0,message:s.exactLength.message}),r.dirty())}if(s.minLength!==null&&a.data.length<s.minLength.value&&(w(a,{code:y.too_small,minimum:s.minLength.value,type:"array",inclusive:!0,exact:!1,message:s.minLength.message}),r.dirty()),s.maxLength!==null&&a.data.length>s.maxLength.value&&(w(a,{code:y.too_big,maximum:s.maxLength.value,type:"array",inclusive:!0,exact:!1,message:s.maxLength.message}),r.dirty()),a.common.async)return Promise.all([...a.data].map((i,o)=>s.type._parseAsync(new De(a,i,a.path,o)))).then(i=>be.mergeArray(r,i));let n=[...a.data].map((i,o)=>s.type._parseSync(new De(a,i,a.path,o)));return be.mergeArray(r,n)}get element(){return this._def.type}min(e,a){return new Oa({...this._def,minLength:{value:e,message:E.toString(a)}})}max(e,a){return new Oa({...this._def,maxLength:{value:e,message:E.toString(a)}})}length(e,a){return new Oa({...this._def,exactLength:{value:e,message:E.toString(a)}})}nonempty(e){return this.min(1,e)}};It.create=(t,e)=>new It({type:t,minLength:null,maxLength:null,exactLength:null,typeName:x.ZodArray,...j(e)});function Tt(t){if(t instanceof Ae){let e={};for(let a in t.shape){let r=t.shape[a];e[a]=Je.create(Tt(r))}return new Ae({...t._def,shape:()=>e})}else return t instanceof It?new It({...t._def,type:Tt(t.element)}):t instanceof Je?Je.create(Tt(t.unwrap())):t instanceof mt?mt.create(Tt(t.unwrap())):t instanceof pt?pt.create(t.items.map(e=>Tt(e))):t}var Ae=class Me extends Z{constructor(){super(...arguments),this._cached=null,this.nonstrict=this.passthrough,this.augment=this.extend}_getCached(){if(this._cached!==null)return this._cached;let e=this._def.shape();return this._cached={shape:e,keys:U.objectKeys(e)},this._cached}_parse(e){if(this._getType(e)!==I.object){let l=this._getOrReturnCtx(e);return w(l,{code:y.invalid_type,expected:I.object,received:l.parsedType}),N}let{status:a,ctx:r}=this._processInputParams(e),{shape:s,keys:n}=this._getCached(),i=[];if(!(this._def.catchall instanceof nt&&this._def.unknownKeys==="strip"))for(let l in r.data)n.includes(l)||i.push(l);let o=[];for(let l of n){let d=s[l],u=r.data[l];o.push({key:{status:"valid",value:l},value:d._parse(new De(r,u,r.path,l)),alwaysSet:l in r.data})}if(this._def.catchall instanceof nt){let l=this._def.unknownKeys;if(l==="passthrough")for(let d of i)o.push({key:{status:"valid",value:d},value:{status:"valid",value:r.data[d]}});else if(l==="strict")i.length>0&&(w(r,{code:y.unrecognized_keys,keys:i}),a.dirty());else if(l!=="strip")throw Error("Internal ZodObject error: invalid unknownKeys value.")}else{let l=this._def.catchall;for(let d of i){let u=r.data[d];o.push({key:{status:"valid",value:d},value:l._parse(new De(r,u,r.path,d)),alwaysSet:d in r.data})}}return r.common.async?Promise.resolve().then(async()=>{let l=[];for(let d of o){let u=await d.key,c=await d.value;l.push({key:u,value:c,alwaysSet:d.alwaysSet})}return l}).then(l=>be.mergeObjectSync(a,l)):be.mergeObjectSync(a,o)}get shape(){return this._def.shape()}strict(e){return E.errToObj,new Me({...this._def,unknownKeys:"strict",...e===void 0?{}:{errorMap:(a,r)=>{var n,i;let s=((i=(n=this._def).errorMap)==null?void 0:i.call(n,a,r).message)??r.defaultError;return a.code==="unrecognized_keys"?{message:E.errToObj(e).message??s}:{message:s}}}})}strip(){return new Me({...this._def,unknownKeys:"strip"})}passthrough(){return new Me({...this._def,unknownKeys:"passthrough"})}extend(e){return new Me({...this._def,shape:()=>({...this._def.shape(),...e})})}merge(e){return new Me({unknownKeys:e._def.unknownKeys,catchall:e._def.catchall,shape:()=>({...this._def.shape(),...e._def.shape()}),typeName:x.ZodObject})}setKey(e,a){return this.augment({[e]:a})}catchall(e){return new Me({...this._def,catchall:e})}pick(e){let a={};for(let r of U.objectKeys(e))e[r]&&this.shape[r]&&(a[r]=this.shape[r]);return new Me({...this._def,shape:()=>a})}omit(e){let a={};for(let r of U.objectKeys(this.shape))e[r]||(a[r]=this.shape[r]);return new Me({...this._def,shape:()=>a})}deepPartial(){return Tt(this)}partial(e){let a={};for(let r of U.objectKeys(this.shape)){let s=this.shape[r];e&&!e[r]?a[r]=s:a[r]=s.optional()}return new Me({...this._def,shape:()=>a})}required(e){let a={};for(let r of U.objectKeys(this.shape))if(e&&!e[r])a[r]=this.shape[r];else{let s=this.shape[r];for(;s instanceof Je;)s=s._def.innerType;a[r]=s}return new Me({...this._def,shape:()=>a})}keyof(){return vs(U.objectKeys(this.shape))}};Ae.create=(t,e)=>new Ae({shape:()=>t,unknownKeys:"strip",catchall:nt.create(),typeName:x.ZodObject,...j(e)}),Ae.strictCreate=(t,e)=>new Ae({shape:()=>t,unknownKeys:"strict",catchall:nt.create(),typeName:x.ZodObject,...j(e)}),Ae.lazycreate=(t,e)=>new Ae({shape:t,unknownKeys:"strip",catchall:nt.create(),typeName:x.ZodObject,...j(e)});var da=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=this._def.options;function r(s){for(let i of s)if(i.result.status==="valid")return i.result;for(let i of s)if(i.result.status==="dirty")return e.common.issues.push(...i.ctx.common.issues),i.result;let n=s.map(i=>new Le(i.ctx.common.issues));return w(e,{code:y.invalid_union,unionErrors:n}),N}if(e.common.async)return Promise.all(a.map(async s=>{let n={...e,common:{...e.common,issues:[]},parent:null};return{result:await s._parseAsync({data:e.data,path:e.path,parent:n}),ctx:n}})).then(r);{let s,n=[];for(let o of a){let l={...e,common:{...e.common,issues:[]},parent:null},d=o._parseSync({data:e.data,path:e.path,parent:l});if(d.status==="valid")return d;d.status==="dirty"&&!s&&(s={result:d,ctx:l}),l.common.issues.length&&n.push(l.common.issues)}if(s)return e.common.issues.push(...s.ctx.common.issues),s.result;let i=n.map(o=>new Le(o));return w(e,{code:y.invalid_union,unionErrors:i}),N}}get options(){return this._def.options}};da.create=(t,e)=>new da({options:t,typeName:x.ZodUnion,...j(e)});var it=t=>t instanceof ca?it(t.schema):t instanceof Ke?it(t.innerType()):t instanceof pa?[t.value]:t instanceof ma?t.options:t instanceof ha?U.objectValues(t.enum):t instanceof fa?it(t._def.innerType):t instanceof oa?[void 0]:t instanceof la?[null]:t instanceof Je?[void 0,...it(t.unwrap())]:t instanceof mt?[null,...it(t.unwrap())]:t instanceof _s||t instanceof ya?it(t.unwrap()):t instanceof ga?it(t._def.innerType):[],zo=class $n extends Z{_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==I.object)return w(a,{code:y.invalid_type,expected:I.object,received:a.parsedType}),N;let r=this.discriminator,s=a.data[r],n=this.optionsMap.get(s);return n?a.common.async?n._parseAsync({data:a.data,path:a.path,parent:a}):n._parseSync({data:a.data,path:a.path,parent:a}):(w(a,{code:y.invalid_union_discriminator,options:Array.from(this.optionsMap.keys()),path:[r]}),N)}get discriminator(){return this._def.discriminator}get options(){return this._def.options}get optionsMap(){return this._def.optionsMap}static create(e,a,r){let s=new Map;for(let n of a){let i=it(n.shape[e]);if(!i.length)throw Error(`A discriminator value for key \`${e}\` could not be extracted from all schema options`);for(let o of i){if(s.has(o))throw Error(`Discriminator property ${String(e)} has duplicate value ${String(o)}`);s.set(o,n)}}return new $n({typeName:x.ZodDiscriminatedUnion,discriminator:e,options:a,optionsMap:s,...j(r)})}};function qa(t,e){let a=st(t),r=st(e);if(t===e)return{valid:!0,data:t};if(a===I.object&&r===I.object){let s=U.objectKeys(e),n=U.objectKeys(t).filter(o=>s.indexOf(o)!==-1),i={...t,...e};for(let o of n){let l=qa(t[o],e[o]);if(!l.valid)return{valid:!1};i[o]=l.data}return{valid:!0,data:i}}else if(a===I.array&&r===I.array){if(t.length!==e.length)return{valid:!1};let s=[];for(let n=0;n<t.length;n++){let i=t[n],o=e[n],l=qa(i,o);if(!l.valid)return{valid:!1};s.push(l.data)}return{valid:!0,data:s}}else return a===I.date&&r===I.date&&+t==+e?{valid:!0,data:t}:{valid:!1}}var ua=class extends Z{_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=(s,n)=>{if(ps(s)||ps(n))return N;let i=qa(s.value,n.value);return i.valid?((ms(s)||ms(n))&&e.dirty(),{status:e.value,value:i.data}):(w(a,{code:y.invalid_intersection_types}),N)};return a.common.async?Promise.all([this._def.left._parseAsync({data:a.data,path:a.path,parent:a}),this._def.right._parseAsync({data:a.data,path:a.path,parent:a})]).then(([s,n])=>r(s,n)):r(this._def.left._parseSync({data:a.data,path:a.path,parent:a}),this._def.right._parseSync({data:a.data,path:a.path,parent:a}))}};ua.create=(t,e,a)=>new ua({left:t,right:e,typeName:x.ZodIntersection,...j(a)});var pt=class Ln extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.array)return w(r,{code:y.invalid_type,expected:I.array,received:r.parsedType}),N;if(r.data.length<this._def.items.length)return w(r,{code:y.too_small,minimum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),N;!this._def.rest&&r.data.length>this._def.items.length&&(w(r,{code:y.too_big,maximum:this._def.items.length,inclusive:!0,exact:!1,type:"array"}),a.dirty());let s=[...r.data].map((n,i)=>{let o=this._def.items[i]||this._def.rest;return o?o._parse(new De(r,n,r.path,i)):null}).filter(n=>!!n);return r.common.async?Promise.all(s).then(n=>be.mergeArray(a,n)):be.mergeArray(a,s)}get items(){return this._def.items}rest(e){return new Ln({...this._def,rest:e})}};pt.create=(t,e)=>{if(!Array.isArray(t))throw Error("You must pass an array of schemas to z.tuple([ ... ])");return new pt({items:t,typeName:x.ZodTuple,rest:null,...j(e)})};var Uo=class Or extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.object)return w(r,{code:y.invalid_type,expected:I.object,received:r.parsedType}),N;let s=[],n=this._def.keyType,i=this._def.valueType;for(let o in r.data)s.push({key:n._parse(new De(r,o,r.path,o)),value:i._parse(new De(r,r.data[o],r.path,o)),alwaysSet:o in r.data});return r.common.async?be.mergeObjectAsync(a,s):be.mergeObjectSync(a,s)}get element(){return this._def.valueType}static create(e,a,r){return a instanceof Z?new Or({keyType:e,valueType:a,typeName:x.ZodRecord,...j(r)}):new Or({keyType:ia.create(),valueType:e,typeName:x.ZodRecord,...j(a)})}},Ka=class extends Z{get keySchema(){return this._def.keyType}get valueSchema(){return this._def.valueType}_parse(t){let{status:e,ctx:a}=this._processInputParams(t);if(a.parsedType!==I.map)return w(a,{code:y.invalid_type,expected:I.map,received:a.parsedType}),N;let r=this._def.keyType,s=this._def.valueType,n=[...a.data.entries()].map(([i,o],l)=>({key:r._parse(new De(a,i,a.path,[l,"key"])),value:s._parse(new De(a,o,a.path,[l,"value"]))}));if(a.common.async){let i=new Map;return Promise.resolve().then(async()=>{for(let o of n){let l=await o.key,d=await o.value;if(l.status==="aborted"||d.status==="aborted")return N;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}})}else{let i=new Map;for(let o of n){let l=o.key,d=o.value;if(l.status==="aborted"||d.status==="aborted")return N;(l.status==="dirty"||d.status==="dirty")&&e.dirty(),i.set(l.value,d.value)}return{status:e.value,value:i}}}};Ka.create=(t,e,a)=>new Ka({valueType:e,keyType:t,typeName:x.ZodMap,...j(a)});var Ja=class Nr extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.parsedType!==I.set)return w(r,{code:y.invalid_type,expected:I.set,received:r.parsedType}),N;let s=this._def;s.minSize!==null&&r.data.size<s.minSize.value&&(w(r,{code:y.too_small,minimum:s.minSize.value,type:"set",inclusive:!0,exact:!1,message:s.minSize.message}),a.dirty()),s.maxSize!==null&&r.data.size>s.maxSize.value&&(w(r,{code:y.too_big,maximum:s.maxSize.value,type:"set",inclusive:!0,exact:!1,message:s.maxSize.message}),a.dirty());let n=this._def.valueType;function i(l){let d=new Set;for(let u of l){if(u.status==="aborted")return N;u.status==="dirty"&&a.dirty(),d.add(u.value)}return{status:a.value,value:d}}let o=[...r.data.values()].map((l,d)=>n._parse(new De(r,l,r.path,d)));return r.common.async?Promise.all(o).then(l=>i(l)):i(o)}min(e,a){return new Nr({...this._def,minSize:{value:e,message:E.toString(a)}})}max(e,a){return new Nr({...this._def,maxSize:{value:e,message:E.toString(a)}})}size(e,a){return this.min(e,a).max(e,a)}nonempty(e){return this.min(1,e)}};Ja.create=(t,e)=>new Ja({valueType:t,minSize:null,maxSize:null,typeName:x.ZodSet,...j(e)});var Vo=class Na extends Z{constructor(){super(...arguments),this.validate=this.implement}_parse(e){let{ctx:a}=this._processInputParams(e);if(a.parsedType!==I.function)return w(a,{code:y.invalid_type,expected:I.function,received:a.parsedType}),N;function r(o,l){return $a({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Za(),Pt].filter(d=>!!d),issueData:{code:y.invalid_arguments,argumentsError:l}})}function s(o,l){return $a({data:o,path:a.path,errorMaps:[a.common.contextualErrorMap,a.schemaErrorMap,Za(),Pt].filter(d=>!!d),issueData:{code:y.invalid_return_type,returnTypeError:l}})}let n={errorMap:a.common.contextualErrorMap},i=a.data;if(this._def.returns instanceof Zt){let o=this;return ye(async function(...l){let d=new Le([]),u=await o._def.args.parseAsync(l,n).catch(g=>{throw d.addIssue(r(l,g)),d}),c=await Reflect.apply(i,this,u);return await o._def.returns._def.type.parseAsync(c,n).catch(g=>{throw d.addIssue(s(c,g)),d})})}else{let o=this;return ye(function(...l){let d=o._def.args.safeParse(l,n);if(!d.success)throw new Le([r(l,d.error)]);let u=Reflect.apply(i,this,d.data),c=o._def.returns.safeParse(u,n);if(!c.success)throw new Le([s(u,c.error)]);return c.data})}}parameters(){return this._def.args}returnType(){return this._def.returns}args(...e){return new Na({...this._def,args:pt.create(e).rest(Ct.create())})}returns(e){return new Na({...this._def,returns:e})}implement(e){return this.parse(e)}strictImplement(e){return this.parse(e)}static create(e,a,r){return new Na({args:e||pt.create([]).rest(Ct.create()),returns:a||Ct.create(),typeName:x.ZodFunction,...j(r)})}},ca=class extends Z{get schema(){return this._def.getter()}_parse(t){let{ctx:e}=this._processInputParams(t);return this._def.getter()._parse({data:e.data,path:e.path,parent:e})}};ca.create=(t,e)=>new ca({getter:t,typeName:x.ZodLazy,...j(e)});var pa=class extends Z{_parse(t){if(t.data!==this._def.value){let e=this._getOrReturnCtx(t);return w(e,{received:e.data,code:y.invalid_literal,expected:this._def.value}),N}return{status:"valid",value:t.data}}get value(){return this._def.value}};pa.create=(t,e)=>new pa({value:t,typeName:x.ZodLiteral,...j(e)});function vs(t,e){return new ma({values:t,typeName:x.ZodEnum,...j(e)})}var ma=class Rr extends Z{_parse(e){if(typeof e.data!="string"){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{expected:U.joinValues(r),received:a.parsedType,code:y.invalid_type}),N}if(this._cache||(this._cache=new Set(this._def.values)),!this._cache.has(e.data)){let a=this._getOrReturnCtx(e),r=this._def.values;return w(a,{received:a.data,code:y.invalid_enum_value,options:r}),N}return ye(e.data)}get options(){return this._def.values}get enum(){let e={};for(let a of this._def.values)e[a]=a;return e}get Values(){let e={};for(let a of this._def.values)e[a]=a;return e}get Enum(){let e={};for(let a of this._def.values)e[a]=a;return e}extract(e,a=this._def){return Rr.create(e,{...this._def,...a})}exclude(e,a=this._def){return Rr.create(this.options.filter(r=>!e.includes(r)),{...this._def,...a})}};ma.create=vs;var ha=class extends Z{_parse(t){let e=U.getValidEnumValues(this._def.values),a=this._getOrReturnCtx(t);if(a.parsedType!==I.string&&a.parsedType!==I.number){let r=U.objectValues(e);return w(a,{expected:U.joinValues(r),received:a.parsedType,code:y.invalid_type}),N}if(this._cache||(this._cache=new Set(U.getValidEnumValues(this._def.values))),!this._cache.has(t.data)){let r=U.objectValues(e);return w(a,{received:a.data,code:y.invalid_enum_value,options:r}),N}return ye(t.data)}get enum(){return this._def.values}};ha.create=(t,e)=>new ha({values:t,typeName:x.ZodNativeEnum,...j(e)});var Zt=class extends Z{unwrap(){return this._def.type}_parse(t){let{ctx:e}=this._processInputParams(t);return e.parsedType!==I.promise&&e.common.async===!1?(w(e,{code:y.invalid_type,expected:I.promise,received:e.parsedType}),N):ye((e.parsedType===I.promise?e.data:Promise.resolve(e.data)).then(a=>this._def.type.parseAsync(a,{path:e.path,errorMap:e.common.contextualErrorMap})))}};Zt.create=(t,e)=>new Zt({type:t,typeName:x.ZodPromise,...j(e)});var Ke=class extends Z{innerType(){return this._def.schema}sourceType(){return this._def.schema._def.typeName===x.ZodEffects?this._def.schema.sourceType():this._def.schema}_parse(t){let{status:e,ctx:a}=this._processInputParams(t),r=this._def.effect||null,s={addIssue:n=>{w(a,n),n.fatal?e.abort():e.dirty()},get path(){return a.path}};if(s.addIssue=s.addIssue.bind(s),r.type==="preprocess"){let n=r.transform(a.data,s);if(a.common.async)return Promise.resolve(n).then(async i=>{if(e.value==="aborted")return N;let o=await this._def.schema._parseAsync({data:i,path:a.path,parent:a});return o.status==="aborted"?N:o.status==="dirty"||e.value==="dirty"?La(o.value):o});{if(e.value==="aborted")return N;let i=this._def.schema._parseSync({data:n,path:a.path,parent:a});return i.status==="aborted"?N:i.status==="dirty"||e.value==="dirty"?La(i.value):i}}if(r.type==="refinement"){let n=i=>{let o=r.refinement(i,s);if(a.common.async)return Promise.resolve(o);if(o instanceof Promise)throw Error("Async refinement encountered during synchronous parse operation. Use .parseAsync instead.");return i};if(a.common.async===!1){let i=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});return i.status==="aborted"?N:(i.status==="dirty"&&e.dirty(),n(i.value),{status:e.value,value:i.value})}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(i=>i.status==="aborted"?N:(i.status==="dirty"&&e.dirty(),n(i.value).then(()=>({status:e.value,value:i.value}))))}if(r.type==="transform")if(a.common.async===!1){let n=this._def.schema._parseSync({data:a.data,path:a.path,parent:a});if(!kt(n))return N;let i=r.transform(n.value,s);if(i instanceof Promise)throw Error("Asynchronous transform encountered during synchronous parse operation. Use .parseAsync instead.");return{status:e.value,value:i}}else return this._def.schema._parseAsync({data:a.data,path:a.path,parent:a}).then(n=>kt(n)?Promise.resolve(r.transform(n.value,s)).then(i=>({status:e.value,value:i})):N);U.assertNever(r)}};Ke.create=(t,e,a)=>new Ke({schema:t,typeName:x.ZodEffects,effect:e,...j(a)}),Ke.createWithPreprocess=(t,e,a)=>new Ke({schema:e,effect:{type:"preprocess",transform:t},typeName:x.ZodEffects,...j(a)});var Je=class extends Z{_parse(t){return this._getType(t)===I.undefined?ye(void 0):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};Je.create=(t,e)=>new Je({innerType:t,typeName:x.ZodOptional,...j(e)});var mt=class extends Z{_parse(t){return this._getType(t)===I.null?ye(null):this._def.innerType._parse(t)}unwrap(){return this._def.innerType}};mt.create=(t,e)=>new mt({innerType:t,typeName:x.ZodNullable,...j(e)});var fa=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return e.parsedType===I.undefined&&(a=this._def.defaultValue()),this._def.innerType._parse({data:a,path:e.path,parent:e})}removeDefault(){return this._def.innerType}};fa.create=(t,e)=>new fa({innerType:t,typeName:x.ZodDefault,defaultValue:typeof e.default=="function"?e.default:()=>e.default,...j(e)});var ga=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a={...e,common:{...e.common,issues:[]}},r=this._def.innerType._parse({data:a.data,path:a.path,parent:{...a}});return na(r)?r.then(s=>({status:"valid",value:s.status==="valid"?s.value:this._def.catchValue({get error(){return new Le(a.common.issues)},input:a.data})})):{status:"valid",value:r.status==="valid"?r.value:this._def.catchValue({get error(){return new Le(a.common.issues)},input:a.data})}}removeCatch(){return this._def.innerType}};ga.create=(t,e)=>new ga({innerType:t,typeName:x.ZodCatch,catchValue:typeof e.catch=="function"?e.catch:()=>e.catch,...j(e)});var Ya=class extends Z{_parse(t){if(this._getType(t)!==I.nan){let e=this._getOrReturnCtx(t);return w(e,{code:y.invalid_type,expected:I.nan,received:e.parsedType}),N}return{status:"valid",value:t.data}}};Ya.create=t=>new Ya({typeName:x.ZodNaN,...j(t)});var _s=class extends Z{_parse(t){let{ctx:e}=this._processInputParams(t),a=e.data;return this._def.type._parse({data:a,path:e.path,parent:e})}unwrap(){return this._def.type}},bs=class Dn extends Z{_parse(e){let{status:a,ctx:r}=this._processInputParams(e);if(r.common.async)return(async()=>{let s=await this._def.in._parseAsync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?N:s.status==="dirty"?(a.dirty(),La(s.value)):this._def.out._parseAsync({data:s.value,path:r.path,parent:r})})();{let s=this._def.in._parseSync({data:r.data,path:r.path,parent:r});return s.status==="aborted"?N:s.status==="dirty"?(a.dirty(),{status:"dirty",value:s.value}):this._def.out._parseSync({data:s.value,path:r.path,parent:r})}}static create(e,a){return new Dn({in:e,out:a,typeName:x.ZodPipeline})}},ya=class extends Z{_parse(t){let e=this._def.innerType._parse(t),a=r=>(kt(r)&&(r.value=Object.freeze(r.value)),r);return na(e)?e.then(r=>a(r)):a(e)}unwrap(){return this._def.innerType}};ya.create=(t,e)=>new ya({innerType:t,typeName:x.ZodReadonly,...j(e)}),Ae.lazycreate;var x;(function(t){t.ZodString="ZodString",t.ZodNumber="ZodNumber",t.ZodNaN="ZodNaN",t.ZodBigInt="ZodBigInt",t.ZodBoolean="ZodBoolean",t.ZodDate="ZodDate",t.ZodSymbol="ZodSymbol",t.ZodUndefined="ZodUndefined",t.ZodNull="ZodNull",t.ZodAny="ZodAny",t.ZodUnknown="ZodUnknown",t.ZodNever="ZodNever",t.ZodVoid="ZodVoid",t.ZodArray="ZodArray",t.ZodObject="ZodObject",t.ZodUnion="ZodUnion",t.ZodDiscriminatedUnion="ZodDiscriminatedUnion",t.ZodIntersection="ZodIntersection",t.ZodTuple="ZodTuple",t.ZodRecord="ZodRecord",t.ZodMap="ZodMap",t.ZodSet="ZodSet",t.ZodFunction="ZodFunction",t.ZodLazy="ZodLazy",t.ZodLiteral="ZodLiteral",t.ZodEnum="ZodEnum",t.ZodEffects="ZodEffects",t.ZodNativeEnum="ZodNativeEnum",t.ZodOptional="ZodOptional",t.ZodNullable="ZodNullable",t.ZodDefault="ZodDefault",t.ZodCatch="ZodCatch",t.ZodPromise="ZodPromise",t.ZodBranded="ZodBranded",t.ZodPipeline="ZodPipeline",t.ZodReadonly="ZodReadonly"})(x||(x={})),ia.create,Da.create,Ya.create,Fa.create,za.create,Ua.create,Va.create,oa.create,la.create,Ba.create,Ct.create,nt.create,Wa.create,It.create,Ae.create,Ae.strictCreate,da.create,zo.create,ua.create,pt.create,Uo.create,Ka.create,Ja.create,Vo.create,ca.create,pa.create,ma.create,ha.create,Zt.create,Ke.create,Je.create,mt.create,Ke.createWithPreprocess,bs.create;var $t=({prefix:t,size:e=16,alphabet:a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz",separator:r="-"}={})=>{let s=()=>{let n=a.length,i=Array(e);for(let o=0;o<e;o++)i[o]=a[Math.random()*n|0];return i.join("")};if(t==null)return s;if(a.includes(r))throw new uo({argument:"separator",message:`The separator "${r}" must not be part of the alphabet "${a}".`});return()=>`${t}${r}${s()}`},Bo=$t(),Wo=/"__proto__"\s*:/,qo=/"constructor"\s*:/;function Ko(t){let e=JSON.parse(t);return typeof e!="object"||!e||Wo.test(t)===!1&&qo.test(t)===!1?e:Jo(e)}function Jo(t){let e=[t];for(;e.length;){let a=e;e=[];for(let r of a){if(Object.prototype.hasOwnProperty.call(r,"__proto__")||Object.prototype.hasOwnProperty.call(r,"constructor")&&Object.prototype.hasOwnProperty.call(r.constructor,"prototype"))throw SyntaxError("Object contains forbidden prototype property");for(let s in r){let n=r[s];n&&typeof n=="object"&&e.push(n)}}}return t}function Yo(t){let{stackTraceLimit:e}=Error;Error.stackTraceLimit=0;try{return Ko(t)}finally{Error.stackTraceLimit=e}}var va=Symbol.for("vercel.ai.validator");function Go(t){return{[va]:!0,validate:t}}function Ho(t){return typeof t=="object"&&!!t&&va in t&&t[va]===!0&&"validate"in t}function Qo(t){return Ho(t)?t:Xo(t)}function Xo(t){return Go(async e=>{let a=await t["~standard"].validate(e);return a.issues==null?{success:!0,value:a.value}:{success:!1,error:new sa({value:e,cause:a.issues})}})}async function xs({value:t,schema:e}){let a=await Ga({value:t,schema:e});if(!a.success)throw sa.wrap({value:t,cause:a.error});return a.value}async function Ga({value:t,schema:e}){let a=Qo(e);try{if(a.validate==null)return{success:!0,value:t,rawValue:t};let r=await a.validate(t);return r.success?{success:!0,value:r.value,rawValue:t}:{success:!1,error:sa.wrap({value:t,cause:r.error}),rawValue:t}}catch(r){return{success:!1,error:sa.wrap({value:t,cause:r}),rawValue:t}}}async function _a({text:t,schema:e}){try{let a=Yo(t);return e==null?{success:!0,value:a,rawValue:a}:await Ga({value:a,schema:e})}catch(a){return{success:!1,error:os.isInstance(a)?a:new os({text:t,cause:a}),rawValue:void 0}}}function ws({stream:t,schema:e}){return t.pipeThrough(new TextDecoderStream).pipeThrough(new go).pipeThrough(new TransformStream({async transform({data:a},r){a!=="[DONE]"&&r.enqueue(await _a({text:a,schema:e}))}}))}async function Et(t){return typeof t=="function"&&(t=t()),Promise.resolve(t)}var el=(t,e)=>{let a=0;for(;a<t.length&&a<e.length&&t[a]===e[a];a++);return[(t.length-a).toString(),...e.slice(a)].join("/")},tl=Symbol("Let zodToJsonSchema decide on which parser to use"),ks={name:void 0,$refStrategy:"root",basePath:["#"],effectStrategy:"input",pipeStrategy:"all",dateStrategy:"format:date-time",mapStrategy:"entries",removeAdditionalStrategy:"passthrough",allowedAdditionalProperties:!0,rejectedAdditionalProperties:!1,definitionPath:"definitions",strictUnions:!1,definitions:{},errorMessages:!1,patternStrategy:"escape",applyRegexFlags:!1,emailStrategy:"format:email",base64Strategy:"contentEncoding:base64",nameStrategy:"ref"},al=t=>typeof t=="string"?{...ks,name:t}:{...ks,...t};function xe(){return{}}function rl(t,e){var r,s,n;let a={type:"array"};return(r=t.type)!=null&&r._def&&((n=(s=t.type)==null?void 0:s._def)==null?void 0:n.typeName)!==x.ZodAny&&(a.items=q(t.type._def,{...e,currentPath:[...e.currentPath,"items"]})),t.minLength&&(a.minItems=t.minLength.value),t.maxLength&&(a.maxItems=t.maxLength.value),t.exactLength&&(a.minItems=t.exactLength.value,a.maxItems=t.exactLength.value),a}function sl(t){let e={type:"integer",format:"int64"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function nl(){return{type:"boolean"}}function Cs(t,e){return q(t.type._def,e)}var il=(t,e)=>q(t.innerType._def,e);function Is(t,e,a){let r=a??e.dateStrategy;if(Array.isArray(r))return{anyOf:r.map((s,n)=>Is(t,e,s))};switch(r){case"string":case"format:date-time":return{type:"string",format:"date-time"};case"format:date":return{type:"string",format:"date"};case"integer":return ol(t)}}var ol=t=>{let e={type:"integer",format:"unix-time"};for(let a of t.checks)switch(a.kind){case"min":e.minimum=a.value;break;case"max":e.maximum=a.value;break}return e};function ll(t,e){return{...q(t.innerType._def,e),default:t.defaultValue()}}function dl(t,e){return e.effectStrategy==="input"?q(t.schema._def,e):xe()}function ul(t){return{type:"string",enum:Array.from(t.values)}}var cl=t=>"type"in t&&t.type==="string"?!1:"allOf"in t;function pl(t,e){let a=[q(t.left._def,{...e,currentPath:[...e.currentPath,"allOf","0"]}),q(t.right._def,{...e,currentPath:[...e.currentPath,"allOf","1"]})].filter(s=>!!s),r=[];return a.forEach(s=>{if(cl(s))r.push(...s.allOf);else{let n=s;if("additionalProperties"in s&&s.additionalProperties===!1){let{additionalProperties:i,...o}=s;n=o}r.push(n)}}),r.length?{allOf:r}:void 0}function ml(t){let e=typeof t.value;return e!=="bigint"&&e!=="number"&&e!=="boolean"&&e!=="string"?{type:Array.isArray(t.value)?"array":"object"}:{type:e==="bigint"?"integer":e,const:t.value}}var Ha=void 0,Oe={cuid:/^[cC][^\s-]{8,}$/,cuid2:/^[0-9a-z]+$/,ulid:/^[0-9A-HJKMNP-TV-Z]{26}$/,email:/^(?!\.)(?!.*\.\.)([a-zA-Z0-9_'+\-\.]*)[a-zA-Z0-9_+-]@([a-zA-Z0-9][a-zA-Z0-9\-]*\.)+[a-zA-Z]{2,}$/,emoji:()=>(Ha===void 0&&(Ha=RegExp("^(\\p{Extended_Pictographic}|\\p{Emoji_Component})+$","u")),Ha),uuid:/^[0-9a-fA-F]{8}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{4}\b-[0-9a-fA-F]{12}$/,ipv4:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])$/,ipv4Cidr:/^(?:(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\.){3}(?:25[0-5]|2[0-4][0-9]|1[0-9][0-9]|[1-9][0-9]|[0-9])\/(3[0-2]|[12]?[0-9])$/,ipv6:/^(([a-f0-9]{1,4}:){7}|::([a-f0-9]{1,4}:){0,6}|([a-f0-9]{1,4}:){1}:([a-f0-9]{1,4}:){0,5}|([a-f0-9]{1,4}:){2}:([a-f0-9]{1,4}:){0,4}|([a-f0-9]{1,4}:){3}:([a-f0-9]{1,4}:){0,3}|([a-f0-9]{1,4}:){4}:([a-f0-9]{1,4}:){0,2}|([a-f0-9]{1,4}:){5}:([a-f0-9]{1,4}:){0,1})([a-f0-9]{1,4}|(((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2}))\.){3}((25[0-5])|(2[0-4][0-9])|(1[0-9]{2})|([0-9]{1,2})))$/,ipv6Cidr:/^(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))\/(12[0-8]|1[01][0-9]|[1-9]?[0-9])$/,base64:/^([0-9a-zA-Z+/]{4})*(([0-9a-zA-Z+/]{2}==)|([0-9a-zA-Z+/]{3}=))?$/,base64url:/^([0-9a-zA-Z-_]{4})*(([0-9a-zA-Z-_]{2}(==)?)|([0-9a-zA-Z-_]{3}(=)?))?$/,nanoid:/^[a-zA-Z0-9_-]{21}$/,jwt:/^[A-Za-z0-9-_]+\.[A-Za-z0-9-_]+\.[A-Za-z0-9-_]*$/};function Ts(t,e){let a={type:"string"};if(t.checks)for(let r of t.checks)switch(r.kind){case"min":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value;break;case"max":a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"email":switch(e.emailStrategy){case"format:email":Ne(a,"email",r.message,e);break;case"format:idn-email":Ne(a,"idn-email",r.message,e);break;case"pattern:zod":he(a,Oe.email,r.message,e);break}break;case"url":Ne(a,"uri",r.message,e);break;case"uuid":Ne(a,"uuid",r.message,e);break;case"regex":he(a,r.regex,r.message,e);break;case"cuid":he(a,Oe.cuid,r.message,e);break;case"cuid2":he(a,Oe.cuid2,r.message,e);break;case"startsWith":he(a,RegExp(`^${Qa(r.value,e)}`),r.message,e);break;case"endsWith":he(a,RegExp(`${Qa(r.value,e)}$`),r.message,e);break;case"datetime":Ne(a,"date-time",r.message,e);break;case"date":Ne(a,"date",r.message,e);break;case"time":Ne(a,"time",r.message,e);break;case"duration":Ne(a,"duration",r.message,e);break;case"length":a.minLength=typeof a.minLength=="number"?Math.max(a.minLength,r.value):r.value,a.maxLength=typeof a.maxLength=="number"?Math.min(a.maxLength,r.value):r.value;break;case"includes":he(a,RegExp(Qa(r.value,e)),r.message,e);break;case"ip":r.version!=="v6"&&Ne(a,"ipv4",r.message,e),r.version!=="v4"&&Ne(a,"ipv6",r.message,e);break;case"base64url":he(a,Oe.base64url,r.message,e);break;case"jwt":he(a,Oe.jwt,r.message,e);break;case"cidr":r.version!=="v6"&&he(a,Oe.ipv4Cidr,r.message,e),r.version!=="v4"&&he(a,Oe.ipv6Cidr,r.message,e);break;case"emoji":he(a,Oe.emoji(),r.message,e);break;case"ulid":he(a,Oe.ulid,r.message,e);break;case"base64":switch(e.base64Strategy){case"format:binary":Ne(a,"binary",r.message,e);break;case"contentEncoding:base64":a.contentEncoding="base64";break;case"pattern:zod":he(a,Oe.base64,r.message,e);break}break;case"nanoid":he(a,Oe.nanoid,r.message,e);case"toLowerCase":case"toUpperCase":case"trim":break;default:}return a}function Qa(t,e){return e.patternStrategy==="escape"?fl(t):t}var hl=new Set("ABCDEFGHIJKLMNOPQRSTUVXYZabcdefghijklmnopqrstuvxyz0123456789");function fl(t){let e="";for(let a=0;a<t.length;a++)hl.has(t[a])||(e+="\\"),e+=t[a];return e}function Ne(t,e,a,r){var s;t.format||(s=t.anyOf)!=null&&s.some(n=>n.format)?(t.anyOf||(t.anyOf=[]),t.format&&(t.anyOf.push({format:t.format}),delete t.format),t.anyOf.push({format:e,...a&&r.errorMessages&&{errorMessage:{format:a}}})):t.format=e}function he(t,e,a,r){var s;t.pattern||(s=t.allOf)!=null&&s.some(n=>n.pattern)?(t.allOf||(t.allOf=[]),t.pattern&&(t.allOf.push({pattern:t.pattern}),delete t.pattern),t.allOf.push({pattern:Es(e,r),...a&&r.errorMessages&&{errorMessage:{pattern:a}}})):t.pattern=Es(e,r)}function Es(t,e){var l;if(!e.applyRegexFlags||!t.flags)return t.source;let a={i:t.flags.includes("i"),m:t.flags.includes("m"),s:t.flags.includes("s")},r=a.i?t.source.toLowerCase():t.source,s="",n=!1,i=!1,o=!1;for(let d=0;d<r.length;d++){if(n){s+=r[d],n=!1;continue}if(a.i){if(i){if(r[d].match(/[a-z]/)){o?(s+=r[d],s+=`${r[d-2]}-${r[d]}`.toUpperCase(),o=!1):r[d+1]==="-"&&((l=r[d+2])!=null&&l.match(/[a-z]/))?(s+=r[d],o=!0):s+=`${r[d]}${r[d].toUpperCase()}`;continue}}else if(r[d].match(/[a-z]/)){s+=`[${r[d]}${r[d].toUpperCase()}]`;continue}}if(a.m){if(r[d]==="^"){s+=`(^|(?<=[\r
]))`;continue}else if(r[d]==="$"){s+=`($|(?=[\r
]))`;continue}}if(a.s&&r[d]==="."){s+=i?`${r[d]}\r
`:`[${r[d]}\r
]`;continue}s+=r[d],r[d]==="\\"?n=!0:i&&r[d]==="]"?i=!1:!i&&r[d]==="["&&(i=!0)}try{new RegExp(s)}catch{return console.warn(`Could not convert regex pattern at ${e.currentPath.join("/")} to a flag-independent form! Falling back to the flag-ignorant source`),t.source}return s}function Ss(t,e){var r,s,n,i,o;let a={type:"object",additionalProperties:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]})??e.allowedAdditionalProperties};if(((r=t.keyType)==null?void 0:r._def.typeName)===x.ZodString&&((s=t.keyType._def.checks)!=null&&s.length)){let{type:l,...d}=Ts(t.keyType._def,e);return{...a,propertyNames:d}}else{if(((n=t.keyType)==null?void 0:n._def.typeName)===x.ZodEnum)return{...a,propertyNames:{enum:t.keyType._def.values}};if(((i=t.keyType)==null?void 0:i._def.typeName)===x.ZodBranded&&t.keyType._def.type._def.typeName===x.ZodString&&((o=t.keyType._def.type._def.checks)!=null&&o.length)){let{type:l,...d}=Cs(t.keyType._def,e);return{...a,propertyNames:d}}}return a}function gl(t,e){return e.mapStrategy==="record"?Ss(t,e):{type:"array",maxItems:125,items:{type:"array",items:[q(t.keyType._def,{...e,currentPath:[...e.currentPath,"items","items","0"]})||xe(),q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items","items","1"]})||xe()],minItems:2,maxItems:2}}}function yl(t){let e=t.values,a=Object.keys(t.values).filter(s=>typeof e[e[s]]!="number").map(s=>e[s]),r=Array.from(new Set(a.map(s=>typeof s)));return{type:r.length===1?r[0]==="string"?"string":"number":["string","number"],enum:a}}function vl(){return{not:xe()}}function _l(){return{type:"null"}}var Xa={ZodString:"string",ZodNumber:"number",ZodBigInt:"integer",ZodBoolean:"boolean",ZodNull:"null"};function bl(t,e){let a=t.options instanceof Map?Array.from(t.options.values()):t.options;if(a.every(r=>r._def.typeName in Xa&&(!r._def.checks||!r._def.checks.length))){let r=a.reduce((s,n)=>{let i=Xa[n._def.typeName];return i&&!s.includes(i)?[...s,i]:s},[]);return{type:r.length>1?r:r[0]}}else if(a.every(r=>r._def.typeName==="ZodLiteral"&&!r.description)){let r=a.reduce((s,n)=>{let i=typeof n._def.value;switch(i){case"string":case"number":case"boolean":return[...s,i];case"bigint":return[...s,"integer"];case"object":if(n._def.value===null)return[...s,"null"];case"symbol":case"undefined":case"function":default:return s}},[]);if(r.length===a.length){let s=r.filter((n,i,o)=>o.indexOf(n)===i);return{type:s.length>1?s:s[0],enum:a.reduce((n,i)=>n.includes(i._def.value)?n:[...n,i._def.value],[])}}}else if(a.every(r=>r._def.typeName==="ZodEnum"))return{type:"string",enum:a.reduce((r,s)=>[...r,...s._def.values.filter(n=>!r.includes(n))],[])};return xl(t,e)}var xl=(t,e)=>{let a=(t.options instanceof Map?Array.from(t.options.values()):t.options).map((r,s)=>q(r._def,{...e,currentPath:[...e.currentPath,"anyOf",`${s}`]})).filter(r=>!!r&&(!e.strictUnions||typeof r=="object"&&Object.keys(r).length>0));return a.length?{anyOf:a}:void 0};function wl(t,e){if(["ZodString","ZodNumber","ZodBigInt","ZodBoolean","ZodNull"].includes(t.innerType._def.typeName)&&(!t.innerType._def.checks||!t.innerType._def.checks.length))return{type:[Xa[t.innerType._def.typeName],"null"]};let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","0"]});return a&&{anyOf:[a,{type:"null"}]}}function kl(t){let e={type:"number"};if(!t.checks)return e;for(let a of t.checks)switch(a.kind){case"int":e.type="integer";break;case"min":a.inclusive?e.minimum=a.value:e.exclusiveMinimum=a.value;break;case"max":a.inclusive?e.maximum=a.value:e.exclusiveMaximum=a.value;break;case"multipleOf":e.multipleOf=a.value;break}return e}function Cl(t,e){let a={type:"object",properties:{}},r=[],s=t.shape();for(let i in s){let o=s[i];if(o===void 0||o._def===void 0)continue;let l=Tl(o),d=q(o._def,{...e,currentPath:[...e.currentPath,"properties",i],propertyPath:[...e.currentPath,"properties",i]});d!==void 0&&(a.properties[i]=d,l||r.push(i))}r.length&&(a.required=r);let n=Il(t,e);return n!==void 0&&(a.additionalProperties=n),a}function Il(t,e){if(t.catchall._def.typeName!=="ZodNever")return q(t.catchall._def,{...e,currentPath:[...e.currentPath,"additionalProperties"]});switch(t.unknownKeys){case"passthrough":return e.allowedAdditionalProperties;case"strict":return e.rejectedAdditionalProperties;case"strip":return e.removeAdditionalStrategy==="strict"?e.allowedAdditionalProperties:e.rejectedAdditionalProperties}}function Tl(t){try{return t.isOptional()}catch{return!0}}var El=(t,e)=>{var r;if(e.currentPath.toString()===((r=e.propertyPath)==null?void 0:r.toString()))return q(t.innerType._def,e);let a=q(t.innerType._def,{...e,currentPath:[...e.currentPath,"anyOf","1"]});return a?{anyOf:[{not:xe()},a]}:xe()},Sl=(t,e)=>{if(e.pipeStrategy==="input")return q(t.in._def,e);if(e.pipeStrategy==="output")return q(t.out._def,e);let a=q(t.in._def,{...e,currentPath:[...e.currentPath,"allOf","0"]});return{allOf:[a,q(t.out._def,{...e,currentPath:[...e.currentPath,"allOf",a?"1":"0"]})].filter(r=>r!==void 0)}};function Al(t,e){return q(t.type._def,e)}function Ol(t,e){let a={type:"array",uniqueItems:!0,items:q(t.valueType._def,{...e,currentPath:[...e.currentPath,"items"]})};return t.minSize&&(a.minItems=t.minSize.value),t.maxSize&&(a.maxItems=t.maxSize.value),a}function Nl(t,e){return t.rest?{type:"array",minItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[]),additionalItems:q(t.rest._def,{...e,currentPath:[...e.currentPath,"additionalItems"]})}:{type:"array",minItems:t.items.length,maxItems:t.items.length,items:t.items.map((a,r)=>q(a._def,{...e,currentPath:[...e.currentPath,"items",`${r}`]})).reduce((a,r)=>r===void 0?a:[...a,r],[])}}function Rl(){return{not:xe()}}function Ml(){return xe()}var jl=(t,e)=>q(t.innerType._def,e),Pl=(t,e,a)=>{switch(e){case x.ZodString:return Ts(t,a);case x.ZodNumber:return kl(t);case x.ZodObject:return Cl(t,a);case x.ZodBigInt:return sl(t);case x.ZodBoolean:return nl();case x.ZodDate:return Is(t,a);case x.ZodUndefined:return Rl();case x.ZodNull:return _l();case x.ZodArray:return rl(t,a);case x.ZodUnion:case x.ZodDiscriminatedUnion:return bl(t,a);case x.ZodIntersection:return pl(t,a);case x.ZodTuple:return Nl(t,a);case x.ZodRecord:return Ss(t,a);case x.ZodLiteral:return ml(t);case x.ZodEnum:return ul(t);case x.ZodNativeEnum:return yl(t);case x.ZodNullable:return wl(t,a);case x.ZodOptional:return El(t,a);case x.ZodMap:return gl(t,a);case x.ZodSet:return Ol(t,a);case x.ZodLazy:return()=>t.getter()._def;case x.ZodPromise:return Al(t,a);case x.ZodNaN:case x.ZodNever:return vl();case x.ZodEffects:return dl(t,a);case x.ZodAny:return xe();case x.ZodUnknown:return Ml();case x.ZodDefault:return ll(t,a);case x.ZodBranded:return Cs(t,a);case x.ZodReadonly:return jl(t,a);case x.ZodCatch:return il(t,a);case x.ZodPipeline:return Sl(t,a);case x.ZodFunction:case x.ZodVoid:case x.ZodSymbol:return;default:return(r=>{})(e)}};function q(t,e,a=!1){var o;let r=e.seen.get(t);if(e.override){let l=(o=e.override)==null?void 0:o.call(e,t,e,r,a);if(l!==tl)return l}if(r&&!a){let l=Zl(r,e);if(l!==void 0)return l}let s={def:t,path:e.currentPath,jsonSchema:void 0};e.seen.set(t,s);let n=Pl(t,t.typeName,e),i=typeof n=="function"?q(n(),e):n;if(i&&$l(t,e,i),e.postProcess){let l=e.postProcess(i,t,e);return s.jsonSchema=i,l}return s.jsonSchema=i,i}var Zl=(t,e)=>{switch(e.$refStrategy){case"root":return{$ref:t.path.join("/")};case"relative":return{$ref:el(e.currentPath,t.path)};case"none":case"seen":return t.path.length<e.currentPath.length&&t.path.every((a,r)=>e.currentPath[r]===a)?(console.warn(`Recursive reference detected at ${e.currentPath.join("/")}! Defaulting to any`),xe()):e.$refStrategy==="seen"?xe():void 0}},$l=(t,e,a)=>(t.description&&(a.description=t.description),a),Ll=t=>{let e=al(t),a=e.name===void 0?e.basePath:[...e.basePath,e.definitionPath,e.name];return{...e,currentPath:a,propertyPath:void 0,seen:new Map(Object.entries(e.definitions).map(([r,s])=>[s._def,{def:s._def,path:[...e.basePath,e.definitionPath,r],jsonSchema:void 0}]))}},Dl=(t,e)=>{let a=Ll(e),r=typeof e=="object"&&e.definitions?Object.entries(e.definitions).reduce((l,[d,u])=>({...l,[d]:q(u._def,{...a,currentPath:[...a.basePath,a.definitionPath,d]},!0)??xe()}),{}):void 0,s=typeof e=="string"?e:(e==null?void 0:e.nameStrategy)==="title"||e==null?void 0:e.name,n=q(t._def,s===void 0?a:{...a,currentPath:[...a.basePath,a.definitionPath,s]},!1)??xe(),i=typeof e=="object"&&e.name!==void 0&&e.nameStrategy==="title"?e.name:void 0;i!==void 0&&(n.title=i);let o=s===void 0?r?{...n,[a.definitionPath]:r}:n:{$ref:[...a.$refStrategy==="relative"?[]:a.basePath,a.definitionPath,s].join("/"),[a.definitionPath]:{...r,[s]:n}};return o.$schema="http://json-schema.org/draft-07/schema#",o};function Fl(t,e){return tr(Dl(t,{$refStrategy:(e==null?void 0:e.useReferences)??!1?"root":"none"}),{validate:async a=>{let r=await t.safeParseAsync(a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function zl(t,e){return tr(Fr(t,{target:"draft-7",io:"output",reused:(e==null?void 0:e.useReferences)??!1?"ref":"inline"}),{validate:async a=>{let r=await pi(t,a);return r.success?{success:!0,value:r.data}:{success:!1,error:r.error}}})}function Ul(t){return"_zod"in t}function Vl(t,e){return Ul(t)?zl(t,e):Fl(t,e)}var er=Symbol.for("vercel.ai.schema");function tr(t,{validate:e}={}){return{[er]:!0,_type:void 0,[va]:!0,jsonSchema:t,validate:e}}function Bl(t){return typeof t=="object"&&!!t&&er in t&&t[er]===!0&&"jsonSchema"in t&&"validate"in t}function Wl(t){return t==null?tr({properties:{},additionalProperties:!1}):Bl(t)?t:Vl(t)}var{btoa:ip,atob:op}=globalThis,ql=Object.defineProperty,Kl=(t,e)=>{for(var a in e)ql(t,a,{get:e[a],enumerable:!0})},As="AI_NoObjectGeneratedError",Os=`vercel.ai.error.${As}`,Jl=Symbol.for(Os),Ns,Rs=class extends rt{constructor({message:t="No object generated.",cause:e,text:a,response:r,usage:s,finishReason:n}){super({name:As,message:t,cause:e}),this[Ns]=!0,this.text=a,this.response=r,this.usage=s,this.finishReason=n}static isInstance(t){return rt.hasMarker(t,Os)}};Ns=Jl;var Ms=le([m(),ea(Uint8Array),ea(ArrayBuffer),ui(t=>{var e;return((e=globalThis.Buffer)==null?void 0:e.isBuffer(t))??!1},{message:"Must be a Buffer"})]),Lt=mi(()=>le([ci(),m(),_t(),ae(),Nt(m(),Lt),Ce(Lt)])),F=Nt(m(),Nt(m(),Lt)),js=T({type:k("text"),text:m(),providerOptions:F.optional()}),Yl=T({type:k("image"),image:le([Ms,ea(URL)]),mediaType:m().optional(),providerOptions:F.optional()}),Ps=T({type:k("file"),data:le([Ms,ea(URL)]),filename:m().optional(),mediaType:m(),providerOptions:F.optional()}),Gl=T({type:k("reasoning"),text:m(),providerOptions:F.optional()}),Hl=T({type:k("tool-call"),toolCallId:m(),toolName:m(),input:re(),providerOptions:F.optional(),providerExecuted:ae().optional()}),Ql=zr("type",[T({type:k("text"),value:m()}),T({type:k("json"),value:Lt}),T({type:k("error-text"),value:m()}),T({type:k("error-json"),value:Lt}),T({type:k("content"),value:Ce(le([T({type:k("text"),text:m()}),T({type:k("media"),data:m(),mediaType:m()})]))})]),Zs=T({type:k("tool-result"),toolCallId:m(),toolName:m(),output:Ql,providerOptions:F.optional()});le([T({role:k("system"),content:m(),providerOptions:F.optional()}),T({role:k("user"),content:le([m(),Ce(le([js,Yl,Ps]))]),providerOptions:F.optional()}),T({role:k("assistant"),content:le([m(),Ce(le([js,Ps,Gl,Hl,Zs]))]),providerOptions:F.optional()}),T({role:k("tool"),content:Ce(Zs),providerOptions:F.optional()})]),$t({prefix:"aitxt",size:24});var $s=le([G({type:k("text-start"),id:m(),providerMetadata:F.optional()}),G({type:k("text-delta"),id:m(),delta:m(),providerMetadata:F.optional()}),G({type:k("text-end"),id:m(),providerMetadata:F.optional()}),G({type:k("error"),errorText:m()}),G({type:k("tool-input-start"),toolCallId:m(),toolName:m(),providerExecuted:ae().optional(),dynamic:ae().optional()}),G({type:k("tool-input-delta"),toolCallId:m(),inputTextDelta:m()}),G({type:k("tool-input-available"),toolCallId:m(),toolName:m(),input:re(),providerExecuted:ae().optional(),providerMetadata:F.optional(),dynamic:ae().optional()}),G({type:k("tool-input-error"),toolCallId:m(),toolName:m(),input:re(),providerExecuted:ae().optional(),providerMetadata:F.optional(),dynamic:ae().optional(),errorText:m()}),G({type:k("tool-output-available"),toolCallId:m(),output:re(),providerExecuted:ae().optional(),dynamic:ae().optional(),preliminary:ae().optional()}),G({type:k("tool-output-error"),toolCallId:m(),errorText:m(),providerExecuted:ae().optional(),dynamic:ae().optional()}),G({type:k("reasoning"),text:m(),providerMetadata:F.optional()}),G({type:k("reasoning-start"),id:m(),providerMetadata:F.optional()}),G({type:k("reasoning-delta"),id:m(),delta:m(),providerMetadata:F.optional()}),G({type:k("reasoning-end"),id:m(),providerMetadata:F.optional()}),G({type:k("reasoning-part-finish")}),G({type:k("source-url"),sourceId:m(),url:m(),title:m().optional(),providerMetadata:F.optional()}),G({type:k("source-document"),sourceId:m(),mediaType:m(),title:m(),filename:m().optional(),providerMetadata:F.optional()}),G({type:k("file"),url:m(),mediaType:m(),providerMetadata:F.optional()}),G({type:m().startsWith("data-"),id:m().optional(),data:re(),transient:ae().optional()}),G({type:k("start-step")}),G({type:k("finish-step")}),G({type:k("start"),messageId:m().optional(),messageMetadata:re().optional()}),G({type:k("finish"),messageMetadata:re().optional()}),G({type:k("abort")}),G({type:k("message-metadata"),messageMetadata:re()})]);function Xl(t){return t.type.startsWith("data-")}function Ls(t,e){if(t===void 0&&e===void 0)return;if(t===void 0)return e;if(e===void 0)return t;let a={...t};for(let r in e)if(Object.prototype.hasOwnProperty.call(e,r)){let s=e[r];if(s===void 0)continue;let n=r in t?t[r]:void 0,i=typeof s=="object"&&!!s&&!Array.isArray(s)&&!(s instanceof Date)&&!(s instanceof RegExp),o=typeof n=="object"&&!!n&&!Array.isArray(n)&&!(n instanceof Date)&&!(n instanceof RegExp);i&&o?a[r]=Ls(n,s):a[r]=s}return a}function ed(t){let e=["ROOT"],a=-1,r=null;function s(l,d,u){switch(l){case'"':a=d,e.pop(),e.push(u),e.push("INSIDE_STRING");break;case"f":case"t":case"n":a=d,r=d,e.pop(),e.push(u),e.push("INSIDE_LITERAL");break;case"-":e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=d,e.pop(),e.push(u),e.push("INSIDE_NUMBER");break;case"{":a=d,e.pop(),e.push(u),e.push("INSIDE_OBJECT_START");break;case"[":a=d,e.pop(),e.push(u),e.push("INSIDE_ARRAY_START");break}}function n(l,d){switch(l){case",":e.pop(),e.push("INSIDE_OBJECT_AFTER_COMMA");break;case"}":a=d,e.pop();break}}function i(l,d){switch(l){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=d,e.pop();break}}for(let l=0;l<t.length;l++){let d=t[l];switch(e[e.length-1]){case"ROOT":s(d,l,"FINISH");break;case"INSIDE_OBJECT_START":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break;case"}":a=l,e.pop();break}break;case"INSIDE_OBJECT_AFTER_COMMA":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_KEY");break}break;case"INSIDE_OBJECT_KEY":switch(d){case'"':e.pop(),e.push("INSIDE_OBJECT_AFTER_KEY");break}break;case"INSIDE_OBJECT_AFTER_KEY":switch(d){case":":e.pop(),e.push("INSIDE_OBJECT_BEFORE_VALUE");break}break;case"INSIDE_OBJECT_BEFORE_VALUE":s(d,l,"INSIDE_OBJECT_AFTER_VALUE");break;case"INSIDE_OBJECT_AFTER_VALUE":n(d,l);break;case"INSIDE_STRING":switch(d){case'"':e.pop(),a=l;break;case"\\":e.push("INSIDE_STRING_ESCAPE");break;default:a=l}break;case"INSIDE_ARRAY_START":switch(d){case"]":a=l,e.pop();break;default:a=l,s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break}break;case"INSIDE_ARRAY_AFTER_VALUE":switch(d){case",":e.pop(),e.push("INSIDE_ARRAY_AFTER_COMMA");break;case"]":a=l,e.pop();break;default:a=l;break}break;case"INSIDE_ARRAY_AFTER_COMMA":s(d,l,"INSIDE_ARRAY_AFTER_VALUE");break;case"INSIDE_STRING_ESCAPE":e.pop(),a=l;break;case"INSIDE_NUMBER":switch(d){case"0":case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":a=l;break;case"e":case"E":case"-":case".":break;case",":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"}":e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"&&n(d,l);break;case"]":e.pop(),e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l);break;default:e.pop();break}break;case"INSIDE_LITERAL":{let u=t.substring(r,l+1);!"false".startsWith(u)&&!"true".startsWith(u)&&!"null".startsWith(u)?(e.pop(),e[e.length-1]==="INSIDE_OBJECT_AFTER_VALUE"?n(d,l):e[e.length-1]==="INSIDE_ARRAY_AFTER_VALUE"&&i(d,l)):a=l;break}}}let o=t.slice(0,a+1);for(let l=e.length-1;l>=0;l--)switch(e[l]){case"INSIDE_STRING":o+='"';break;case"INSIDE_OBJECT_KEY":case"INSIDE_OBJECT_AFTER_KEY":case"INSIDE_OBJECT_AFTER_COMMA":case"INSIDE_OBJECT_START":case"INSIDE_OBJECT_BEFORE_VALUE":case"INSIDE_OBJECT_AFTER_VALUE":o+="}";break;case"INSIDE_ARRAY_START":case"INSIDE_ARRAY_AFTER_COMMA":case"INSIDE_ARRAY_AFTER_VALUE":o+="]";break;case"INSIDE_LITERAL":{let d=t.substring(r,t.length);"true".startsWith(d)?o+="true".slice(d.length):"false".startsWith(d)?o+="false".slice(d.length):"null".startsWith(d)&&(o+="null".slice(d.length))}}return o}async function Ds(t){if(t===void 0)return{value:void 0,state:"undefined-input"};let e=await _a({text:t});return e.success?{value:e.value,state:"successful-parse"}:(e=await _a({text:ed(t)}),e.success?{value:e.value,state:"repaired-parse"}:{value:void 0,state:"failed-parse"})}function ba(t){return t.type.startsWith("tool-")}function td(t){return t.type==="dynamic-tool"}function Fs(t){return ba(t)||td(t)}function zs(t){return t.type.split("-").slice(1).join("-")}function ad({lastMessage:t,messageId:e}){return{message:(t==null?void 0:t.role)==="assistant"?t:{id:e,metadata:void 0,role:"assistant",parts:[]},activeTextParts:{},activeReasoningParts:{},partialToolCalls:{}}}function rd({stream:t,messageMetadataSchema:e,dataPartSchemas:a,runUpdateMessageJob:r,onError:s,onToolCall:n,onData:i}){return t.pipeThrough(new TransformStream({async transform(o,l){await r(async({state:d,write:u})=>{function c(p){let h=d.message.parts.filter(ba).find(b=>b.toolCallId===p);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function g(p){let h=d.message.parts.filter(b=>b.type==="dynamic-tool").find(b=>b.toolCallId===p);if(h==null)throw Error("tool-output-error must be preceded by a tool-input-available");return h}function v(p){let h=d.message.parts.find(A=>ba(A)&&A.toolCallId===p.toolCallId),b=p,C=h;h==null?d.message.parts.push({type:`tool-${p.toolName}`,toolCallId:p.toolCallId,state:p.state,input:b.input,output:b.output,rawInput:b.rawInput,errorText:b.errorText,providerExecuted:b.providerExecuted,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(h.state=p.state,C.input=b.input,C.output=b.output,C.errorText=b.errorText,C.rawInput=b.rawInput,C.preliminary=b.preliminary,C.providerExecuted=b.providerExecuted??h.providerExecuted,b.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=b.providerMetadata))}function _(p){let h=d.message.parts.find(A=>A.type==="dynamic-tool"&&A.toolCallId===p.toolCallId),b=p,C=h;h==null?d.message.parts.push({type:"dynamic-tool",toolName:p.toolName,toolCallId:p.toolCallId,state:p.state,input:b.input,output:b.output,errorText:b.errorText,preliminary:b.preliminary,...b.providerMetadata==null?{}:{callProviderMetadata:b.providerMetadata}}):(h.state=p.state,C.toolName=p.toolName,C.input=b.input,C.output=b.output,C.errorText=b.errorText,C.rawInput=b.rawInput??C.rawInput,C.preliminary=b.preliminary,b.providerMetadata!=null&&h.state==="input-available"&&(h.callProviderMetadata=b.providerMetadata))}async function f(p){if(p!=null){let h=d.message.metadata==null?p:Ls(d.message.metadata,p);e!=null&&await xs({value:h,schema:e}),d.message.metadata=h}}switch(o.type){case"text-start":{let p={type:"text",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeTextParts[o.id]=p,d.message.parts.push(p),u();break}case"text-delta":{let p=d.activeTextParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,u();break}case"text-end":{let p=d.activeTextParts[o.id];p.state="done",p.providerMetadata=o.providerMetadata??p.providerMetadata,delete d.activeTextParts[o.id],u();break}case"reasoning-start":{let p={type:"reasoning",text:"",providerMetadata:o.providerMetadata,state:"streaming"};d.activeReasoningParts[o.id]=p,d.message.parts.push(p),u();break}case"reasoning-delta":{let p=d.activeReasoningParts[o.id];p.text+=o.delta,p.providerMetadata=o.providerMetadata??p.providerMetadata,u();break}case"reasoning-end":{let p=d.activeReasoningParts[o.id];p.providerMetadata=o.providerMetadata??p.providerMetadata,p.state="done",delete d.activeReasoningParts[o.id],u();break}case"file":d.message.parts.push({type:"file",mediaType:o.mediaType,url:o.url}),u();break;case"source-url":d.message.parts.push({type:"source-url",sourceId:o.sourceId,url:o.url,title:o.title,providerMetadata:o.providerMetadata}),u();break;case"source-document":d.message.parts.push({type:"source-document",sourceId:o.sourceId,mediaType:o.mediaType,title:o.title,filename:o.filename,providerMetadata:o.providerMetadata}),u();break;case"tool-input-start":{let p=d.message.parts.filter(ba);d.partialToolCalls[o.toolCallId]={text:"",toolName:o.toolName,index:p.length,dynamic:o.dynamic},o.dynamic?_({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-streaming",input:void 0,providerExecuted:o.providerExecuted}),u();break}case"tool-input-delta":{let p=d.partialToolCalls[o.toolCallId];p.text+=o.inputTextDelta;let{value:h}=await Ds(p.text);p.dynamic?_({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:h}):v({toolCallId:o.toolCallId,toolName:p.toolName,state:"input-streaming",input:h}),u();break}case"tool-input-available":o.dynamic?_({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"input-available",input:o.input,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u(),n&&!o.providerExecuted&&await n({toolCall:o});break;case"tool-input-error":o.dynamic?_({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:o.input,errorText:o.errorText,providerMetadata:o.providerMetadata}):v({toolCallId:o.toolCallId,toolName:o.toolName,state:"output-error",input:void 0,rawInput:o.input,errorText:o.errorText,providerExecuted:o.providerExecuted,providerMetadata:o.providerMetadata}),u();break;case"tool-output-available":if(o.dynamic){let p=g(o.toolCallId);_({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-available",input:p.input,output:o.output,preliminary:o.preliminary})}else{let p=c(o.toolCallId);v({toolCallId:o.toolCallId,toolName:zs(p),state:"output-available",input:p.input,output:o.output,providerExecuted:o.providerExecuted,preliminary:o.preliminary})}u();break;case"tool-output-error":if(o.dynamic){let p=g(o.toolCallId);_({toolCallId:o.toolCallId,toolName:p.toolName,state:"output-error",input:p.input,errorText:o.errorText})}else{let p=c(o.toolCallId);v({toolCallId:o.toolCallId,toolName:zs(p),state:"output-error",input:p.input,rawInput:p.rawInput,errorText:o.errorText})}u();break;case"start-step":d.message.parts.push({type:"step-start"});break;case"finish-step":d.activeTextParts={},d.activeReasoningParts={};break;case"start":o.messageId!=null&&(d.message.id=o.messageId),await f(o.messageMetadata),(o.messageId!=null||o.messageMetadata!=null)&&u();break;case"finish":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"message-metadata":await f(o.messageMetadata),o.messageMetadata!=null&&u();break;case"error":s==null||s(Error(o.errorText));break;default:if(Xl(o)){(a==null?void 0:a[o.type])!=null&&await xs({value:o.data,schema:a[o.type]});let p=o;if(p.transient){i==null||i(p);break}let h=p.id==null?void 0:d.message.parts.find(b=>p.type===b.type&&p.id===b.id);h==null?d.message.parts.push(p):h.data=p.data,i==null||i(p),u()}}l.enqueue(o)})}}))}async function Us({stream:t,onError:e}){let a=t.getReader();try{for(;;){let{done:r}=await a.read();if(r)break}}catch(r){e==null||e(r)}finally{a.releaseLock()}}$t({prefix:"aitxt",size:24}),$t({prefix:"aiobj",size:24});var sd=class{constructor(){this.queue=[],this.isProcessing=!1}async processQueue(){if(!this.isProcessing){for(this.isProcessing=!0;this.queue.length>0;)await this.queue[0](),this.queue.shift();this.isProcessing=!1}}async run(t){return new Promise((e,a)=>{this.queue.push(async()=>{try{await t(),e()}catch(r){a(r)}}),this.processQueue()})}};$t({prefix:"aiobj",size:24}),Kl({},{object:()=>id,text:()=>nd});var nd=()=>({type:"text",responseFormat:{type:"text"},async parsePartial({text:t}){return{partial:t}},async parseOutput({text:t}){return t}}),id=({schema:t})=>{let e=Wl(t);return{type:"object",responseFormat:{type:"json",schema:e.jsonSchema},async parsePartial({text:a}){let r=await Ds(a);switch(r.state){case"failed-parse":case"undefined-input":return;case"repaired-parse":case"successful-parse":return{partial:r.value};default:{let s=r.state;throw Error(`Unsupported parse state: ${s}`)}}},async parseOutput({text:a},r){let s=await _a({text:a});if(!s.success)throw new Rs({message:"No object generated: could not parse the response.",cause:s.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});let n=await Ga({value:s.value,schema:e});if(!n.success)throw new Rs({message:"No object generated: response did not match schema.",cause:n.error,text:a,response:r.response,usage:r.usage,finishReason:r.finishReason});return n.value}}},od=bt({name:m(),version:m()}),ar=bt({_meta:de(T({}).loose())}),Dt=ar,ld=T({method:m(),params:de(ar)}),dd=bt({experimental:de(T({}).loose()),logging:de(T({}).loose()),prompts:de(bt({listChanged:de(ae())})),resources:de(bt({subscribe:de(ae()),listChanged:de(ae())})),tools:de(bt({listChanged:de(ae())}))});Dt.extend({protocolVersion:m(),capabilities:dd,serverInfo:od,instructions:de(m())});var ud=Dt.extend({nextCursor:de(m())}),cd=T({name:m(),description:de(m()),inputSchema:T({type:k("object"),properties:de(T({}).loose())}).loose()}).loose();ud.extend({tools:Ce(cd)});var pd=T({type:k("text"),text:m()}).loose(),md=T({type:k("image"),data:Ur(),mimeType:m()}).loose(),Vs=T({uri:m(),mimeType:de(m())}).loose(),hd=Vs.extend({text:m()}),fd=Vs.extend({blob:Ur()}),gd=T({type:k("resource"),resource:le([hd,fd])}).loose();Dt.extend({content:Ce(le([pd,md,gd])),isError:ae().default(!1).optional()}).or(Dt.extend({toolResult:re()}));var xa="2.0",yd=T({jsonrpc:k(xa),id:le([m(),_t().int()])}).merge(ld).strict(),vd=T({jsonrpc:k(xa),id:le([m(),_t().int()]),result:Dt}).strict(),_d=T({jsonrpc:k(xa),id:le([m(),_t().int()]),error:T({code:_t().int(),message:m(),data:de(re())})}).strict();le([yd,T({jsonrpc:k(xa)}).merge(T({method:m(),params:de(ar)})).strict(),vd,_d]);async function bd({stream:t,onTextPart:e}){let a=t.pipeThrough(new TextDecoderStream).getReader();for(;;){let{done:r,value:s}=await a.read();if(r)break;await e(s)}}var xd=()=>fetch;async function wd({api:t,prompt:e,credentials:a,headers:r,body:s,streamProtocol:n="data",setCompletion:i,setLoading:o,setError:l,setAbortController:d,onFinish:u,onError:c,fetch:g=xd()}){try{o(!0),l(void 0);let v=new AbortController;d(v),i("");let _=await g(t,{method:"POST",body:JSON.stringify({prompt:e,...s}),credentials:a,headers:{"Content-Type":"application/json",...r},signal:v.signal}).catch(p=>{throw p});if(!_.ok)throw Error(await _.text()??"Failed to fetch the chat response.");if(!_.body)throw Error("The response body is empty.");let f="";switch(n){case"text":await bd({stream:_.body,onTextPart:p=>{f+=p,i(f)}});break;case"data":await Us({stream:ws({stream:_.body,schema:$s}).pipeThrough(new TransformStream({async transform(p){if(!p.success)throw p.error;let h=p.value;if(h.type==="text-delta")f+=h.delta,i(f);else if(h.type==="error")throw Error(h.errorText)}})),onError:p=>{throw p}});break;default:throw Error(`Unknown stream protocol: ${n}`)}return u&&u(e,f),d(null),f}catch(v){if(v.name==="AbortError")return d(null),null;v instanceof Error&&c&&c(v),l(v)}finally{o(!1)}}async function kd(t){if(t==null)return[];if(!globalThis.FileList||!(t instanceof globalThis.FileList))throw Error("FileList is not supported in the current environment");return Promise.all(Array.from(t).map(async e=>{let{name:a,type:r}=e;return{type:"file",mediaType:r,filename:a,url:await new Promise((s,n)=>{let i=new FileReader;i.onload=o=>{var l;s((l=o.target)==null?void 0:l.result)},i.onerror=o=>n(o),i.readAsDataURL(e)})}}))}var Cd=class{constructor({api:t="/api/chat",credentials:e,headers:a,body:r,fetch:s,prepareSendMessagesRequest:n,prepareReconnectToStreamRequest:i}){this.api=t,this.credentials=e,this.headers=a,this.body=r,this.fetch=s,this.prepareSendMessagesRequest=n,this.prepareReconnectToStreamRequest=i}async sendMessages({abortSignal:t,...e}){var c;let a=await Et(this.body),r=await Et(this.headers),s=await Et(this.credentials),n=await((c=this.prepareSendMessagesRequest)==null?void 0:c.call(this,{api:this.api,id:e.chatId,messages:e.messages,body:{...a,...e.body},headers:{...r,...e.headers},credentials:s,requestMetadata:e.metadata,trigger:e.trigger,messageId:e.messageId})),i=(n==null?void 0:n.api)??this.api,o=(n==null?void 0:n.headers)===void 0?{...r,...e.headers}:n.headers,l=(n==null?void 0:n.body)===void 0?{...a,...e.body,id:e.chatId,messages:e.messages,trigger:e.trigger,messageId:e.messageId}:n.body,d=(n==null?void 0:n.credentials)??s,u=await(this.fetch??globalThis.fetch)(i,{method:"POST",headers:{"Content-Type":"application/json",...o},body:JSON.stringify(l),credentials:d,signal:t});if(!u.ok)throw Error(await u.text()??"Failed to fetch the chat response.");if(!u.body)throw Error("The response body is empty.");return this.processResponseStream(u.body)}async reconnectToStream(t){var d;let e=await Et(this.body),a=await Et(this.headers),r=await Et(this.credentials),s=await((d=this.prepareReconnectToStreamRequest)==null?void 0:d.call(this,{api:this.api,id:t.chatId,body:{...e,...t.body},headers:{...a,...t.headers},credentials:r,requestMetadata:t.metadata})),n=(s==null?void 0:s.api)??`${this.api}/${t.chatId}/stream`,i=(s==null?void 0:s.headers)===void 0?{...a,...t.headers}:s.headers,o=(s==null?void 0:s.credentials)??r,l=await(this.fetch??globalThis.fetch)(n,{method:"GET",headers:i,credentials:o});if(l.status===204)return null;if(!l.ok)throw Error(await l.text()??"Failed to fetch the chat response.");if(!l.body)throw Error("The response body is empty.");return this.processResponseStream(l.body)}},rr=class extends Cd{constructor(t={}){super(t)}processResponseStream(t){return ws({stream:t,schema:$s}).pipeThrough(new TransformStream({async transform(e,a){if(!e.success)throw e.error;a.enqueue(e.value)}}))}},Id=class{constructor({generateId:t=Bo,id:e=t(),transport:a=new rr,messageMetadataSchema:r,dataPartSchemas:s,state:n,onError:i,onToolCall:o,onFinish:l,onData:d,sendAutomaticallyWhen:u}){this.activeResponse=void 0,this.jobExecutor=new sd,this.sendMessage=async(c,g)=>{var _;if(c==null){await this.makeRequest({trigger:"submit-message",messageId:(_=this.lastMessage)==null?void 0:_.id,...g});return}let v;if(v="text"in c||"files"in c?{parts:[...Array.isArray(c.files)?c.files:await kd(c.files),..."text"in c&&c.text!=null?[{type:"text",text:c.text}]:[]]}:c,c.messageId!=null){let f=this.state.messages.findIndex(p=>p.id===c.messageId);if(f===-1)throw Error(`message with id ${c.messageId} not found`);if(this.state.messages[f].role!=="user")throw Error(`message with id ${c.messageId} is not a user message`);this.state.messages=this.state.messages.slice(0,f+1),this.state.replaceMessage(f,{...v,id:c.messageId,role:v.role??"user",metadata:c.metadata})}else this.state.pushMessage({...v,id:v.id??this.generateId(),role:v.role??"user",metadata:c.metadata});await this.makeRequest({trigger:"submit-message",messageId:c.messageId,...g})},this.regenerate=async({messageId:c,...g}={})=>{let v=c==null?this.state.messages.length-1:this.state.messages.findIndex(_=>_.id===c);if(v===-1)throw Error(`message ${c} not found`);this.state.messages=this.state.messages.slice(0,this.messages[v].role==="assistant"?v:v+1),await this.makeRequest({trigger:"regenerate-message",messageId:c,...g})},this.resumeStream=async(c={})=>{await this.makeRequest({trigger:"resume-stream",...c})},this.clearError=()=>{this.status==="error"&&(this.state.error=void 0,this.setStatus({status:"ready"}))},this.addToolResult=async({tool:c,toolCallId:g,output:v})=>this.jobExecutor.run(async()=>{var p,h;let _=this.state.messages,f=_[_.length-1];this.state.replaceMessage(_.length-1,{...f,parts:f.parts.map(b=>Fs(b)&&b.toolCallId===g?{...b,state:"output-available",output:v}:b)}),this.activeResponse&&(this.activeResponse.state.message.parts=this.activeResponse.state.message.parts.map(b=>Fs(b)&&b.toolCallId===g?{...b,state:"output-available",output:v,errorText:void 0}:b)),this.status!=="streaming"&&this.status!=="submitted"&&((p=this.sendAutomaticallyWhen)!=null&&p.call(this,{messages:this.state.messages}))&&this.makeRequest({trigger:"submit-message",messageId:(h=this.lastMessage)==null?void 0:h.id})}),this.stop=async()=>{var c;this.status!=="streaming"&&this.status!=="submitted"||(c=this.activeResponse)!=null&&c.abortController&&this.activeResponse.abortController.abort()},this.id=e,this.transport=a,this.generateId=t,this.messageMetadataSchema=r,this.dataPartSchemas=s,this.state=n,this.onError=i,this.onToolCall=o,this.onFinish=l,this.onData=d,this.sendAutomaticallyWhen=u}get status(){return this.state.status}setStatus({status:t,error:e}){this.status!==t&&(this.state.status=t,this.state.error=e)}get error(){return this.state.error}get messages(){return this.state.messages}get lastMessage(){return this.state.messages[this.state.messages.length-1]}set messages(t){this.state.messages=t}async makeRequest({trigger:t,metadata:e,headers:a,body:r,messageId:s}){var u,c;var n;this.setStatus({status:"submitted",error:void 0});let i=this.lastMessage,o=!1,l=!1,d=!1;try{let g={state:ad({lastMessage:this.state.snapshot(i),messageId:this.generateId()}),abortController:new AbortController};g.abortController.signal.addEventListener("abort",()=>{o=!0}),this.activeResponse=g;let v;if(t==="resume-stream"){let _=await this.transport.reconnectToStream({chatId:this.id,metadata:e,headers:a,body:r});if(_==null){this.setStatus({status:"ready"});return}v=_}else v=await this.transport.sendMessages({chatId:this.id,messages:this.state.messages,abortSignal:g.abortController.signal,metadata:e,headers:a,body:r,trigger:t,messageId:s});await Us({stream:rd({stream:v,onToolCall:this.onToolCall,onData:this.onData,messageMetadataSchema:this.messageMetadataSchema,dataPartSchemas:this.dataPartSchemas,runUpdateMessageJob:_=>this.jobExecutor.run(()=>_({state:g.state,write:()=>{var f;this.setStatus({status:"streaming"}),g.state.message.id===((f=this.lastMessage)==null?void 0:f.id)?this.state.replaceMessage(this.state.messages.length-1,g.state.message):this.state.pushMessage(g.state.message)}})),onError:_=>{throw _}}),onError:_=>{throw _}}),this.setStatus({status:"ready"})}catch(g){if(o||g.name==="AbortError")return o=!0,this.setStatus({status:"ready"}),null;d=!0,g instanceof TypeError&&(g.message.toLowerCase().includes("fetch")||g.message.toLowerCase().includes("network"))&&(l=!0),this.onError&&g instanceof Error&&this.onError(g),this.setStatus({status:"error",error:g})}finally{try{(n=this.onFinish)==null||n.call(this,{message:this.activeResponse.state.message,messages:this.state.messages,isAbort:o,isDisconnect:l,isError:d})}catch(g){console.error(g)}this.activeResponse=void 0}(u=this.sendAutomaticallyWhen)!=null&&u.call(this,{messages:this.state.messages})&&await this.makeRequest({trigger:"submit-message",messageId:(c=this.lastMessage)==null?void 0:c.id,metadata:e,headers:a,body:r})}},Td=T({type:k("text"),text:m(),state:Xt(["streaming","done"]).optional(),providerMetadata:F.optional()}),Ed=T({type:k("reasoning"),text:m(),state:Xt(["streaming","done"]).optional(),providerMetadata:F.optional()}),Sd=T({type:k("source-url"),sourceId:m(),url:m(),title:m().optional(),providerMetadata:F.optional()}),Ad=T({type:k("source-document"),sourceId:m(),mediaType:m(),title:m(),filename:m().optional(),providerMetadata:F.optional()}),Od=T({type:k("file"),mediaType:m(),filename:m().optional(),url:m(),providerMetadata:F.optional()}),Nd=T({type:k("step-start")}),Rd=T({type:m().startsWith("data-"),id:m().optional(),data:re()}),Md=[T({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("input-streaming"),input:re().optional(),output:ke().optional(),errorText:ke().optional()}),T({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("input-available"),input:re(),output:ke().optional(),errorText:ke().optional(),callProviderMetadata:F.optional()}),T({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("output-available"),input:re(),output:re(),errorText:ke().optional(),callProviderMetadata:F.optional(),preliminary:ae().optional()}),T({type:k("dynamic-tool"),toolName:m(),toolCallId:m(),state:k("output-error"),input:re(),output:ke().optional(),errorText:m(),callProviderMetadata:F.optional()})],jd=[T({type:m().startsWith("tool-"),toolCallId:m(),state:k("input-streaming"),input:re().optional(),output:ke().optional(),errorText:ke().optional()}),T({type:m().startsWith("tool-"),toolCallId:m(),state:k("input-available"),input:re(),output:ke().optional(),errorText:ke().optional(),callProviderMetadata:F.optional()}),T({type:m().startsWith("tool-"),toolCallId:m(),state:k("output-available"),input:re(),output:re(),errorText:ke().optional(),callProviderMetadata:F.optional(),preliminary:ae().optional()}),T({type:m().startsWith("tool-"),toolCallId:m(),state:k("output-error"),input:re(),output:ke().optional(),errorText:m(),callProviderMetadata:F.optional()})];T({id:m(),role:Xt(["system","user","assistant"]),metadata:re().optional(),parts:Ce(le([Td,Ed,Sd,Ad,Od,Nd,Rd,...Md,...jd]))});var Pd=Vn(((t,e)=>{function a(r,s){if(typeof r!="function")throw TypeError(`Expected the first argument to be a \`function\`, got \`${typeof r}\`.`);let n,i=0;return function(...o){clearTimeout(n);let l=Date.now(),d=s-(l-i);d<=0?(i=l,r.apply(this,o)):n=setTimeout(()=>{i=Date.now(),r.apply(this,o)},d)}}e.exports=a})),Bs=Object.prototype.hasOwnProperty;function sr(t,e){var a,r;if(t===e)return!0;if(t&&e&&(a=t.constructor)===e.constructor){if(a===Date)return t.getTime()===e.getTime();if(a===RegExp)return t.toString()===e.toString();if(a===Array){if((r=t.length)===e.length)for(;r--&&sr(t[r],e[r]););return r===-1}if(!a||typeof t=="object"){for(a in r=0,t)if(Bs.call(t,a)&&++r&&!Bs.call(e,a)||!(a in e)||!sr(t[a],e[a]))return!1;return Object.keys(e).length===r}}return t!==t&&e!==e}var R=ct(Kn(),1),Ye=new WeakMap,ht=()=>{},me=void 0,wa=Object,z=t=>t===me,Re=t=>typeof t=="function",Ge=(t,e)=>({...t,...e}),Ws=t=>Re(t.then),nr={},ka={},ir="undefined",Ft=typeof window!=ir,or=typeof document!=ir,Zd=Ft&&"Deno"in window,$d=()=>Ft&&typeof window.requestAnimationFrame!=ir,qs=(t,e)=>{let a=Ye.get(t);return[()=>!z(e)&&t.get(e)||nr,r=>{if(!z(e)){let s=t.get(e);e in ka||(ka[e]=s),a[5](e,Ge(s,r),s||nr)}},a[6],()=>!z(e)&&e in ka?ka[e]:!z(e)&&t.get(e)||nr]},lr=!0,Ld=()=>lr,[dr,ur]=Ft&&window.addEventListener?[window.addEventListener.bind(window),window.removeEventListener.bind(window)]:[ht,ht],Dd=()=>{let t=or&&document.visibilityState;return z(t)||t!=="hidden"},Fd=t=>(or&&document.addEventListener("visibilitychange",t),dr("focus",t),()=>{or&&document.removeEventListener("visibilitychange",t),ur("focus",t)}),zd=t=>{let e=()=>{lr=!0,t()},a=()=>{lr=!1};return dr("online",e),dr("offline",a),()=>{ur("online",e),ur("offline",a)}},Ud={isOnline:Ld,isVisible:Dd},Vd={initFocus:Fd,initReconnect:zd},Ks=!R.useId,zt=!Ft||Zd,Bd=t=>$d()?window.requestAnimationFrame(t):setTimeout(t,1),Ca=zt?R.useEffect:R.useLayoutEffect,cr=typeof navigator<"u"&&navigator.connection,Js=!zt&&cr&&(["slow-2g","2g"].includes(cr.effectiveType)||cr.saveData),Ia=new WeakMap,Wd=t=>wa.prototype.toString.call(t),pr=(t,e)=>t===`[object ${e}]`,qd=0,mr=t=>{let e=typeof t,a=Wd(t),r=pr(a,"Date"),s=pr(a,"RegExp"),n=pr(a,"Object"),i,o;if(wa(t)===t&&!r&&!s){if(i=Ia.get(t),i)return i;if(i=++qd+"~",Ia.set(t,i),Array.isArray(t)){for(i="@",o=0;o<t.length;o++)i+=mr(t[o])+",";Ia.set(t,i)}if(n){i="#";let l=wa.keys(t).sort();for(;!z(o=l.pop());)z(t[o])||(i+=o+":"+mr(t[o])+",");Ia.set(t,i)}}else i=r?t.toJSON():e=="symbol"?t.toString():e=="string"?JSON.stringify(t):""+t;return i},hr=t=>{if(Re(t))try{t=t()}catch{t=""}let e=t;return t=typeof t=="string"?t:(Array.isArray(t)?t.length:t)?mr(t):"",[t,e]},Kd=0,fr=()=>++Kd;async function Ys(...t){let[e,a,r,s]=t,n=Ge({populateCache:!0,throwOnError:!0},typeof s=="boolean"?{revalidate:s}:s||{}),i=n.populateCache,o=n.rollbackOnError,l=n.optimisticData,d=g=>typeof o=="function"?o(g):o!==!1,u=n.throwOnError;if(Re(a)){let g=a,v=[],_=e.keys();for(let f of _)!/^\$(inf|sub)\$/.test(f)&&g(e.get(f)._k)&&v.push(f);return Promise.all(v.map(c))}return c(a);async function c(g){let[v]=hr(g);if(!v)return;let[_,f]=qs(e,v),[p,h,b,C]=Ye.get(e),A=()=>{let Q=p[v];return(Re(n.revalidate)?n.revalidate(_().data,g):n.revalidate!==!1)&&(delete b[v],delete C[v],Q&&Q[0])?Q[0](2).then(()=>_().data):_().data};if(t.length<3)return A();let O=r,L,D=!1,M=fr();h[v]=[M,0];let Y=!z(l),$=_(),K=$.data,ee=$._c,se=z(ee)?K:ee;if(Y&&(l=Re(l)?l(se,K):l,f({data:l,_c:se})),Re(O))try{O=O(se)}catch(Q){L=Q,D=!0}if(O&&Ws(O))if(O=await O.catch(Q=>{L=Q,D=!0}),M!==h[v][0]){if(D)throw L;return O}else D&&Y&&d(L)&&(i=!0,f({data:se,_c:me}));if(i&&(D||(Re(i)?f({data:i(O,se),error:me,_c:me}):f({data:O,error:me,_c:me}))),h[v][1]=fr(),Promise.resolve(A()).then(()=>{f({_c:me})}),D){if(u)throw L;return}return O}}var Gs=(t,e)=>{for(let a in t)t[a][0]&&t[a][0](e)},Hs=(t,e)=>{if(!Ye.has(t)){let a=Ge(Vd,e),r=Object.create(null),s=Ys.bind(me,t),n=ht,i=Object.create(null),o=(u,c)=>{let g=i[u]||[];return i[u]=g,g.push(c),()=>g.splice(g.indexOf(c),1)},l=(u,c,g)=>{t.set(u,c);let v=i[u];if(v)for(let _ of v)_(c,g)},d=()=>{if(!Ye.has(t)&&(Ye.set(t,[r,Object.create(null),Object.create(null),Object.create(null),s,l,o]),!zt)){let u=a.initFocus(setTimeout.bind(me,Gs.bind(me,r,0))),c=a.initReconnect(setTimeout.bind(me,Gs.bind(me,r,1)));n=()=>{u&&u(),c&&c(),Ye.delete(t)}}};return d(),[t,s,d,n]}return[t,Ye.get(t)[4]]},Jd=(t,e,a,r,s)=>{let n=a.errorRetryCount,i=s.retryCount,o=~~((Math.random()+.5)*(1<<(i<8?i:8)))*a.errorRetryInterval;!z(n)&&i>n||setTimeout(r,o,s)},Yd=sr,[gr,Gd]=Hs(new Map),Qs=Ge({onLoadingSlow:ht,onSuccess:ht,onError:ht,onErrorRetry:Jd,onDiscarded:ht,revalidateOnFocus:!0,revalidateOnReconnect:!0,revalidateIfStale:!0,shouldRetryOnError:!0,errorRetryInterval:Js?1e4:5e3,focusThrottleInterval:5*1e3,dedupingInterval:2*1e3,loadingTimeout:Js?5e3:3e3,compare:Yd,isPaused:()=>!1,cache:gr,mutate:Gd,fallback:{}},Ud),Xs=(t,e)=>{let a=Ge(t,e);if(e){let{use:r,fallback:s}=t,{use:n,fallback:i}=e;r&&n&&(a.use=r.concat(n)),s&&i&&(a.fallback=Ge(s,i))}return a},yr=(0,R.createContext)({}),Hd=t=>{let{value:e}=t,a=(0,R.useContext)(yr),r=Re(e),s=(0,R.useMemo)(()=>r?e(a):e,[r,a,e]),n=(0,R.useMemo)(()=>r?s:Xs(a,s),[r,a,s]),i=s&&s.provider,o=(0,R.useRef)(me);i&&!o.current&&(o.current=Hs(i(n.cache||gr),s));let l=o.current;return l&&(n.cache=l[0],n.mutate=l[1]),Ca(()=>{if(l)return l[2]&&l[2](),l[3]},[]),(0,R.createElement)(yr.Provider,Ge(t,{value:n}))},en=Ft&&window.__SWR_DEVTOOLS_USE__,Qd=en?window.__SWR_DEVTOOLS_USE__:[],Xd=()=>{en&&(window.__SWR_DEVTOOLS_REACT__=R.default)},eu=t=>Re(t[1])?[t[0],t[1],t[2]||{}]:[t[0],null,(t[1]===null?t[2]:t[1])||{}],tu=()=>Ge(Qs,(0,R.useContext)(yr)),au=Qd.concat(t=>(e,a,r)=>t(e,a&&((...s)=>{let[n]=hr(e),[,,,i]=Ye.get(gr);if(n.startsWith("$inf$"))return a(...s);let o=i[n];return z(o)?a(...s):(delete i[n],o)}),r)),ru=t=>function(...e){let a=tu(),[r,s,n]=eu(e),i=Xs(a,n),o=t,{use:l}=i,d=(l||[]).concat(au);for(let u=d.length;u--;)o=d[u](o);return o(r,s||i.fetcher||null,i)},su=(t,e,a)=>{let r=e[t]||(e[t]=[]);return r.push(a),()=>{let s=r.indexOf(a);s>=0&&(r[s]=r[r.length-1],r.pop())}};Xd();var nu=ct(qi(),1),vr=R.use||(t=>{switch(t.status){case"pending":throw t;case"fulfilled":return t.value;case"rejected":throw t.reason;default:throw t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}),t}}),_r={dedupe:!0},iu=(t,e,a)=>{let{cache:r,compare:s,suspense:n,fallbackData:i,revalidateOnMount:o,revalidateIfStale:l,refreshInterval:d,refreshWhenHidden:u,refreshWhenOffline:c,keepPreviousData:g}=a,[v,_,f,p]=Ye.get(r),[h,b]=hr(t),C=(0,R.useRef)(!1),A=(0,R.useRef)(!1),O=(0,R.useRef)(h),L=(0,R.useRef)(e),D=(0,R.useRef)(a),M=()=>D.current,Y=()=>M().isVisible()&&M().isOnline(),[$,K,ee,se]=qs(r,h),Q=(0,R.useRef)({}).current,J=z(i)?z(a.fallback)?me:a.fallback[h]:i,X=(W,V)=>{for(let ne in Q){let B=ne;if(B==="data"){if(!s(W[B],V[B])&&(!z(W[B])||!s(Ee,V[B])))return!1}else if(V[B]!==W[B])return!1}return!0},ce=(0,R.useMemo)(()=>{let W=!h||!e?!1:z(o)?M().isPaused()||n?!1:l!==!1:o,V=ie=>{let ve=Ge(ie);return delete ve._k,W?{isValidating:!0,isLoading:!0,...ve}:ve},ne=$(),B=se(),we=V(ne),ge=ne===B?we:V(B),oe=we;return[()=>{let ie=V($());return X(ie,oe)?(oe.data=ie.data,oe.isLoading=ie.isLoading,oe.isValidating=ie.isValidating,oe.error=ie.error,oe):(oe=ie,ie)},()=>ge]},[r,h]),te=(0,nu.useSyncExternalStore)((0,R.useCallback)(W=>ee(h,(V,ne)=>{X(ne,V)||W()}),[r,h]),ce[0],ce[1]),dt=!C.current,je=v[h]&&v[h].length>0,Te=te.data,fe=z(Te)?J&&Ws(J)?vr(J):J:Te,ze=te.error,Qe=(0,R.useRef)(fe),Ee=g?z(Te)?z(Qe.current)?fe:Qe.current:Te:fe,Ue=je&&!z(ze)?!1:dt&&!z(o)?o:M().isPaused()?!1:n?z(fe)?!1:l:z(fe)||l,Ve=!!(h&&e&&dt&&Ue),gt=z(te.isValidating)?Ve:te.isValidating,Ot=z(te.isLoading)?Ve:te.isLoading,Pe=(0,R.useCallback)(async W=>{let V=L.current;if(!h||!V||A.current||M().isPaused())return!1;let ne,B,we=!0,ge=W||{},oe=!f[h]||!ge.dedupe,ie=()=>Ks?!A.current&&h===O.current&&C.current:h===O.current,ve={isValidating:!1,isLoading:!1},We=()=>{K(ve)},ut=()=>{let pe=f[h];pe&&pe[1]===B&&delete f[h]},qe={isValidating:!0};z($().data)&&(qe.isLoading=!0);try{if(oe&&(K(qe),a.loadingTimeout&&z($().data)&&setTimeout(()=>{we&&ie()&&M().onLoadingSlow(h,a)},a.loadingTimeout),f[h]=[V(b),fr()]),[ne,B]=f[h],ne=await ne,oe&&setTimeout(ut,a.dedupingInterval),!f[h]||f[h][1]!==B)return oe&&ie()&&M().onDiscarded(h),!1;ve.error=me;let pe=_[h];if(!z(pe)&&(B<=pe[0]||B<=pe[1]||pe[1]===0))return We(),oe&&ie()&&M().onDiscarded(h),!1;let _e=$().data;ve.data=s(_e,ne)?_e:ne,oe&&ie()&&M().onSuccess(ne,h,a)}catch(pe){ut();let _e=M(),{shouldRetryOnError:Xe}=_e;_e.isPaused()||(ve.error=pe,oe&&ie()&&(_e.onError(pe,h,_e),(Xe===!0||Re(Xe)&&Xe(pe))&&(!M().revalidateOnFocus||!M().revalidateOnReconnect||Y())&&_e.onErrorRetry(pe,h,_e,et=>{let Ze=v[h];Ze&&Ze[0]&&Ze[0](3,et)},{retryCount:(ge.retryCount||0)+1,dedupe:!0})))}return we=!1,We(),!0},[h,r]),Be=(0,R.useCallback)((...W)=>Ys(r,O.current,...W),[]);if(Ca(()=>{L.current=e,D.current=a,z(Te)||(Qe.current=Te)}),Ca(()=>{if(!h)return;let W=Pe.bind(me,_r),V=0;M().revalidateOnFocus&&(V=Date.now()+M().focusThrottleInterval);let ne=su(h,v,(B,we={})=>{if(B==0){let ge=Date.now();M().revalidateOnFocus&&ge>V&&Y()&&(V=ge+M().focusThrottleInterval,W())}else if(B==1)M().revalidateOnReconnect&&Y()&&W();else{if(B==2)return Pe();if(B==3)return Pe(we)}});return A.current=!1,O.current=h,C.current=!0,K({_k:b}),Ue&&(f[h]||(z(fe)||zt?W():Bd(W))),()=>{A.current=!0,ne()}},[h]),Ca(()=>{let W;function V(){let B=Re(d)?d($().data):d;B&&W!==-1&&(W=setTimeout(ne,B))}function ne(){!$().error&&(u||M().isVisible())&&(c||M().isOnline())?Pe(_r).then(V):V()}return V(),()=>{W&&(W=(clearTimeout(W),-1))}},[d,u,c,h]),(0,R.useDebugValue)(Ee),n&&z(fe)&&h){if(!Ks&&zt)throw Error("Fallback data is required when using Suspense in SSR.");L.current=e,D.current=a,A.current=!1;let W=p[h];if(z(W)||vr(Be(W)),z(ze)){let V=Pe(_r);z(Ee)||(V.status="fulfilled",V.value=!0),vr(V)}else throw ze}return{mutate:Be,get data(){return Q.data=!0,Ee},get error(){return Q.error=!0,ze},get isValidating(){return Q.isValidating=!0,gt},get isLoading(){return Q.isLoading=!0,Ot}}};wa.defineProperty(Hd,"defaultValue",{value:Qs});var tn=ru(iu),ou=ct(Pd(),1),an=(t,e,a)=>{if(!e.has(t))throw TypeError("Cannot "+a)},H=(t,e,a)=>(an(t,e,"read from private field"),a?a.call(t):e.get(t)),Fe=(t,e,a)=>{if(e.has(t))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(t):e.set(t,a)},ot=(t,e,a,r)=>(an(t,e,"write to private field"),r?r.call(t,a):e.set(t,a),a);function rn(t,e){return e==null?t:(0,ou.default)(t,e)}var Ie,Ta,Ea,Ut,Vt,Bt,St,br,xr,lu=class{constructor(t=[]){Fe(this,Ie,void 0),Fe(this,Ta,"ready"),Fe(this,Ea,void 0),Fe(this,Ut,new Set),Fe(this,Vt,new Set),Fe(this,Bt,new Set),this.pushMessage=e=>{ot(this,Ie,H(this,Ie).concat(e)),H(this,St).call(this)},this.popMessage=()=>{ot(this,Ie,H(this,Ie).slice(0,-1)),H(this,St).call(this)},this.replaceMessage=(e,a)=>{ot(this,Ie,[...H(this,Ie).slice(0,e),this.snapshot(a),...H(this,Ie).slice(e+1)]),H(this,St).call(this)},this.snapshot=e=>structuredClone(e),this["~registerMessagesCallback"]=(e,a)=>{let r=a?rn(e,a):e;return H(this,Ut).add(r),()=>{H(this,Ut).delete(r)}},this["~registerStatusCallback"]=e=>(H(this,Vt).add(e),()=>{H(this,Vt).delete(e)}),this["~registerErrorCallback"]=e=>(H(this,Bt).add(e),()=>{H(this,Bt).delete(e)}),Fe(this,St,()=>{H(this,Ut).forEach(e=>e())}),Fe(this,br,()=>{H(this,Vt).forEach(e=>e())}),Fe(this,xr,()=>{H(this,Bt).forEach(e=>e())}),ot(this,Ie,t)}get status(){return H(this,Ta)}set status(t){ot(this,Ta,t),H(this,br).call(this)}get error(){return H(this,Ea)}set error(t){ot(this,Ea,t),H(this,xr).call(this)}get messages(){return H(this,Ie)}set messages(t){ot(this,Ie,[...t]),H(this,St).call(this)}};Ie=new WeakMap,Ta=new WeakMap,Ea=new WeakMap,Ut=new WeakMap,Vt=new WeakMap,Bt=new WeakMap,St=new WeakMap,br=new WeakMap,xr=new WeakMap;var At,sn=class extends Id{constructor({messages:t,...e}){let a=new lu(t);super({...e,state:a}),Fe(this,At,void 0),this["~registerMessagesCallback"]=(r,s)=>H(this,At)["~registerMessagesCallback"](r,s),this["~registerStatusCallback"]=r=>H(this,At)["~registerStatusCallback"](r),this["~registerErrorCallback"]=r=>H(this,At)["~registerErrorCallback"](r),ot(this,At,a)}};At=new WeakMap;function nn({experimental_throttle:t,resume:e=!1,...a}={}){let r=(0,R.useRef)("chat"in a?a.chat:new sn(a));("chat"in a&&a.chat!==r.current||"id"in a&&r.current.id!==a.id)&&(r.current="chat"in a?a.chat:new sn(a));let s=(0,R.useSyncExternalStore)((0,R.useCallback)(l=>r.current["~registerMessagesCallback"](l,t),[t,"id"in a?a.id:null]),()=>r.current.messages,()=>r.current.messages),n=(0,R.useSyncExternalStore)(r.current["~registerStatusCallback"],()=>r.current.status,()=>r.current.status),i=(0,R.useSyncExternalStore)(r.current["~registerErrorCallback"],()=>r.current.error,()=>r.current.error),o=(0,R.useCallback)(l=>{typeof l=="function"&&(l=l(r.current.messages)),r.current.messages=l},[r]);return(0,R.useEffect)(()=>{e&&r.current.resumeStream()},[e,r]),{id:r.current.id,messages:s,setMessages:o,sendMessage:r.current.sendMessage,regenerate:r.current.regenerate,clearError:r.current.clearError,stop:r.current.stop,error:i,resumeStream:r.current.resumeStream,status:n,addToolResult:r.current.addToolResult}}function du({api:t="/api/completion",id:e,initialCompletion:a="",initialInput:r="",credentials:s,headers:n,body:i,streamProtocol:o="data",fetch:l,onFinish:d,onError:u,experimental_throttle:c}={}){let g=(0,R.useId)(),v=e||g,{data:_,mutate:f}=tn([t,v],null,{fallbackData:a}),{data:p=!1,mutate:h}=tn([v,"loading"],null),[b,C]=(0,R.useState)(void 0),A=_,[O,L]=(0,R.useState)(null),D=(0,R.useRef)({credentials:s,headers:n,body:i});(0,R.useEffect)(()=>{D.current={credentials:s,headers:n,body:i}},[s,n,i]);let M=(0,R.useCallback)(async(J,X)=>wd({api:t,prompt:J,credentials:D.current.credentials,headers:{...D.current.headers,...X==null?void 0:X.headers},body:{...D.current.body,...X==null?void 0:X.body},streamProtocol:o,fetch:l,setCompletion:rn(ce=>f(ce,!1),c),setLoading:h,setError:C,setAbortController:L,onFinish:d,onError:u}),[f,h,t,D,L,d,u,C,o,l,c]),Y=(0,R.useCallback)(()=>{O&&(O.abort(),L(null))},[O]),$=(0,R.useCallback)(J=>{f(J,!1)},[f]),K=(0,R.useCallback)(async(J,X)=>M(J,X),[M]),[ee,se]=(0,R.useState)(r),Q=(0,R.useCallback)(J=>{var X;return(X=J==null?void 0:J.preventDefault)==null||X.call(J),ee?K(ee):void 0},[ee,K]);return{completion:A,complete:K,error:b,setCompletion:$,stop:Y,input:ee,setInput:se,handleInputChange:(0,R.useCallback)(J=>{se(J.target.value)},[se]),handleSubmit:Q,isLoading:p}}var Wt=class extends Error{constructor(t,e="TOOL_ERROR",a=!1,r,s){super(t),this.name="ToolExecutionError",this.code=e,this.isRetryable=a,this.suggestedFix=r,this.meta=s}toStructuredString(){let t=JSON.stringify({message:this.message,code:this.code,is_retryable:this.isRetryable,suggested_fix:this.suggestedFix,meta:this.meta??{}});return`Error invoking tool ${this.name}: ${t}`}};const on=T({status:Xt(["success","error","warning"]).optional(),auth_required:ae().optional(),next_steps:Ce(m()).optional(),action_url:m().optional(),message:m().optional(),meta:Nt(m(),re()).optional()});function uu(t,e){return t?!!(["image/","video/","audio/","application/pdf"].some(a=>t.startsWith(a))||["svg","vega"].some(a=>t.includes(a))||t==="text/html"&&["<img","<video","<audio","<iframe","<canvas","<svg","<marimo-ui-element"].some(a=>e.includes(a))):!1}var cu=class extends Mt{constructor(e){super();P(this,"title","Cell Outputs");P(this,"mentionPrefix","@");P(this,"contextType","cell-output");this.store=e}getItems(){let e=this.store.get(at),a=[];for(let r of e.cellIds.inOrderIds){let s=dn(r,e),n=s.cellOutput;if(!n)continue;let i=n.output.mimetype||"unknown";a.push({uri:this.asURI(r),name:s.cellName,type:this.contextType,description:`Cell output (${i})`,data:{...s,cellOutput:n}})}return a}formatCompletion(e){let{cellOutput:a,cellName:r,cellCode:s}=e.data;return{label:`@${r}`,displayLabel:r,detail:`${a.outputType} output`,boost:a.outputType==="media"?wt.HIGH:wt.MEDIUM,type:this.contextType,section:xt.CELL_OUTPUT,apply:`@${r}`,info:()=>{let n=document.createElement("div");n.classList.add("mo-cm-tooltip","docs-documentation","min-w-[300px]","max-w-[500px]","flex","flex-col","gap-2");let i=document.createElement("div");i.classList.add("flex","flex-col","gap-1");let o=document.createElement("div");o.classList.add("font-bold","text-base"),o.textContent=r,i.append(o);let l=document.createElement("div");if(l.classList.add("text-sm","text-muted-foreground"),i.append(l),n.append(i),s){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground"),d.textContent="Code:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","font-mono","bg-muted","p-2","rounded","max-h-20","overflow-y-auto"),u.textContent=s.slice(0,200)+(s.length>200?"...":""),n.append(u)}if(a.processedContent){let d=document.createElement("div");d.classList.add("text-xs","font-medium","text-muted-foreground","mt-2"),d.textContent="Output Preview:",n.append(d);let u=document.createElement("div");u.classList.add("text-xs","bg-muted","p-2","rounded","max-h-24","overflow-y-auto","mb-2"),u.textContent=a.processedContent.slice(0,300)+(a.processedContent.length>300?"...":""),n.append(u)}if(a.outputType==="media"){let d=document.createElement("div");d.classList.add("text-xs","text-muted-foreground","italic","mb-2"),d.textContent="A screenshot of the output will be attached",n.append(d)}return n}}}formatContext(e){let{cellOutput:a,cellName:r,cellId:s,cellCode:n}=e.data,i={name:r,cellId:s,outputType:a.outputType,mimetype:a.output.mimetype},o=`Cell Code:
${n}

`;return a.outputType==="text"&&a.processedContent?o+=`Output:
${a.processedContent}`:a.outputType==="media"&&(o+=`Media Output: Contains ${a.output.mimetype} content`,a.imageUrl&&(o+=`
Image URL: ${a.imageUrl}`)),Rt({type:this.contextType,data:i,details:o})}async getAttachments(e){let a=e[0].data.cellId,r=e[0].data.cellName;return pu(e.map(s=>s.data.cellOutput),a,r)}};async function pu(t,e,a){let r=t.filter(n=>n.shouldDownloadImage&&n.outputType==="media");if(r.length===0)return[];let s=r.flatMap(n=>{let i=document.getElementById(di.create(e));return i?{cellId:e,cellName:a,mimetype:n.output.mimetype,element:i}:(ue.warn(`Output element not found for cell ${e}`),[])});try{return await Promise.all(s.map(async n=>({type:"file",filename:`${a}-output-screenshot`,mediaType:"image/png",url:await Gi(n.element)})))}catch(n){return ue.error("Error downloading cell output images:",n),[]}}function ln(t){if(Gr(t))return null;let e=t.mimetype,a=uu(e,String(t.data))?"media":"text",r,s,n=!1;return a==="text"&&typeof t.data=="string"&&(r=e==="text/html"?Hi(t.data):t.data),a==="media"&&(typeof t.data=="string"&&t.data.startsWith("data:")||typeof t.data=="string"&&t.data.startsWith("http")?s=t.data:n=!0),{processedContent:r,imageUrl:s,shouldDownloadImage:n,outputType:a,output:t}}function dn(t,e,a){let{includeConsoleOutput:r=!1}=a||{},s=e.cellRuntime[t],n=e.cellData[t],i=e.cellIds.inOrderIds.indexOf(t),o=ni(n.name,i),l;r&&(l=s.consoleOutputs.map(c=>ln(c)).filter(c=>c!==null));let d,u=s.output;return u&&!Gr(u)&&(d=ln(u)??void 0),{cellId:t,cellName:o,cellCode:n.code,cellOutput:d,consoleOutputs:l}}function mu(t){return t.type==="setup-refs"?"The setup cell cannot have references":t.type==="cycle"?"This cell is in a cycle":t.type==="multiple-defs"?`The variable '${t.name}' was defined by another cell`:t.type==="import-star"||t.type==="ancestor-stopped"||t.type==="ancestor-prevented"||t.type==="exception"||t.type==="strict-exception"?t.msg:t.type==="interruption"?"This cell was interrupted and needs to be re-run":t.type==="syntax"||t.type==="unknown"||t.type==="sql-error"?t.msg:t.type==="internal"?t.msg||"An internal error occurred":(Bi(t),"Unknown error")}var un=new Xn("error","errors"),hu=class extends Mt{constructor(e){super();P(this,"title","Errors");P(this,"mentionPrefix","@");P(this,"contextType","error");this.store=e}getItems(){let e=this.store.get(oi);return e.length===0?[]:[{uri:this.asURI("all"),name:"Errors",type:this.contextType,data:{type:"all-errors",errors:e.map(a=>({cellId:a.cellId,cellName:a.cellName,errorData:a.output.data}))},description:"All errors in the notebook"}]}formatCompletion(e){return e.data.type==="all-errors"?{label:"@Errors",displayLabel:"Errors",detail:`${e.data.errors.length} ${un.pluralize(e.data.errors.length)}`,type:"error",apply:"@Errors",section:xt.ERROR,info:()=>{let a=document.createElement("div");a.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let r=document.createElement("div");r.classList.add("flex","flex-col","gap-1");let s=document.createElement("div");s.classList.add("font-bold","text-base"),s.textContent="Errors",r.append(s);let n=document.createElement("div");return n.classList.add("text-sm","text-muted-foreground"),n.textContent=`${e.data.errors.length} ${un.pluralize(e.data.errors.length)}`,r.append(n),a.append(r),a}}:{label:"Error",displayLabel:"Error",section:xt.ERROR}}formatContext(e){let{data:a}=e;return a.errors.map(r=>Rt({type:this.contextType,data:{name:r.cellName||`Cell ${r.cellId}`,description:r.errorData.map(s=>mu(s)).join(`
`)}})).join(`

`)}};const cn=ii();var fu={maxDepth:3,maxResults:20,defaultResultsLimit:5,includeDirectories:!1},gu=class extends Mt{constructor(e,a=fu){super();P(this,"title","Files");P(this,"mentionPrefix","#");P(this,"contextType","file");P(this,"searchFiles",async(e,a={})=>{let{maxDepth:r,maxResults:s,includeDirectories:n}={...this.config,...a};return(await this.apiRequests.sendSearchFiles({query:e,includeFiles:!0,includeDirectories:n,depth:r,limit:s})).files});this.apiRequests=e,this.config=a}createCompletionSource(){return async e=>{let a=e.matchBefore(/#[^\s#]*/);if(!a)return null;let r=a.text;if(!r.startsWith("#"))return null;let s=r.slice(1);if(s.length===0)return this.getDefaultCompletions(a);try{let n=(await this.searchFiles(s)||[]).map(i=>{let o={uri:this.asURI(i.path),name:i.name,type:this.contextType,description:i.isDirectory?"Directory":"File",data:{path:i.path,isDirectory:i.isDirectory}};return this.formatCompletion(o)});return{from:a.from,options:n}}catch(n){return ue.error("Failed to search files:",n),null}}}async getDefaultCompletions(e){try{for(let a of["py","md","csv"])try{let r=await this.searchFiles(a,{maxDepth:1,maxResults:5});if(r&&r.length>0){let s=r.map(n=>{let i={uri:this.asURI(n.path),name:n.name,type:this.contextType,description:n.isDirectory?"Directory":"File",data:{path:n.path,isDirectory:n.isDirectory}};return this.formatCompletion(i)});return{from:e.from,options:s}}}catch(r){ue.error("Failed to get default file completions:",r)}return{from:e.from,options:[]}}catch(a){return ue.error("Failed to get default file completions:",a),null}}getItems(){return[]}formatCompletion(e){let{data:a,name:r}=e,s=a.isDirectory?"\u{1F4C1}":"\u{1F4C4}";return{...this.createBasicCompletion(e),type:"file",section:xt.FILE,boost:a.isDirectory?wt.MEDIUM:wt.LOW,detail:a.path,displayLabel:`${s} ${r}`,apply:async(n,i,o,l)=>{var v;let d=(v=n.state.facet(cn))==null?void 0:v.addAttachment;if(!d){ue.warn("No addAttachment callback provided");return}let u=await this.apiRequests.sendFileDetails({path:a.path}).catch(_=>(Jr({title:"Failed to get file details",description:_.message}),null));if(!u)return;let c=u.mimeType||"text/plain",g;if(c.startsWith("text/")||c.includes("json")||c.includes("xml"))g=new Blob([u.contents||""],{type:c});else if(u.contents)try{g=await Qi(Mi(u.contents,c))}catch{g=new Blob([u.contents],{type:c})}else g=new Blob([""],{type:c});d(new File([g],r,{type:c})),n.dispatch({changes:{from:o,to:l,insert:""}}),Ei(n)},info:()=>{let n=document.createElement("div");n.classList.add("flex","flex-col","gap-1","p-2");let i=document.createElement("div");i.classList.add("font-bold"),i.textContent=r,n.append(i);let o=document.createElement("div");return o.classList.add("text-xs","text-muted-foreground"),o.textContent=a.path,n.append(o),n}}}formatContext(e){let{data:a,name:r}=e;return Rt({type:this.contextType,data:{name:r,path:a.path,isDirectory:a.isDirectory},details:a.isDirectory?"Directory containing files and subdirectories":"File"})}},yu=class extends Mt{constructor(e){super();P(this,"title","Tables");P(this,"mentionPrefix","@");P(this,"contextType","data");this.tablesMap=e}getItems(){return[...this.tablesMap.entries()].map(([e,a])=>({uri:this.asURI(e),name:e,type:this.contextType,description:a.source==="memory"?"in-memory":a.source,data:a}))}formatContext(e){let{data:a}=e,{columns:r,source:s,num_rows:n,num_columns:i,name:o,variable_name:l}=a,d=[n==null?void 0:`${n} rows`,i==null?void 0:`${i} columns`].filter(Boolean).join(", "),u="";if(d&&(u+=`Shape: ${d}
`),l&&(u+=`Variable: ${l}
`),r&&r.length>0){u+=`Columns:
`;for(let c of r){let g=`  ${c.name} (${c.type})`;if(c.sample_values&&c.sample_values.length>0){let v=c.sample_values.slice(0,3).map(_=>_===null?"null":String(_)).join(", ");g+=` - samples: [${v}]`}u+=`${g}
`}}return Rt({type:this.contextType,data:{name:o,source:s??"unknown"},details:u.trim()})}formatCompletion(e){let a=e.data.name,r=e.data;return{label:`@${a}`,displayLabel:a,detail:r.source==="memory"?"in-memory":r.source,boost:r.source_type==="local"?wt.LOCAL_TABLE:wt.REMOTE_TABLE,type:Zr(r),apply:`@${a}`,section:{name:Zr(r)==="dataframe"?"Dataframe":"Table",rank:xt.TABLE.rank},info:()=>this.createTableInfoElement(a,r)}}createTableInfoElement(e,a){let r=document.createElement("div");r.classList.add("mo-cm-tooltip","docs-documentation","min-w-[200px]","flex","flex-col","gap-1","p-2");let s=document.createElement("div");s.classList.add("flex","flex-col","gap-1");let n=document.createElement("div");if(n.classList.add("font-bold","text-base"),n.textContent=e,s.append(n),a.source){let o=document.createElement("div");o.classList.add("text-xs","text-muted-foreground"),o.textContent=`Source: ${a.source}`,s.append(o)}r.append(s);let i=[a.num_rows==null?void 0:`${a.num_rows} rows`,a.num_columns==null?void 0:`${a.num_columns} columns`].filter(Boolean).join(", ");if(i){let o=document.createElement("div");o.classList.add("text-xs","bg-muted","px-2","py-1","rounded"),o.textContent=i,r.append(o)}if(a.columns&&a.columns.length>0){let o=document.createElement("div");o.classList.add("overflow-auto","max-h-60");let l=document.createElement("table");l.classList.add("w-full","text-xs","border-collapse");let d=l.insertRow();d.classList.add("bg-muted");let u=d.insertCell();u.classList.add("p-2","font-medium","text-left"),u.textContent="Column";let c=d.insertCell();c.classList.add("p-2","font-medium","text-left"),c.textContent="Type";let g=a.columns.some(_=>this.getItemMetadata(a,_)!==void 0),v;g&&(v=d.insertCell(),v.classList.add("p-2","font-medium","text-left"),v.textContent="Metadata"),a.columns.forEach((_,f)=>{let p=l.insertRow();p.classList.add(f%2==0?"bg-background":"bg-muted/30");let h=p.insertCell();h.classList.add("p-2","font-mono"),h.textContent=_.name;let b=p.insertCell();if(b.classList.add("p-2","text-muted-foreground"),b.textContent=_.type,g){let C=p.insertCell();C.classList.add("p-2");let A=this.getItemMetadata(a,_);A&&C.append(A)}}),o.append(l),r.append(o)}return r}getItemMetadata(e,a){var n,i;let r=(n=e.primary_keys)==null?void 0:n.includes(a.name),s=(i=e.indexes)==null?void 0:i.includes(a.name);if(r||s){let o=document.createElement("span");o.textContent=r?"PK":"IDX";let l=r?"bg-blue-100 text-blue-800 dark:bg-blue-900 dark:text-blue-200":"bg-amber-100 text-amber-800 dark:bg-amber-900 dark:text-amber-200";return o.classList.add("text-xs","px-1.5","py-0.5","rounded-full","font-medium",...l.split(" ")),o}}},vu=class extends Mt{constructor(e,a){super();P(this,"title","Variables");P(this,"mentionPrefix","@");P(this,"contextType","variable");this.variables=e,this.tablesMap=a}getItems(){let e=new Set(this.tablesMap.keys());return Object.entries(this.variables).flatMap(([a,r])=>e.has(a)?[]:[{uri:this.asURI(a),name:a,type:this.contextType,description:r.dataType??"",dataType:r.dataType,data:{variable:r}}])}formatCompletion(e){let{data:a}=e,{variable:r}=a;return{label:`@${r.name}`,displayLabel:r.name,detail:r.dataType??"",type:this.contextType,section:xt.VARIABLE,info:()=>ai(r)}}formatContext(e){let{data:a}=e,{variable:r}=a;return Rt({type:this.contextType,data:{name:r.name,dataType:r.dataType},details:r.value==null?void 0:JSON.stringify(r.value)})}};function ft(t){let e=t.get(ei),a=t.get(Gn),r=t.get(ti);return new Ui().register(new yu(a)).register(new vu(r,a)).register(new hu(t)).register(new cu(t)).register(new Vi(e.connectionsMap,a))}function _u(){return new gu(Ci())}const bu="@";function xu({input:t}){let e="";return t.includes("@")&&(e=ku(t),ue.debug("Included context",e)),{includeOtherCode:Dr(""),context:{plainText:e,schema:[],variables:[]}}}async function wu({input:t}){let e="",a=[];if(t.includes("@")){let r=ft(Mr),s=r.parseAllContextIds(t);e=r.formatContextForAI(s);try{a=await r.getAttachmentsForContext(s),ue.debug("Included attachments",a.length)}catch(n){ue.error("Error getting attachments:",n)}}return{body:{includeOtherCode:Dr(""),context:{plainText:e,schema:[],variables:[]}},attachments:a}}function ku(t){let e=ft(Mr),a=e.parseAllContextIds(t);return e.formatContextForAI(a)}function Cu(t,e=[]){return a=>{let r=t.map(s=>a.matchBefore(s)).find(Boolean);return!r||r&&r.from===r.to&&!a.explicit?null:{from:r==null?void 0:r.from,options:[...e]}}}function Iu(t){var e;if((e=t.current)!=null&&e.view){let a=t.current.view.state.selection.main.from;t.current.view.dispatch({changes:{from:a,to:a,insert:"@"},selection:{anchor:a+1,head:a+1}}),t.current.view.focus(),Ii(t.current.view)}}function Tu(t){if(t.trim().length===0)return[];if(!t.includes("```"))return[{language:"python",code:t}];let e=[],a=0,r=t.indexOf("```",a);for(;r!==-1;){let s=t.indexOf(`
`,r);if(s===-1){let d=t.slice(r+3),u=d.indexOf(" "),c=u===-1?d:d.slice(0,u),g=c==="markdown"?"markdown":c==="sql"?"sql":"python",v=u===-1?"":d.slice(u+1);v.trim()&&e.push({language:g,code:v.trim()});break}let n=t.slice(r+3,s).trim()||"";n=n==="markdown"?"markdown":n==="sql"?"sql":"python";let i=s+1,o=t.indexOf("```",i);if(o===-1){let d=t.slice(i).replace(/\n+$/,"");d.trim()&&e.push({language:n,code:d});break}let l=t.slice(i,o).replace(/\n+$/,"");l.trim()&&e.push({language:n,code:l}),a=o+3,r=t.indexOf("```",a)}return e.length===0&&e.push({language:"python",code:t}),e}var Eu=ct(Ra(),1),pn=()=>new Map,{valueAtom:qt,useActions:mn,createActions:lp,reducer:dp}=wi(pn,{addStagedCell:(t,e)=>{let{cellId:a,edit:r}=e;return new Map([...t,[a,r]])},removeStagedCell:(t,e)=>{let a=new Map(t);return a.delete(e),a},clearStagedCells:()=>pn()});function hn(t){let e=(0,Eu.c)(26),{addStagedCell:a,removeStagedCell:r,clearStagedCells:s}=mn(),{createNewCell:n}=Pr(),i=Xi(),o=(0,R.useRef)(null),l;e[0]!==a||e[1]!==n?(l=C=>{let A=$r.create();return a({cellId:A,edit:{type:"add_cell"}}),n({cellId:"__end__",code:C,before:!1,newCellId:A}),A},e[0]=a,e[1]=n,e[2]=l):l=e[2];let d=l,u;e[3]===t?u=e[4]:(u=C=>{let{cellId:A,code:O}=C;if(!t.get(qt).has(A)){ue.error("Staged cell not found",{cellId:A});return}let L=li(A);if(!L){ue.error("Editor for this cell not found",{cellId:A});return}Lr(L,O)},e[3]=t,e[4]=u);let c=u,g;e[5]!==i||e[6]!==r?(g=C=>{r(C),i({cellId:C})},e[5]=i,e[6]=r,e[7]=g):g=e[7];let v=g,_;e[8]!==s||e[9]!==i||e[10]!==t?(_=()=>{let C=t.get(qt);for(let A of C.keys())i({cellId:A});s()},e[8]=s,e[9]=i,e[10]=t,e[11]=_):_=e[11];let f=_,p;e[12]!==a||e[13]!==n||e[14]!==d||e[15]!==c?(p=C=>{e:switch(C.type){case"text-start":o.current=new Su(d,c,a,n);break e;case"text-delta":if(!o.current){ue.error("Cell creation stream not found");return}o.current.stream(C);break e;case"text-end":case"finish":if(!o.current){ue.error("Cell creation stream not found");return}o.current.stop();break e;default:ue.error("Unknown chunk type",{chunk:C})}},e[12]=a,e[13]=n,e[14]=d,e[15]=c,e[16]=p):p=e[16];let h=p,b;return e[17]!==a||e[18]!==s||e[19]!==d||e[20]!==f||e[21]!==v||e[22]!==h||e[23]!==r||e[24]!==c?(b={createStagedCell:d,updateStagedCell:c,addStagedCell:a,removeStagedCell:r,clearStagedCells:s,deleteStagedCell:v,deleteAllStagedCells:f,onStream:h},e[17]=a,e[18]=s,e[19]=d,e[20]=f,e[21]=v,e[22]=h,e[23]=r,e[24]=c,e[25]=b):b=e[25],b}var Su=class{constructor(t,e,a,r){P(this,"createdCells",[]);P(this,"buffer","");P(this,"hasMarimoImport",!1);this.onCreateCell=t,this.onUpdateCell=e,this.addStagedCell=a,this.createNewCell=r}stream(t){let e=t.delta;this.buffer+=e;let a=Tu(this.buffer);for(let[r,s]of a.entries())if(r<this.createdCells.length){this.addMarimoImport(s.language);let n=this.createdCells[r];this.createdCells[r]={...n,cell:s},this.onUpdateCell({cellId:n.cellId,code:s.code,language:s.language})}else{let n=this.onCreateCell(s.code);this.createdCells.push({cellId:n,cell:s})}}addMarimoImport(t){var a;if(this.hasMarimoImport||t==="python")return;let e=eo({autoInstantiate:!1,createNewCell:this.createNewCell,fromCellId:(a=this.createdCells[0])==null?void 0:a.cellId,before:!0});e&&this.addStagedCell({cellId:e,edit:{type:"add_cell"}}),this.hasMarimoImport=!0}stop(){this.buffer=""}},Au={baseDescription:"Perform editing operations on the current notebook. You should prefer to create new cells unless you need to edit existing cells. Call this tool multiple times to perform multiple edits. Separate code into logical individual cells to take advantage of the notebook's reactive execution model.",prerequisites:["If you are updating existing cells, you need the cellIds. If they are not known, call the lightweight_cell_map_tool to find out."],additionalInfo:`
  Args:
    edit (object): The editing operation to perform. Must be one of:
    - update_cell: Update the code of an existing cell, pass CellId and the new code.
    - add_cell: Add a new cell to the notebook. The position of the new cell is specified by the position argument.
        Pass "end" to add the new cell at the end of the notebook. 
        Pass { cellId: cellId, before: true } to add the new cell before the specified cell. And before: false if after the specified cell.
        Pass { type: "end", columnIndex: number } to add the new cell at the end of a specified column index. The column index is 0-based.
    - delete_cell: Delete an existing cell, pass CellId. For deleting cells, the user needs to accept the deletion to actually delete the cell, so you may still see the cell in the notebook on subsequent edits which is fine.

    For adding code, use the following guidelines:
    - Markdown cells: use mo.md(f"""{content}""") function to insert content.
    - SQL cells: use mo.sql(f"""{content}""") function to insert content. If a database engine is specified, use mo.sql(f"""{content}""", engine=engine) instead.

    Returns:
    - A result object containing standard tool metadata.`},Ou=T({edit:zr("type",[T({type:k("update_cell"),cellId:m(),code:m()}),T({type:k("add_cell"),position:le([T({cellId:m(),before:ae()}),T({type:k("end"),columnIndex:_t()}),k("end")]),code:m()}),T({type:k("delete_cell"),cellId:m()})])}),Nu=class{constructor(){P(this,"name","edit_notebook_tool");P(this,"description",Au);P(this,"schema",Ou);P(this,"outputSchema",on);P(this,"mode",["agent"]);P(this,"handler",async({edit:t},e)=>{let{addStagedCell:a,createNewCell:r,store:s}=e;switch(t.type){case"update_cell":{let{cellId:n,code:i}=t,o=s.get(at);this.validateCellIdExists(n,o);let l=this.getCellEditorView(n,o);ja(n);let d=s.get(qt).get(n),u=l.state.doc.toString();a({cellId:n,edit:{type:"update_cell",previousCode:(d==null?void 0:d.type)==="update_cell"||(d==null?void 0:d.type)==="delete_cell"?d.previousCode:u}}),Lr(l,i);break}case"add_cell":{let{position:n,code:i}=t,o="__end__",l=!1,d=$r.create();if(typeof n=="object"){let u=s.get(at);"cellId"in n?(this.validateCellIdExists(n.cellId,u),o=n.cellId,l=n.before):"columnIndex"in n&&(o={type:"__end__",columnId:this.getColumnId(n.columnIndex,u)})}r({cellId:o,before:l,code:i,newCellId:d}),a({cellId:d,edit:{type:"add_cell"}}),ja(d);break}case"delete_cell":{let{cellId:n}=t,i=s.get(at);this.validateCellIdExists(n,i),a({cellId:n,edit:{type:"delete_cell",previousCode:this.getCellEditorView(n,i).state.doc.toString()}}),ja(n);break}}return{status:"success",next_steps:["If you need to perform more edits, call this tool again."]}})}validateCellIdExists(t,e){if(!e.cellIds.getColumns().some(a=>a.idSet.has(t)))throw new Wt("Cell not found","CELL_NOT_FOUND",!1,"Check which cells exist in the notebook")}getColumnId(t,e){let a=e.cellIds.getColumns();if(t<0||t>=a.length)throw new Wt("Column index is out of range","COLUMN_INDEX_OUT_OF_RANGE",!0,"Choose a column index between 0 and the number of columns in the notebook (0-based)");return a[t].id}getCellEditorView(t,e){let a=e.cellHandles[t].current;if(!(a!=null&&a.editorView))throw new Wt("Cell editor not found","CELL_EDITOR_NOT_FOUND",!1,"Internal error, ask the user to report this error");return a.editorView}},Ru={baseDescription:"Run cells in the current notebook that are stale. Stale cells are cells that have been edited or newly added. You can run this tool after editing the notebook or when requested. The output of the ran cells will be returned alongside metadata."},fn=T({type:k("file"),url:m(),mediaType:m()}),Mu=class{constructor(){P(this,"name","run_stale_cells_tool");P(this,"description",Ru);P(this,"schema",T({}));P(this,"outputSchema",on.extend({cellsToOutput:Nt(m(),T({consoleOutput:m().optional(),cellOutput:m().optional(),consoleAttachments:Ce(fn).optional(),cellAttachments:Ce(fn).optional()}).nullable()).optional()}));P(this,"mode",["agent"]);P(this,"handler",async(t,e)=>{let{prepareForRun:a,sendRun:r,store:s}=e,n=s.get(at),i=si(n);if(i.length===0)return{status:"success",message:"No stale cells found."};if(await Yi({cellIds:i,sendRun:r,prepareForRun:a,notebook:n}),!await this.waitForCellsToFinish(s,i))return{status:"success",message:"No output was returned because some cells have not finished executing"};let o=s.get(at),l=new Map,d="";for(let u of i){let c=dn(u,o,{includeConsoleOutput:!0}),g,v,_=c.cellOutput,f=c.consoleOutputs;if(!_&&!f){l.set(u,null);continue}_&&(g=this.formatOutputString(_)),f&&(v=f.map(p=>this.formatOutputString(p)).join(`
`),d+="Console output represents the stdout or stderr of the cell (eg. print statements)."),l.set(u,{cellOutput:g,consoleOutput:v})}return l.size===0?{status:"success",message:"Stale cells have been run. No output was returned."}:{status:"success",cellsToOutput:Object.fromEntries(l),message:d===""?void 0:d,next_steps:["Review the output of the cells, if you need to make any changes, you can run this tool again, the CellId is the key of the result object if you want to edit the cell."]}})}formatOutputString(t){let e="",{outputType:a,processedContent:r,imageUrl:s,output:n}=t;return a==="text"?(e+=`Output:
`,r?e+=r:typeof n.data=="string"?e+=n.data:e+=JSON.stringify(n.data)):a==="media"&&(e+=`Media Output: Contains ${n.mimetype} content`,s&&(e+=`
Image URL: ${s}`)),e}async waitForCellsToFinish(t,e,a=3e4){let r=s=>e.every(n=>{let i=s.cellRuntime[n];return(i==null?void 0:i.status)!=="running"&&(i==null?void 0:i.status)!=="queued"});if(r(t.get(at)))return!0;try{return await Promise.race([Wn(at,r),new Promise((s,n)=>setTimeout(()=>n(Error("timeout")),a))]),!0}catch{return!1}}};function ju(t){let e=t.baseDescription;return t.whenToUse&&(e+=`

## When to use:
- ${t.whenToUse.join(`
- `)}`),t.avoidIf&&(e+=`

## Avoid if:
- ${t.avoidIf.join(`
- `)}`),t.prerequisites&&(e+=`

## Prerequisites:
- ${t.prerequisites.join(`
- `)}`),t.sideEffects&&(e+=`

## Side effects:
- ${t.sideEffects.join(`
- `)}`),t.additionalInfo&&(e+=`

## Additional info:
- ${t.additionalInfo}`),e}var gn,Kt;function Pu(t,e,a,r,s){var n={};return Object.keys(r).forEach(function(i){n[i]=r[i]}),n.enumerable=!!n.enumerable,n.configurable=!!n.configurable,("value"in n||n.initializer)&&(n.writable=!0),n=a.slice().reverse().reduce(function(i,o){return o(t,e,i)||i},n),s&&n.initializer!==void 0&&(n.value=n.initializer?n.initializer.call(s):void 0,n.initializer=void 0),n.initializer===void 0?(Object.defineProperty(t,e,n),null):n}const wr=new(gn=Jn(),Kt=class{constructor(t=[]){P(this,"tools",new Map);this.tools=new Map(t.map(e=>[e.name,e]))}has(t){return this.tools.has(t)}getToolOrThrow(t){let e=this.tools.get(t);if(!e)throw Error(`Tool ${t} not found`);return e}async invoke(t,e,a){var o;let r=this.getToolOrThrow(t),s=r.handler,n=r.schema,i=r.outputSchema;try{let l=await n.safeParseAsync(e);if(l.error){let g=Vr(l.error);throw Error(`Tool ${t} returned invalid input: ${g}`)}let d=l.data,u=await s(d,a),c=await i.safeParseAsync(u);if(c.error){let g=Vr(c.error);throw Error(`Tool ${t} returned invalid output: ${g}`)}return{tool_name:t,result:c.data,error:null}}catch(l){return l instanceof Wt?{tool_name:t,result:null,error:l.toStructuredString()}:{tool_name:t,result:null,error:new Wt(l instanceof Error?l.message:String(l),"TOOL_ERROR",!1,"Check the error message and try again with valid arguments.",{args:e,errorType:((o=l==null?void 0:l.constructor)==null?void 0:o.name)??typeof l}).toStructuredString()}}}getToolSchemas(){return[...this.tools.values()].map(t=>({name:t.name,description:ju(t.description),parameters:Fr(t.schema),source:"frontend",mode:t.mode}))}},Pu(Kt.prototype,"getToolSchemas",[gn],Object.getOwnPropertyDescriptor(Kt.prototype,"getToolSchemas"),Kt.prototype),Kt)([new Nu,new Mu]);function kr(t,e){return new Promise(a=>{let r=new FileReader;r.readAsDataURL(t),r.onload=s=>{var n;if((n=s.target)!=null&&n.result){let i=s.target.result;a(e==="base64"?i.slice(i.indexOf(",")+1):i)}}})}function Zu(t){return Promise.all(t.map(e=>kr(e,"base64").then(a=>[e.name,a])))}function $u(t){return t.length>50?`${t.slice(0,50)}...`:t}async function Lu(t){return await Promise.all(t.map(async e=>({type:"file",mediaType:e.type,filename:e.name,url:await kr(e,"dataUrl")})))}function Du(t){if(t.length===0)return!1;let e=t.at(-1);if(!e||e.role!=="assistant"||!e.parts)return!1;let a=e.parts;return a.length===0?!1:a[a.length-1].type==="reasoning"}function yn(t){return t.map(e=>e.type==="text"?e.text:"").join(`
`)}async function vn(t){let e=await wu({input:yn(t.flatMap(r=>r.parts))});function a(r,s){let n=[...r.parts];return s&&n.push(...e.attachments),{role:r.role,content:yn(r.parts),parts:n}}return{...e.body,messages:t.map((r,s)=>a(r,s===t.length-1))}}async function _n({invokeAiTool:t,addToolResult:e,toolCall:a,toolContext:r}){try{if(wr.has(a.toolName)){let s=await wr.invoke(a.toolName,a.input,r);e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}else{let s=await t({toolName:a.toolName,arguments:a.input});e({tool:a.toolName,toolCallId:a.toolCallId,output:s.result||s.error})}}catch(s){ue.error("Tool call failed:",s),e({tool:a.toolName,toolCallId:a.toolCallId,output:`Error: ${s instanceof Error?s.message:String(s)}`})}}function Fu(t){var o;if(t.length===0)return!1;let e=t[t.length-1],a=e.parts;if(a.length===0||e.role!=="assistant")return!1;let r=a.filter(l=>l.type.startsWith("tool-"));if(r.length===0)return!1;let s=r.every(l=>l.state==="output-available"),n=a[a.length-1],i=n.type==="text"&&((o=n.text)==null?void 0:o.trim().length)>0;return ue.warn("All tool calls completed: %s",s),s&&!i}function zu(t){return xi.define({combine:e=>e[0]??t})}var bn=zu({}),Cr=ta.define(),Sa=ta.define(),Uu=50,Ir=aa.define({create(){return{prompts:[],navigationIndex:-1,originalText:""}},update(t,e){var r,s;let a={...t};e.docChanged&&t.navigationIndex!==-1&&(e.effects.some(n=>n.is(Sa)||n.is(Cr))||(a.navigationIndex=-1,a.originalText=""));for(let n of e.effects)if(n.is(Cr)){let i=n.value.trim();i&&(a.prompts=[i,...t.prompts.filter(o=>o!==i)].slice(0,Uu),(s=(r=e.state.facet(bn)).save)==null||s.call(r,a.prompts)),a.navigationIndex=-1,a.originalText=""}else n.is(Sa)&&(a.navigationIndex=n.value.index,a.originalText=n.value.originalText);return a}}),Vu=t=>{let e=t.state.field(Ir),a=t.state.doc;if(e.prompts.length===0)return!1;let r,s=e.originalText;if(e.navigationIndex===-1){if(a.length>0)return!1;r=0,s=a.toString()}else if(r=Math.min(e.navigationIndex+1,e.prompts.length-1),r===e.navigationIndex)return!1;let n=e.prompts[r];return t.dispatch({changes:{from:0,to:t.state.doc.length,insert:n},effects:Sa.of({index:r,originalText:s})}),!0},Bu=t=>{let e=t.state.field(Ir);if(e.navigationIndex===-1)return!1;let a,r;return e.navigationIndex===0?(a=e.originalText,r=-1):(r=e.navigationIndex-1,a=e.prompts[r]??""),t.dispatch({changes:{from:0,to:t.state.doc.length,insert:a},effects:Sa.of({index:r,originalText:e.originalText})}),!0};const xn=t=>{let e=t.state.doc.toString();return e.trim()?(t.dispatch({effects:Cr.of(e)}),!0):!1};function Wu(t={}){let{storage:e,defaultKeymap:a=!0}=t,r=[Ir.init(()=>{var s;return{prompts:((s=e==null?void 0:e.load)==null?void 0:s.call(e))??[],navigationIndex:-1,originalText:""}}),bn.of(e??{})];return a&&r.push(ra.of([{key:"ArrowUp",run:Vu},{key:"ArrowDown",run:Bu}])),r}const Tr=ta.define(),He=aa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Tr)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}}),qu=aa.define({create(){return{onResourceClick:void 0,onResourceMouseOver:void 0,onResourceMouseOut:void 0,onPromptSubmit:void 0}},update(t){return t}}),Ku=ta.define();aa.define({create(){return new Map},update(t,e){let a=!1,r=t;for(let s of e.effects)if(s.is(Ku)){a||(a=(r=new Map(t),!0));for(let[n,i]of s.value)r.set(n,i)}return r}});const Ju=(t,e)=>async a=>{let r=a.matchBefore(/@(\w+)?/);if(!r||r.from===r.to&&!a.explicit)return null;let s=await t();if(s.length===0)return null;let n=Tr.of(new Map(s.map(o=>[o.uri,o])));a.view&&a.view.dispatch({effects:n});let i=s.map(o=>({label:`@${o.name}`,displayLabel:o.name,detail:o.uri,info:o.description||void 0,type:o.mimeType?"constant":"variable",boost:o.description?100:0,...e==null?void 0:e(o),apply:(l,d,u,c)=>{l.dispatch({changes:{from:u,to:c,insert:`@${o.uri} `}})}}));return{from:r.from,options:i}},Yu=/@[\w-]+:\/\/(?!\/)[^\s]+/;function lt(t){return t.matchAll(new RegExp(Yu.source,"g"))}var Gu=class extends Kr{constructor(e,a){super();P(this,"resource");P(this,"view");this.resource=e,this.view=a}eq(e){return e.resource.uri===this.resource.uri}toDOM(){let e=document.createElement("span");e.className="cm-resource-widget",e.textContent=`@${this.resource.name}`;let a=this.view.state.field(qu,!1),r=a==null?void 0:a.onResourceClick,s=a==null?void 0:a.onResourceMouseOver,n=a==null?void 0:a.onResourceMouseOut;return r&&(e.style.cursor="pointer",e.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),r(this.resource)})),s&&e.addEventListener("mouseover",i=>{i.preventDefault(),i.stopPropagation(),s(this.resource)}),n&&e.addEventListener("mouseout",i=>{i.preventDefault(),i.stopPropagation(),n(this.resource)}),e}},Hu=class extends Kr{constructor(e,a){super();P(this,"uri");P(this,"view");this.uri=e,this.view=a}eq(e){return e.uri===this.uri}toDOM(){let e=document.createElement("span");return e.className="cm-not-found-resource-widget",e.textContent=`@${this.uri.split("://")[1]??this.uri}`,e}};function wn(t){let e=t.state.field(He),a=[];for(let{from:r,to:s}of t.visibleRanges){let n=t.state.doc.sliceString(r,s);for(let i of lt(n)){let o=r+i.index,l=i[0].slice(1),d=e.get(l);d?a.push(Ma.replace({widget:new Gu(d,t)}).range(o,o+i[0].length)):a.push(Ma.replace({widget:new Hu(l,t)}).range(o,o+i[0].length))}}return Ma.set(a)}const Qu=_i.fromClass(class{constructor(t){P(this,"decorations");this.decorations=wn(t)}update(t){(t.docChanged||t.viewportChanged||t.transactions.some(e=>e.effects.some(a=>a.is(Tr))))&&(this.decorations=wn(t.view))}},{decorations:t=>t.decorations});function Xu(t){let e=document.createElement("div");e.className="cm-tooltip-cursor";let a=document.createElement("div");if(a.className="cm-tooltip-cursor-title",a.textContent=`${t.name} (${t.uri})`,e.appendChild(a),t.description){let r=document.createElement("div");r.className="cm-tooltip-cursor-description",r.textContent=t.description,e.appendChild(r)}if(t.mimeType){let r=document.createElement("div");r.className="cm-tooltip-cursor-mimetype",r.textContent=t.mimeType,e.appendChild(r)}return{dom:e}}function ec(t,e,a,r=0){for(let s of lt(t)){let n=r+s.index,i=n+s[0].length;if(e>=n&&e<=i){let o=s[0].slice(1),l=a.get(o);if(l)return{resource:l,start:n,end:i}}}return null}function tc(t){return bi((e,a)=>{let{from:r,text:s}=e.state.doc.lineAt(a),n=ec(s,a,e.state.field(He),r);return n?{pos:n.start,end:n.end,above:!0,create(){return(t.createTooltip??Xu)(n.resource)}}:null})}function ac(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));if(i.length===0)return null;for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e===d&&a.has(u))return{from:l,to:d,uri:u}}return null}function rc(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e).to,n=r.sliceString(e,s),i=Array.from(lt(n));if(i.length===0)return null;let o=i[0];if(!o||o.index!==0)return null;let l=e,d=e+o[0].length,u=o[0].slice(1);return a.has(u)?{from:l,to:d,uri:u}:null}function kn(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(e>l&&e<d&&a.has(u))return{from:l,to:d,uri:u}}return null}function sc(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,e),i=Array.from(lt(n)),o=null;for(let l of i){let d=s.from+l.index,u=d+l[0].length,c=l[0].slice(1);a.has(c)&&u<=e&&(e>u?o=u:e===u&&(o=d))}return o}function nc(t,e){let a=t.field(He),r=t.doc,s=r.lineAt(e),n=r.sliceString(s.from,s.to),i=Array.from(lt(n));for(let o of i){let l=s.from+o.index,d=l+o[0].length,u=o[0].slice(1);if(a.has(u)&&l>=e){if(e<l)return l;if(e===l)return d}}return null}const ic=vi.transactionFilter.of(t=>{var r;let e=t.annotation(yi.userEvent);if(!e)return t;let a=t.startState.selection.main;if(!a.empty)return t;if(e==="input.type"||e.startsWith("input")){if(t.changes.empty)return t;let s=t.startState.field(He),n=t.startState.doc,i=!1,o=0,l=[];if(t.changes.iterChanges((d,u,c,g,v)=>{let _=v.toString(),f=d;if(/^\s+$/.test(_)){l.push({from:d,to:u,insert:_});return}let p=n.lineAt(f),h=n.sliceString(p.from,p.to),b=Array.from(lt(h)),C=!1,A=!1;for(let L of b){let D=p.from+L.index,M=D+L[0].length,Y=L[0].slice(1);if(s.has(Y)){if(f===D){let $=f>0?n.sliceString(f-1,f):"";$!==""&&$!==" "&&$!==`
`&&$!=="	"&&(C=!0)}if(f===M){let $=f<n.length?n.sliceString(f,f+1):"";($===""||$!==" "&&$!==`
`&&$!=="	")&&(A=!0)}}}let O=_;C&&(O=` ${O}`,o+=1),A&&(O=` ${O}`,o+=1),O!==_&&(i=!0),l.push({from:d,to:u,insert:O})}),i)return[{changes:l,selection:t.selection?{anchor:t.selection.main.anchor+o,head:t.selection.main.head+o}:void 0,scrollIntoView:t.scrollIntoView}]}if(e==="delete.backward"||e==="delete.forward"){let s=null;return e==="delete.backward"?s=ac(t.startState,a.head):e==="delete.forward"&&(s=rc(t.startState,a.head)),s?[{changes:{from:s.from,to:s.to,insert:""},selection:{anchor:s.from},scrollIntoView:!0}]:t}if((r=t.selection)!=null&&r.main.empty&&a.empty&&!e.startsWith("input")&&e!=="input.type"){let s=a.head,n=t.selection.main.head,i=null;if(n<s){let o=kn(t.startState,s);i=o&&s>o.from?o.from:sc(t.startState,s)}else if(n>s){let o=kn(t.startState,s);i=o&&s<o.to?o.to:nc(t.startState,s)}if(i!==null&&i!==n)return[{selection:{anchor:i},scrollIntoView:!0}]}return t}),oc=qr.baseTheme({".cm-resource-widget":{background:"light-dark(rgba(86,156,214,0.08),rgba(86,156,214,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#2367a2,#7ecbff)",fontWeight:"500"},".cm-resource-widget:hover":{background:"light-dark(rgba(86,156,214,0.18),rgba(86,156,214,0.28))"},".cm-not-found-resource-widget":{background:"light-dark(rgba(151,151,151,0.08),rgba(151,151,151,0.18))",borderRadius:"4px",padding:"2px 4px",color:"light-dark(#b00020,#ff8080)",fontWeight:"500"}});var Cn="_none_",lc=[{uri:"",name:"No resources",type:Cn,data:{}}],dc={info:"Variables, dataframes, and tables will appear here.",apply:()=>{}};function uc(t){let{language:e,store:a,onAddFiles:r}=t;return[e.data.of({autocomplete:Ju(async()=>{let s=ft(a).getAllItems();return s.length===0?lc:s},s=>{var n;return s.type===Cn?dc:((n=ft(a).getProvider(s.type))==null?void 0:n.formatCompletion(s))||{}})}),Wr.high(ra.of([{key:"Tab",run:s=>Ti(s)}])),cn.of({addAttachment:s=>r==null?void 0:r([s])}),...r?[e.data.of({autocomplete:_u().createCompletionSource()})]:[],Qu,ic,He.init(()=>{let s=ft(a).getAllItems();return new Map(s.map(n=>[n.uri,n]))}),oc,tc({createTooltip:s=>{let n=ft(a).getProvider(s.type);if(!n)return ue.warn("No provider found for resource",s),Jt(s.description||s.name);let i=n.formatCompletion(s),o=s.description||s.name;if(!(i!=null&&i.info))return Jt(o);if(typeof i.info=="string")return Jt(i.info);let l=i.info(i);return l?"dom"in l?{dom:l.dom}:"then"in l?(ue.warn("info is a promise. This is not supported",l),Jt(o)):{dom:l}:Jt(o)}})]}function Jt(t){let e=document.createElement("div");return e.innerHTML=t,{dom:e}}var Aa=ct(Ra(),1),S=ct(hi(),1);const In=t=>{let{handleAcceptCompletion:e,handleDeclineCompletion:a,isLoading:r,hasCompletion:s}=t;return n=>{let i=fi()?n.metaKey:n.ctrlKey;i&&n.key==="Enter"&&!r&&s&&e(),(n.key==="Delete"||n.key==="Backspace")&&i&&n.shiftKey&&(a(),n.preventDefault(),n.stopPropagation())}},Tn=t=>{let e=(0,Aa.c)(22),{isLoading:a,onAccept:r,onDecline:s,size:n,acceptShortcut:i,declineShortcut:o,multipleCompletions:l}=t,d=n===void 0?"sm":n,u=i===void 0?"Mod-\u21B5":i,c=o===void 0?"Shift-Mod-Delete":o,g=l===void 0?!1:l,v=g&&" all",_;e[0]===u?_=e[1]:(_=(0,S.jsx)(jt,{className:"ml-1 inline",shortcut:u}),e[0]=u,e[1]=_);let f;e[2]!==v||e[3]!==_?(f=(0,S.jsxs)("span",{className:"text-(--grass-11) opacity-100",children:["Accept",v," ",_]}),e[2]=v,e[3]=_,e[4]=f):f=e[4];let p;e[5]!==a||e[6]!==r||e[7]!==d||e[8]!==f?(p=(0,S.jsx)($e,{"data-testid":"accept-completion-button",variant:"text",size:d,className:"mb-0",disabled:a,onClick:r,children:f}),e[5]=a,e[6]=r,e[7]=d,e[8]=f,e[9]=p):p=e[9];let h=g&&" all",b;e[10]===c?b=e[11]:(b=(0,S.jsx)(jt,{className:"ml-1 inline",shortcut:c}),e[10]=c,e[11]=b);let C;e[12]!==b||e[13]!==h?(C=(0,S.jsxs)("span",{className:"text-(--red-10)",children:["Reject",h," ",b]}),e[12]=b,e[13]=h,e[14]=C):C=e[14];let A;e[15]!==s||e[16]!==d||e[17]!==C?(A=(0,S.jsx)($e,{"data-testid":"decline-completion-button",variant:"text",size:d,className:"mb-0 pl-1 pr-0",onClick:s,children:C}),e[15]=s,e[16]=d,e[17]=C,e[18]=A):A=e[18];let O;return e[19]!==A||e[20]!==p?(O=(0,S.jsxs)(S.Fragment,{children:[p,A]}),e[19]=A,e[20]=p,e[21]=O):O=e[21],O},cc=t=>{let e=(0,Aa.c)(9),{isLoading:a,onAccept:r,onDecline:s,runCell:n}=t,i;e[0]!==a||e[1]!==r||e[2]!==n?(i=(0,S.jsx)(En,{isLoading:a,onAccept:r,size:"xs",runCell:n}),e[0]=a,e[1]=r,e[2]=n,e[3]=i):i=e[3];let o;e[4]===s?o=e[5]:(o=(0,S.jsx)(Sn,{onDecline:s,size:"xs"}),e[4]=s,e[5]=o);let l;return e[6]!==i||e[7]!==o?(l=(0,S.jsxs)(S.Fragment,{children:[i,o]}),e[6]=i,e[7]=o,e[8]=l):l=e[8],l},En=t=>{let e=(0,Aa.c)(33),{isLoading:a,onAccept:r,multipleCompletions:s,size:n,buttonStyles:i,acceptShortcut:o,runCell:l,playButtonStyles:d}=t,u=s===void 0?!1:s,c=n===void 0?"sm":n,g;e[0]!==r||e[1]!==l?(g=()=>{r(),l&&l()},e[0]=r,e[1]=l,e[2]=g):g=e[2];let v=g,_=u?"Accept all":"Accept";if(l){let b=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-r-none ${i}`,C;e[3]===o?C=e[4]:(C=o&&(0,S.jsx)(jt,{className:"ml-1 inline",shortcut:o}),e[3]=o,e[4]=C);let A;e[5]!==a||e[6]!==r||e[7]!==c||e[8]!==b||e[9]!==C||e[10]!==_?(A=(0,S.jsxs)($e,{variant:"text",size:c,disabled:a,onClick:r,className:b,children:[_,C]}),e[5]=a,e[6]=r,e[7]=c,e[8]=b,e[9]=C,e[10]=_,e[11]=A):A=e[11];let O=u?"Accept and run all cells":"Accept and run cell",L=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded-l-none px-1.5 ${d}`,D;e[12]===Symbol.for("react.memo_cache_sentinel")?(D=(0,S.jsx)(Fi,{className:"h-2.5 w-2.5"}),e[12]=D):D=e[12];let M;e[13]!==v||e[14]!==a||e[15]!==c||e[16]!==L?(M=(0,S.jsx)($e,{variant:"text",size:c,disabled:a,onClick:v,className:L,children:D}),e[13]=v,e[14]=a,e[15]=c,e[16]=L,e[17]=M):M=e[17];let Y;e[18]!==M||e[19]!==O?(Y=(0,S.jsx)(Wi,{content:O,children:M}),e[18]=M,e[19]=O,e[20]=Y):Y=e[20];let $;return e[21]!==Y||e[22]!==A?($=(0,S.jsxs)("div",{className:"flex",children:[A,Y]}),e[21]=Y,e[22]=A,e[23]=$):$=e[23],$}let f=`h-6 text-(--grass-11) bg-(--grass-3)/60
    hover:bg-(--grass-3) dark:bg-(--grass-4)/80 dark:hover:bg-(--grass-3) font-semibold
    active:bg-(--grass-5) dark:active:bg-(--grass-4)
    border-(--green-6) border hover:shadow-xs rounded px-3 ${i}`,p;e[24]===o?p=e[25]:(p=o&&(0,S.jsx)(jt,{className:"ml-1 inline",shortcut:o}),e[24]=o,e[25]=p);let h;return e[26]!==a||e[27]!==r||e[28]!==c||e[29]!==f||e[30]!==p||e[31]!==_?(h=(0,S.jsxs)($e,{variant:"text",size:c,disabled:a,onClick:r,className:f,children:[_,p]}),e[26]=a,e[27]=r,e[28]=c,e[29]=f,e[30]=p,e[31]=_,e[32]=h):h=e[32],h},Sn=t=>{let e=(0,Aa.c)(8),{onDecline:a,multipleCompletions:r,size:s,className:n,declineShortcut:i}=t,o=r===void 0?!1:r,l=s===void 0?"sm":s,d=`h-6 text-(--red-10) bg-(--red-3)/60 hover:bg-(--red-3)
    dark:bg-(--red-4)/80 dark:hover:bg-(--red-3) rounded px-3 font-semibold
    active:bg-(--red-5) dark:active:bg-(--red-4)
    border-(--red-6) border hover:shadow-xs ${n}`,u=o&&" all",c;e[0]===i?c=e[1]:(c=i&&(0,S.jsx)(jt,{className:"ml-1 inline",shortcut:i}),e[0]=i,e[1]=c);let g;return e[2]!==a||e[3]!==l||e[4]!==d||e[5]!==u||e[6]!==c?(g=(0,S.jsxs)($e,{variant:"text",size:l,onClick:a,className:d,children:["Reject",u,c]}),e[2]=a,e[3]=l,e[4]=d,e[5]=u,e[6]=c,e[7]=g):g=e[7],g};var pc=class extends rr{constructor(t,e){super(t),this.onChunkReceived=e}processResponseStream(t){let e=this.onChunkReceived;return super.processResponseStream(t).pipeThrough(new TransformStream({async transform(a,r){e(a),r.enqueue(a)}}))}},An=ct(Ra(),1),mc=Hn("marimo:ai-language","python",ri),On="marimo:ai-prompt-history",Nn=new Yn(Ce(m()),()=>[]);const hc=t=>{let e=(0,An.c)(89),{onClose:a}=t,r=jr(),[s,n]=(0,R.useState)(""),{deleteAllStagedCells:i,clearStagedCells:o,onStream:l,addStagedCell:d}=hn(r),[u,c]=qn(mc),g=gi(),{invokeAiTool:v,sendRun:_}=ki(),f=Bn(qt),p=(0,R.useRef)(null),{createNewCell:h,prepareForRun:b}=Pr(),C;e[0]!==d||e[1]!==h||e[2]!==b||e[3]!==_||e[4]!==r?(C={store:r,addStagedCell:d,createNewCell:h,prepareForRun:b,sendRun:_},e[0]=d,e[1]=h,e[2]=b,e[3]=_,e[4]=r,e[5]=C):C=e[5];let A=C,O;if(e[6]!==u||e[7]!==l||e[8]!==g){let Se;e[10]===u?Se=e[11]:(Se=async Qt=>{let Fn=await vn(Qt.messages);return{body:{...Qt,...Fn,code:"",prompt:"",language:u}}},e[10]=u,e[11]=Se);let tt;e[12]===l?tt=e[13]:(tt=Qt=>{l(Qt)},e[12]=l,e[13]=tt),O=new pc({api:g.getAiURL("completion").toString(),headers:g.headers(),prepareSendMessagesRequest:Se},tt),e[6]=u,e[7]=l,e[8]=g,e[9]=O}else O=e[9];let{sendMessage:L,stop:D,status:M,addToolResult:Y}=nn({experimental_throttle:100,transport:O,onToolCall:async Se=>{let{toolCall:tt}=Se;await _n({invokeAiTool:v,addToolResult:$,toolCall:{toolName:tt.toolName,toolCallId:tt.toolCallId,input:tt.input},toolContext:A})},onError:fc}),$=Y,K=M==="streaming"||M==="submitted",ee=f.size>0,se=f.size>1,Q;e[14]!==i||e[15]!==s||e[16]!==K||e[17]!==L?(Q=()=>{var Se;K||((Se=p.current)!=null&&Se.view&&xn(p.current.view),i(),L({text:s}))},e[14]=i,e[15]=s,e[16]=K,e[17]=L,e[18]=Q):Q=e[18];let J=Q,X;e[19]===Symbol.for("react.memo_cache_sentinel")?(X=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(ro,{className:"size-4 mr-2"}),"Python"]}),e[19]=X):X=e[19];let ce=X,te;e[20]===Symbol.for("react.memo_cache_sentinel")?(te=(0,S.jsxs)(S.Fragment,{children:[(0,S.jsx)(Qn,{className:"size-4 mr-2"}),"SQL"]}),e[20]=te):te=e[20];let dt=te,je=u==="python"?ce:dt,Te;e[21]===Symbol.for("react.memo_cache_sentinel")?(Te=(0,S.jsx)(ji,{className:"ml-1 h-3.5 w-3.5 text-muted-foreground/70"}),e[21]=Te):Te=e[21];let fe;e[22]===je?fe=e[23]:(fe=(0,S.jsx)(Zi,{asChild:!0,children:(0,S.jsxs)($e,{variant:"text",className:"ml-2",size:"xs","data-testid":"language-button",children:[je,Te]})}),e[22]=je,e[23]=fe);let ze,Qe;e[24]===Symbol.for("react.memo_cache_sentinel")?(ze=(0,S.jsx)("div",{className:"px-2 py-1 font-semibold",children:"Select language"}),Qe=(0,S.jsx)(Pi,{}),e[24]=ze,e[25]=Qe):(ze=e[24],Qe=e[25]);let Ee;e[26]===c?Ee=e[27]:(Ee=(0,S.jsx)(Hr,{onClick:()=>c("python"),children:ce}),e[26]=c,e[27]=Ee);let Ue;e[28]===c?Ue=e[29]:(Ue=(0,S.jsx)(Hr,{onClick:()=>c("sql"),children:dt}),e[28]=c,e[29]=Ue);let Ve;e[30]!==Ee||e[31]!==Ue?(Ve=(0,S.jsxs)($i,{align:"center",children:[ze,Qe,Ee,Ue]}),e[30]=Ee,e[31]=Ue,e[32]=Ve):Ve=e[32];let gt;e[33]!==fe||e[34]!==Ve?(gt=(0,S.jsxs)(Li,{modal:!1,children:[fe,Ve]}),e[33]=fe,e[34]=Ve,e[35]=gt):gt=e[35];let Ot=gt,Pe;e[36]!==o||e[37]!==a?(Pe=()=>{o(),a()},e[36]=o,e[37]=a,e[38]=Pe):Pe=e[38];let Be=Pe,W;e[39]===i?W=e[40]:(W=()=>{i()},e[39]=i,e[40]=W);let V=W,ne;e[41]===Symbol.for("react.memo_cache_sentinel")?(ne=(0,S.jsx)(zi,{className:"size-4 text-(--blue-11) mr-2"}),e[41]=ne):ne=e[41];let B;e[42]!==i||e[43]!==a?(B=()=>{i(),a()},e[42]=i,e[43]=a,e[44]=B):B=e[44];let we;e[45]===Symbol.for("react.memo_cache_sentinel")?(we=Se=>{n(Se)},e[45]=we):we=e[45];let ge;e[46]!==Be||e[47]!==V||e[48]!==ee||e[49]!==K?(ge=In({handleAcceptCompletion:Be,handleDeclineCompletion:V,isLoading:K,hasCompletion:ee}),e[46]=Be,e[47]=V,e[48]=ee,e[49]=K,e[50]=ge):ge=e[50];let oe;e[51]!==s||e[52]!==J||e[53]!==B||e[54]!==ge?(oe=(0,S.jsx)(Rn,{inputRef:p,onClose:B,value:s,onChange:we,onSubmit:J,onKeyDown:ge}),e[51]=s,e[52]=J,e[53]=B,e[54]=ge,e[55]=oe):oe=e[55];let ie;e[56]!==K||e[57]!==D?(ie=K&&(0,S.jsxs)($e,{"data-testid":"stop-completion-button",variant:"text",size:"sm",className:"mb-0",onClick:D,children:[(0,S.jsx)(Di,{className:"animate-spin mr-1",size:14}),"Stop"]}),e[56]=K,e[57]=D,e[58]=ie):ie=e[58];let ve;e[59]===Symbol.for("react.memo_cache_sentinel")?(ve=(0,S.jsx)(no,{className:"size-4"}),e[59]=ve):ve=e[59];let We;e[60]===J?We=e[61]:(We=(0,S.jsx)($e,{variant:"text",size:"sm",onClick:J,title:"Submit",children:ve}),e[60]=J,e[61]=We);let ut;e[62]===Symbol.for("react.memo_cache_sentinel")?(ut=(0,S.jsx)(Ri,{className:"size-4"}),e[62]=ut):ut=e[62];let qe;e[63]===a?qe=e[64]:(qe=(0,S.jsx)($e,{variant:"text",size:"sm",className:"mb-0 px-1",onClick:a,children:ut}),e[63]=a,e[64]=qe);let pe;e[65]!==oe||e[66]!==ie||e[67]!==We||e[68]!==qe?(pe=(0,S.jsxs)("div",{className:"flex items-center px-3",children:[ne,oe,ie,We,qe]}),e[65]=oe,e[66]=ie,e[67]=We,e[68]=qe,e[69]=pe):pe=e[69];let _e=pe,Xe;e[70]===Symbol.for("react.memo_cache_sentinel")?(Xe=Br("flex flex-col w-full gap-2 py-2"),e[70]=Xe):Xe=e[70];let et;e[71]===ee?et=e[72]:(et=!ee&&(0,S.jsxs)("span",{className:"text-xs text-muted-foreground px-3 flex flex-col gap-1",children:[(0,S.jsxs)("span",{children:["You can mention"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@dataframe"})," or"," ",(0,S.jsx)("span",{className:"text-(--cyan-11)",children:"@sql_table"})," to pull additional context such as column names."]}),(0,S.jsx)("span",{children:"Code from other cells is automatically included."})]}),e[71]=ee,e[72]=et);let Ze;e[73]!==Be||e[74]!==V||e[75]!==ee||e[76]!==K||e[77]!==se?(Ze=ee&&(0,S.jsx)(Tn,{isLoading:K,onAccept:Be,onDecline:V,size:"sm",multipleCompletions:se}),e[73]=Be,e[74]=V,e[75]=ee,e[76]=K,e[77]=se,e[78]=Ze):Ze=e[78];let Gt;e[79]===Symbol.for("react.memo_cache_sentinel")?(Gt=(0,S.jsx)(Ni,{triggerClassName:"h-7 text-xs max-w-64",iconSize:"small",forRole:"edit"}),e[79]=Gt):Gt=e[79];let yt;e[80]===Ot?yt=e[81]:(yt=(0,S.jsxs)("div",{className:"ml-auto flex items-center gap-1",children:[Ot,Gt]}),e[80]=Ot,e[81]=yt);let vt;e[82]!==et||e[83]!==Ze||e[84]!==yt?(vt=(0,S.jsxs)("div",{className:"flex flex-row justify-between -mt-1 ml-1 mr-3",children:[et,Ze,yt]}),e[82]=et,e[83]=Ze,e[84]=yt,e[85]=vt):vt=e[85];let Ht;return e[86]!==_e||e[87]!==vt?(Ht=(0,S.jsxs)("div",{className:Xe,children:[_e,vt]}),e[86]=_e,e[87]=vt,e[88]=Ht):Ht=e[88],Ht},Rn=t=>{let e=(0,An.c)(35),{value:a,placeholder:r,inputRef:s,className:n,onChange:i,onSubmit:o,onKeyDown:l,onClose:d,onAddFiles:u,additionalCompletions:c,maxHeight:g}=t,v=o,_=d,f=jr(),{theme:p}=Oi(),h;e[0]===c?h=e[1]:(h=ce=>c?Cu([c.triggerCompletionRegex],c.completions)(ce):null,e[0]=c,e[1]=h);let b=Ki(h),C,A,O,L;if(e[2]!==b||e[3]!==u||e[4]!==f){let ce=Ai();e[9]===Symbol.for("react.memo_cache_sentinel")?(C=Si({}),e[9]=C):C=e[9],A=ce,O=uc({language:ce.language,store:f,onAddFiles:u}),L=ce.language.data.of({autocomplete:b}),e[2]=b,e[3]=u,e[4]=f,e[5]=C,e[6]=A,e[7]=O,e[8]=L}else C=e[5],A=e[6],O=e[7],L=e[8];let D;e[10]===Symbol.for("react.memo_cache_sentinel")?(D=Wu({storage:{load:gc,save:yc}}),e[10]=D):D=e[10];let M;e[11]===Symbol.for("react.memo_cache_sentinel")?(M=to(),e[11]=M):M=e[11];let Y;e[12]===v?Y=e[13]:(Y=Wr.highest(ra.of([{preventDefault:!0,stopPropagation:!0,any:(ce,te)=>{let dt=te.metaKey||te.ctrlKey||te.shiftKey;if(te.key==="Enter"&&!dt)return v(te,ce.state.doc.toString()),te.preventDefault(),te.stopPropagation(),!0;if(te.key==="Enter"&&te.shiftKey){let je=ce.state.selection.main.from;return ce.dispatch({changes:{from:je,to:je,insert:`
`},selection:{anchor:je+1,head:je+1}}),te.preventDefault(),te.stopPropagation(),!0}return!1}}])),e[12]=v,e[13]=Y);let $;e[14]===_?$=e[15]:($=ra.of([{key:"Escape",preventDefault:!0,stopPropagation:!0,run:()=>(_(),!0)}]),e[14]=_,e[15]=$);let K;e[16]!==C||e[17]!==A||e[18]!==O||e[19]!==L||e[20]!==Y||e[21]!==$?(K=[C,A,O,L,D,qr.lineWrapping,M,Y,$],e[16]=C,e[17]=A,e[18]=O,e[19]=L,e[20]=Y,e[21]=$,e[22]=K):K=e[22];let ee=K,se;e[23]===n?se=e[24]:(se=Br("flex-1 font-sans overflow-auto my-1",n),e[23]=n,e[24]=se);let Q=p==="dark"?"dark":"light",J=r||"Generate with AI, @ to include context",X;return e[25]!==ee||e[26]!==s||e[27]!==g||e[28]!==i||e[29]!==l||e[30]!==se||e[31]!==Q||e[32]!==J||e[33]!==a?(X=(0,S.jsx)(ao,{ref:s,className:se,width:"100%",maxHeight:g,value:a,basicSetup:!1,extensions:ee,onChange:i,onKeyDown:l,theme:Q,placeholder:J}),e[25]=ee,e[26]=s,e[27]=g,e[28]=i,e[29]=l,e[30]=se,e[31]=Q,e[32]=J,e[33]=a,e[34]=X):X=e[34],X};function fc(t){Jr({title:"Generate with AI failed",description:Ji(t)})}function gc(){return Nn.get(On)}function yc(t){return Nn.set(On,t)}export{xu as C,rr as D,du as E,so as O,Iu as S,nn as T,wr as _,cc as a,hn as b,xn as c,$u as d,_n as f,Zu as g,kr as h,Tn as i,vn as l,Du as m,Rn as n,Sn as o,Fu as p,En as r,In as s,hc as t,Lu as u,qt as v,ft as w,bu as x,mn as y};
