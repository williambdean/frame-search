import{Gt as T,Ht as de,I as nt,It as he,Kt as H,Pt as ue,Rt as me,Ut as G,Vt as q,W as it,ht as ge,it as X,j as st,jt as lt,ot as at,qt as pe,rt as O,st as z,tt as w,zt as Ae}from"./dist-BPcMnGQn.js";var b=class rt{constructor(t,o,i,n){this.fromA=t,this.toA=o,this.fromB=i,this.toB=n}offset(t,o=t){return new rt(this.fromA+t,this.toA+t,this.fromB+o,this.toB+o)}};function E(e,t,o,i,n,r){if(e==i)return[];let s=te(e,t,o,i,n,r),l=re(e,t+s,o,i,n+s,r);t+=s,o-=l,n+=s,r-=l;let f=o-t,d=r-n;if(!f||!d)return[new b(t,o,n,r)];if(f>d){let c=e.slice(t,o).indexOf(i.slice(n,r));if(c>-1)return[new b(t,t+c,n,n),new b(t+c+d,o,r,r)]}else if(d>f){let c=i.slice(n,r).indexOf(e.slice(t,o));if(c>-1)return[new b(t,t,n,n+c),new b(o,o,n+c+f,r)]}if(f==1||d==1)return[new b(t,o,n,r)];let a=be(e,t,o,i,n,r);if(a){let[c,h,u]=a;return E(e,t,c,i,n,h).concat(E(e,c+u,o,i,h+u,r))}return ft(e,t,o,i,n,r)}var U=1e9,I=0,Z=!1;function ft(e,t,o,i,n,r){let s=o-t,l=r-n;if(U<1e9&&Math.min(s,l)>U*16||I>0&&Date.now()>I)return Math.min(s,l)>U*64?[new b(t,o,n,r)]:Ce(e,t,o,i,n,r);let f=Math.ceil((s+l)/2);_.reset(f),ee.reset(f);let d=(u,g)=>e.charCodeAt(t+u)==i.charCodeAt(n+g),a=(u,g)=>e.charCodeAt(o-u-1)==i.charCodeAt(r-g-1),c=(s-l)%2==0?null:ee,h=c?null:_;for(let u=0;u<f;u++){if(u>U||I>0&&!(u&63)&&Date.now()>I)return Ce(e,t,o,i,n,r);let g=_.advance(u,s,l,f,c,!1,d)||ee.advance(u,s,l,f,h,!0,a);if(g)return ct(e,t,o,t+g[0],i,n,r,n+g[1])}return[new b(t,o,n,r)]}var ve=class{constructor(){this.vec=[]}reset(e){this.len=e<<1;for(let t=0;t<this.len;t++)this.vec[t]=-1;this.vec[e+1]=0,this.start=this.end=0}advance(e,t,o,i,n,r,s){for(let l=-e+this.start;l<=e-this.end;l+=2){let f=i+l,d=l==-e||l!=e&&this.vec[f-1]<this.vec[f+1]?this.vec[f+1]:this.vec[f-1]+1,a=d-l;for(;d<t&&a<o&&s(d,a);)d++,a++;if(this.vec[f]=d,d>t)this.end+=2;else if(a>o)this.start+=2;else if(n){let c=i+(t-o)-l;if(c>=0&&c<this.len&&n.vec[c]!=-1)if(r){let h=n.vec[c];if(h>=t-d)return[h,i+h-c]}else{let h=t-n.vec[c];if(d>=h)return[d,a]}}}return null}},_=new ve,ee=new ve;function ct(e,t,o,i,n,r,s,l){let f=!1;return!N(e,i)&&++i==o&&(f=!0),!N(n,l)&&++l==s&&(f=!0),f?[new b(t,o,r,s)]:E(e,t,i,n,r,l).concat(E(e,i,o,n,l,s))}function Be(e,t){let o=1,i=Math.min(e,t);for(;o<i;)o<<=1;return o}function te(e,t,o,i,n,r){if(t==o||t==r||e.charCodeAt(t)!=i.charCodeAt(n))return 0;let s=Be(o-t,r-n);for(let l=t,f=n;;){let d=l+s,a=f+s;if(d>o||a>r||e.slice(l,d)!=i.slice(f,a)){if(s==1)return l-t-(N(e,l)?0:1);s>>=1}else{if(d==o||a==r)return d-t;l=d,f=a}}}function re(e,t,o,i,n,r){if(t==o||n==r||e.charCodeAt(o-1)!=i.charCodeAt(r-1))return 0;let s=Be(o-t,r-n);for(let l=o,f=r;;){let d=l-s,a=f-s;if(d<t||a<n||e.slice(d,l)!=i.slice(a,f)){if(s==1)return o-l-(N(e,l)?0:1);s>>=1}else{if(d==t||a==n)return o-d;l=d,f=a}}}function oe(e,t,o,i,n,r,s,l){let f=i.slice(n,r),d=null;for(;;){if(d||s<l)return d;for(let a=t+s;;){N(e,a)||a++;let c=a+s;if(N(e,c)||(c+=c==a+1?1:-1),c>=o)break;let h=e.slice(a,c),u=-1;for(;(u=f.indexOf(h,u+1))!=-1;){let g=te(e,c,o,i,n+u+h.length,r),p=re(e,t,a,i,n,n+u),m=h.length+g+p;(!d||d[2]<m)&&(d=[a-p,n+u-p,m])}a=c}if(l<0)return d;s>>=1}}function be(e,t,o,i,n,r){let s=o-t,l=r-n;if(s<l){let f=be(i,n,r,e,t,o);return f&&[f[1],f[0],f[2]]}return s<4||l*2<s?null:oe(e,t,o,i,n,r,Math.floor(s/4),-1)}function Ce(e,t,o,i,n,r){Z=!0;let s=o-t,l=r-n,f;if(s<l){let h=oe(i,n,r,e,t,o,Math.floor(s/6),50);f=h&&[h[1],h[0],h[2]]}else f=oe(e,t,o,i,n,r,Math.floor(l/6),50);if(!f)return[new b(t,o,n,r)];let[d,a,c]=f;return E(e,t,d,i,n,a).concat(E(e,d+c,o,i,a+c,r))}function we(e,t){for(let o=1;o<e.length;o++){let i=e[o-1],n=e[o];i.toA>n.fromA-t&&i.toB>n.fromB-t&&(e[o-1]=new b(i.fromA,n.toA,i.fromB,n.toB),e.splice(o--,1))}}function dt(e,t,o){for(;;){we(o,1);let i=!1;for(let n=0;n<o.length;n++){let r=o[n],s,l;(s=te(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=o[n]=new b(r.fromA+s,r.toA,r.fromB+s,r.toB)),(l=re(e,r.fromA,r.toA,t,r.fromB,r.toB))&&(r=o[n]=new b(r.fromA,r.toA-l,r.fromB,r.toB-l));let f=r.toA-r.fromA,d=r.toB-r.fromB;if(f&&d)continue;let a=r.fromA-(n?o[n-1].toA:0),c=(n<o.length-1?o[n+1].fromA:e.length)-r.toA;if(!a||!c)continue;let h=f?e.slice(r.fromA,r.toA):t.slice(r.fromB,r.toB);a<=h.length&&e.slice(r.fromA-a,r.fromA)==h.slice(h.length-a)?(o[n]=new b(r.fromA-a,r.toA-a,r.fromB-a,r.toB-a),i=!0):c<=h.length&&e.slice(r.toA,r.toA+c)==h.slice(0,c)&&(o[n]=new b(r.fromA+c,r.toA+c,r.fromB+c,r.toB+c),i=!0)}if(!i)break}return o}function ht(e,t,o){for(let i=0,n=0;n<e.length;n++){let r=e[n],s=r.toA-r.fromA,l=r.toB-r.fromB;if(s&&l||s>3||l>3){let f=n==e.length-1?t.length:e[n+1].fromA,d=r.fromA-i,a=f-r.toA,c=Le(t,r.fromA,d),h=Oe(t,r.toA,a),u=r.fromA-c,g=h-r.toA;if((!s||!l)&&u&&g){let p=Math.max(s,l),[m,A,D]=s?[t,r.fromA,r.toA]:[o,r.fromB,r.toB];p>u&&t.slice(c,r.fromA)==m.slice(D-u,D)?(r=e[n]=new b(c,c+s,r.fromB-u,r.toB-u),c=r.fromA,h=Oe(t,r.toA,f-r.toA)):p>g&&t.slice(r.toA,h)==m.slice(A,A+g)&&(r=e[n]=new b(h-s,h,r.fromB+g,r.toB+g),h=r.toA,c=Le(t,r.fromA,r.fromA-i)),u=r.fromA-c,g=h-r.toA}if(u||g)r=e[n]=new b(r.fromA-u,r.toA+g,r.fromB-u,r.toB+g);else if(s){if(!l){let p=ye(t,r.fromA,r.toA),m,A=p<0?-1:Ee(t,r.toA,r.fromA);p>-1&&(m=p-r.fromA)<=a&&t.slice(r.fromA,p)==t.slice(r.toA,r.toA+m)?r=e[n]=r.offset(m):A>-1&&(m=r.toA-A)<=d&&t.slice(r.fromA-m,r.fromA)==t.slice(A,r.toA)&&(r=e[n]=r.offset(-m))}}else{let p=ye(o,r.fromB,r.toB),m,A=p<0?-1:Ee(o,r.toB,r.fromB);p>-1&&(m=p-r.fromB)<=a&&o.slice(r.fromB,p)==o.slice(r.toB,r.toB+m)?r=e[n]=r.offset(m):A>-1&&(m=r.toB-A)<=d&&o.slice(r.fromB-m,r.fromB)==o.slice(A,r.toB)&&(r=e[n]=r.offset(-m))}}i=r.toA}return we(e,3),e}var y;try{y=RegExp("[\\p{Alphabetic}\\p{Number}]","u")}catch{}function ke(e){return e>48&&e<58||e>64&&e<91||e>96&&e<123}function xe(e,t){if(t==e.length)return 0;let o=e.charCodeAt(t);return o<192?ke(o)?1:0:y?!Se(o)||t==e.length-1?y.test(String.fromCharCode(o))?1:0:y.test(e.slice(t,t+2))?2:0:0}function Me(e,t){if(!t)return 0;let o=e.charCodeAt(t-1);return o<192?ke(o)?1:0:y?!Te(o)||t==1?y.test(String.fromCharCode(o))?1:0:y.test(e.slice(t-2,t))?2:0:0}var De=8;function Oe(e,t,o){if(t==e.length||!Me(e,t))return t;for(let i=t,n=t+o,r=0;r<De;r++){let s=xe(e,i);if(!s||i+s>n)return i;i+=s}return t}function Le(e,t,o){if(!t||!xe(e,t))return t;for(let i=t,n=t-o,r=0;r<De;r++){let s=Me(e,i);if(!s||i-s<n)return i;i-=s}return t}function Ee(e,t,o){for(;t!=o;t--)if(e.charCodeAt(t-1)==10)return t;return-1}function ye(e,t,o){for(;t!=o;t++)if(e.charCodeAt(t)==10)return t;return-1}var Se=e=>e>=55296&&e<=56319,Te=e=>e>=56320&&e<=57343;function N(e,t){return!t||t==e.length||!Se(e.charCodeAt(t-1))||!Te(e.charCodeAt(t))}function ut(e,t,o){return U=((o==null?void 0:o.scanLimit)??1e9)>>1,I=o!=null&&o.timeout?Date.now()+o.timeout:0,Z=!1,dt(e,t,E(e,0,e.length,t,0,t.length))}function Ge(){return!Z}function Ne(e,t,o){return ht(ut(e,t,o),e,t)}var k=Ae.define({combine:e=>e[0]}),ne=T.define(),Re=Ae.define(),M=H.define({create(e){return null},update(e,t){for(let o of t.effects)o.is(ne)&&(e=o.value);for(let o of t.state.facet(Re))e=o(e,t);return e}}),S=class ot{constructor(t,o,i,n,r,s=!0){this.changes=t,this.fromA=o,this.toA=i,this.fromB=n,this.toB=r,this.precise=s}offset(t,o){return t||o?new ot(this.changes,this.fromA+t,this.toA+t,this.fromB+o,this.toB+o,this.precise):this}get endA(){return Math.max(this.fromA,this.toA-1)}get endB(){return Math.max(this.fromB,this.toB-1)}static build(t,o,i){return Ue(Ne(t.toString(),o.toString(),i),t,o,0,0,Ge())}static updateA(t,o,i,n,r){return qe(je(t,n,!0,i.length),t,o,i,r)}static updateB(t,o,i,n,r){return qe(je(t,n,!1,o.length),t,o,i,r)}};function Ve(e,t,o,i){let n=o.lineAt(e),r=i.lineAt(t);return n.to==e&&r.to==t&&e<o.length&&t<i.length?[e+1,t+1]:[n.from,r.from]}function He(e,t,o,i){let n=o.lineAt(e),r=i.lineAt(t);return n.from==e&&r.from==t?[e,t]:[n.to+1,r.to+1]}function Ue(e,t,o,i,n,r){let s=[];for(let l=0;l<e.length;l++){let f=e[l],[d,a]=Ve(f.fromA+i,f.fromB+n,t,o),[c,h]=He(f.toA+i,f.toB+n,t,o),u=[f.offset(-d+i,-a+n)];for(;l<e.length-1;){let g=e[l+1],[p,m]=Ve(g.fromA+i,g.fromB+n,t,o);if(p>c+1&&m>h+1)break;u.push(g.offset(-d+i,-a+n)),[c,h]=He(g.toA+i,g.toB+n,t,o),l++}s.push(new S(u,d,Math.max(d,c),a,Math.max(a,h),r))}return s}var W=1e3;function Ie(e,t,o,i){let n=0,r=e.length;for(;;){if(n==r){let a=0,c=0;n&&({toA:a,toB:c}=e[n-1]);let h=t-(o?a:c);return[a+h,c+h]}let s=n+r>>1,l=e[s],[f,d]=o?[l.fromA,l.toA]:[l.fromB,l.toB];if(f>t)r=s;else if(d<=t)n=s+1;else return i?[l.fromA,l.fromB]:[l.toA,l.toB]}}function je(e,t,o,i){let n=[];return t.iterChangedRanges((r,s,l,f)=>{let d=0,a=o?t.length:i,c=0,h=o?i:t.length;r>W&&([d,c]=Ie(e,r-W,o,!0)),s<t.length-W&&([a,h]=Ie(e,s+W,o,!1));let u=f-l-(s-r),g,[p,m]=o?[u,0]:[0,u];n.length&&(g=n[n.length-1]).toA>=d?n[n.length-1]={fromA:g.fromA,fromB:g.fromB,toA:a,toB:h,diffA:g.diffA+p,diffB:g.diffB+m}:n.push({fromA:d,toA:a,fromB:c,toB:h,diffA:p,diffB:m})}),n}function qe(e,t,o,i,n){if(!e.length)return t;let r=[];for(let s=0,l=0,f=0,d=0;;s++){let a=s==e.length?null:e[s],c=a?a.fromA+l:o.length,h=a?a.fromB+f:i.length;for(;d<t.length;){let m=t[d];if(m.toA+l>c||m.toB+f>h)break;r.push(m.offset(l,f)),d++}if(!a)break;let u=a.toA+l+a.diffA,g=a.toB+f+a.diffB,p=Ne(o.sliceString(c,u),i.sliceString(h,g),n);for(let m of Ue(p,o,i,c,h,Ge()))r.push(m);for(l+=a.diffA,f+=a.diffB;d<t.length;){let m=t[d];if(m.fromA+l>u&&m.fromB+f>g)break;d++}}return r}var ze={scanLimit:500},F=at.fromClass(class{constructor(e){({deco:this.deco,gutter:this.gutter}=Ye(e))}update(e){(e.docChanged||e.viewportChanged||mt(e.startState,e.state)||gt(e.startState,e.state))&&({deco:this.deco,gutter:this.gutter}=Ye(e.view))}},{decorations:e=>e.deco}),P=q.low(ge({class:"cm-changeGutter",markers:e=>{var t;return((t=e.plugin(F))==null?void 0:t.gutter)||de.empty}}));function mt(e,t){return e.field(M,!1)!=t.field(M,!1)}function gt(e,t){return e.facet(k)!=t.facet(k)}var We=w.line({class:"cm-changedLine"}),Fe=w.mark({class:"cm-changedText"}),pt=w.mark({tagName:"ins",class:"cm-insertedLine"}),At=w.mark({tagName:"del",class:"cm-deletedLine"}),Pe=new class extends X{constructor(){super(...arguments),this.elementClass="cm-changedLineGutter"}};function vt(e,t,o,i,n,r){let s=o?e.fromA:e.fromB,l=o?e.toA:e.toB,f=0;if(s!=l){n.add(s,s,We),n.add(s,l,o?At:pt),r&&r.add(s,s,Pe);for(let d=t.iterRange(s,l-1),a=s;!d.next().done;){if(d.lineBreak){a++,n.add(a,a,We),r&&r.add(a,a,Pe);continue}let c=a+d.value.length;if(i)for(;f<e.changes.length;){let h=e.changes[f],u=s+(o?h.fromA:h.fromB),g=s+(o?h.toA:h.toB),p=Math.max(a,u),m=Math.min(c,g);if(p<m&&n.add(p,m,Fe),g<c)f++;else break}a=c}}}function Ye(e){let t=e.state.field(M),{side:o,highlightChanges:i,markGutter:n,overrideChunk:r}=e.state.facet(k),s=o=="a",l=new G,f=n?new G:null,{from:d,to:a}=e.viewport;for(let c of t){if((s?c.fromA:c.fromB)>=a)break;(s?c.toA:c.toB)>d&&(!r||!r(e.state,c,l,f))&&vt(c,e.state.doc,s,i,l,f)}return{deco:l.finish(),gutter:f&&f.finish()}}var Y=class extends z{constructor(e){super(),this.height=e}eq(e){return this.height==e.height}toDOM(){let e=document.createElement("div");return e.className="cm-mergeSpacer",e.style.height=this.height+"px",e}updateDOM(e){return e.style.height=this.height+"px",!0}get estimatedHeight(){return this.height}ignoreEvent(){return!1}},K=T.define({map:(e,t)=>e.map(t)}),j=H.define({create:()=>w.none,update:(e,t)=>{for(let o of t.effects)if(o.is(K))return o.value;return e.map(t.changes)},provide:e=>O.decorations.from(e)}),$=.01;function Ke(e,t){if(e.size!=t.size)return!1;let o=e.iter(),i=t.iter();for(;o.value;){if(o.from!=i.from||Math.abs(o.value.spec.widget.height-i.value.spec.widget.height)>1)return!1;o.next(),i.next()}return!0}function Bt(e,t,o){let i=new G,n=new G,r=e.state.field(j).iter(),s=t.state.field(j).iter(),l=0,f=0,d=0,a=0,c=e.viewport,h=t.viewport;for(let m=0;;m++){let A=m<o.length?o[m]:null,D=A?A.fromA:e.state.doc.length,C=A?A.fromB:t.state.doc.length;if(l<D){let v=e.lineBlockAt(l).top+d-(t.lineBlockAt(f).top+a);v<-$?(d-=v,i.add(l,l,w.widget({widget:new Y(-v),block:!0,side:-1}))):v>$&&(a+=v,n.add(f,f,w.widget({widget:new Y(v),block:!0,side:-1})))}if(D>l+1e3&&l<c.from&&D>c.from&&f<h.from&&C>h.from){let v=Math.min(c.from-l,h.from-f);l+=v,f+=v,m--}else if(A)l=A.toA,f=A.toB;else break;for(;r.value&&r.from<l;)d-=r.value.spec.widget.height,r.next();for(;s.value&&s.from<f;)a-=s.value.spec.widget.height,s.next()}for(;r.value;)d-=r.value.spec.widget.height,r.next();for(;s.value;)a-=s.value.spec.widget.height,s.next();let u=e.contentHeight+d-(t.contentHeight+a);u<$?i.add(e.state.doc.length,e.state.doc.length,w.widget({widget:new Y(-u),block:!0,side:1})):u>$&&n.add(t.state.doc.length,t.state.doc.length,w.widget({widget:new Y(u),block:!0,side:1}));let g=i.finish(),p=n.finish();Ke(g,e.state.field(j))||e.dispatch({effects:K.of(g)}),Ke(p,t.state.field(j))||t.dispatch({effects:K.of(p)})}var ie=T.define({map:(e,t)=>t.mapPos(e)}),bt=class extends z{constructor(e){super(),this.lines=e}eq(e){return this.lines==e.lines}toDOM(e){let t=document.createElement("div");return t.className="cm-collapsedLines",t.textContent=e.state.phrase("$ unchanged lines",this.lines),t.addEventListener("click",o=>{let i=e.posAtDOM(o.target);e.dispatch({effects:ie.of(i)});let{side:n,sibling:r}=e.state.facet(k);r&&r().dispatch({effects:ie.of(Ct(i,e.state.field(M),n=="a"))})}),t}ignoreEvent(e){return e instanceof MouseEvent}get estimatedHeight(){return 27}get type(){return"collapsed-unchanged-code"}};function Ct(e,t,o){let i=0,n=0;for(let r=0;;r++){let s=r<t.length?t[r]:null;if(!s||(o?s.fromA:s.fromB)>=e)return n+(e-i);[i,n]=o?[s.toA,s.toB]:[s.toB,s.toA]}}var wt=H.define({create(e){return w.none},update(e,t){e=e.map(t.changes);for(let o of t.effects)o.is(ie)&&(e=e.update({filter:i=>i!=o.value}));return e},provide:e=>O.decorations.from(e)});function se({margin:e=3,minSize:t=4}){return wt.init(o=>kt(o,e,t))}function kt(e,t,o){let i=new G,n=e.facet(k).side=="a",r=e.field(M),s=1;for(let l=0;;l++){let f=l<r.length?r[l]:null,d=l?s+t:1,a=f?e.doc.lineAt(n?f.fromA:f.fromB).number-1-t:e.doc.lines,c=a-d+1;if(c>=o&&i.add(e.doc.line(d).from,e.doc.line(a).to,w.replace({widget:new bt(c),block:!0})),!f)break;s=e.doc.lineAt(Math.min(e.doc.length,n?f.toA:f.toB)).number}return i.finish()}var xt=O.styleModule.of(new lt({".cm-mergeView":{overflowY:"auto"},".cm-mergeViewEditors":{display:"flex",alignItems:"stretch"},".cm-mergeViewEditor":{flexGrow:1,flexBasis:0,overflow:"hidden"},".cm-merge-revert":{width:"1.6em",flexGrow:0,flexShrink:0,position:"relative"},".cm-merge-revert button":{position:"absolute",display:"block",width:"100%",boxSizing:"border-box",textAlign:"center",background:"none",border:"none",font:"inherit",cursor:"pointer"}})),$e=O.baseTheme({".cm-mergeView & .cm-scroller, .cm-mergeView &":{height:"auto !important",overflowY:"visible !important"},"&.cm-merge-a .cm-changedLine, .cm-deletedChunk":{backgroundColor:"rgba(160, 128, 100, .08)"},"&.cm-merge-b .cm-changedLine, .cm-inlineChangedLine":{backgroundColor:"rgba(100, 160, 128, .08)"},"&light.cm-merge-a .cm-changedText, &light .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ee443366, #ee443366) bottom/100% 2px no-repeat"},"&dark.cm-merge-a .cm-changedText, &dark .cm-deletedChunk .cm-deletedText":{background:"linear-gradient(#ffaa9966, #ffaa9966) bottom/100% 2px no-repeat"},"&light.cm-merge-b .cm-changedText":{background:"linear-gradient(#22bb22aa, #22bb22aa) bottom/100% 2px no-repeat"},"&dark.cm-merge-b .cm-changedText":{background:"linear-gradient(#88ff88aa, #88ff88aa) bottom/100% 2px no-repeat"},"&.cm-merge-b .cm-deletedText":{background:"#ff000033"},".cm-insertedLine, .cm-deletedLine, .cm-deletedLine del":{textDecoration:"none"},".cm-deletedChunk":{paddingLeft:"6px","& .cm-chunkButtons":{position:"absolute",insetInlineEnd:"5px"},"& button":{border:"none",cursor:"pointer",color:"white",margin:"0 2px",borderRadius:"3px","&[name=accept]":{background:"#2a2"},"&[name=reject]":{background:"#d43"}}},".cm-collapsedLines":{padding:"5px 5px 5px 10px",cursor:"pointer","&:before":{content:'"\u299A"',marginInlineEnd:"7px"},"&:after":{content:'"\u299A"',marginInlineStart:"7px"}},"&light .cm-collapsedLines":{color:"#444",background:"linear-gradient(to bottom, transparent 0, #f3f3f3 30%, #f3f3f3 70%, transparent 100%)"},"&dark .cm-collapsedLines":{color:"#ddd",background:"linear-gradient(to bottom, transparent 0, #222 30%, #222 70%, transparent 100%)"},".cm-changeGutter":{width:"3px",paddingLeft:"1px"},"&light.cm-merge-a .cm-changedLineGutter, &light .cm-deletedLineGutter":{background:"#e43"},"&dark.cm-merge-a .cm-changedLineGutter, &dark .cm-deletedLineGutter":{background:"#fa9"},"&light.cm-merge-b .cm-changedLineGutter":{background:"#2b2"},"&dark.cm-merge-b .cm-changedLineGutter":{background:"#8f8"},".cm-inlineChangedLineGutter":{background:"#75d"}}),Je=new he,J=new he,Mt=class{constructor(e){this.revertDOM=null,this.revertToA=!1,this.revertToLeft=!1,this.measuring=-1,this.diffConf=e.diffConfig||ze;let t=[q.low(F),$e,xt,j,O.updateListener.of(a=>{this.measuring<0&&(a.heightChanged||a.viewportChanged)&&!a.transactions.some(c=>c.effects.some(h=>h.is(K)))&&this.measure()})],o=[k.of({side:"a",sibling:()=>this.b,highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1})];e.gutter!==!1&&o.push(P);let i=me.create({doc:e.a.doc,selection:e.a.selection,extensions:[e.a.extensions||[],O.editorAttributes.of({class:"cm-merge-a"}),J.of(o),t]}),n=[k.of({side:"b",sibling:()=>this.a,highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1})];e.gutter!==!1&&n.push(P);let r=me.create({doc:e.b.doc,selection:e.b.selection,extensions:[e.b.extensions||[],O.editorAttributes.of({class:"cm-merge-b"}),J.of(n),t]});this.chunks=S.build(i.doc,r.doc,this.diffConf);let s=[M.init(()=>this.chunks),Je.of(e.collapseUnchanged?se(e.collapseUnchanged):[])];i=i.update({effects:T.appendConfig.of(s)}).state,r=r.update({effects:T.appendConfig.of(s)}).state,this.dom=document.createElement("div"),this.dom.className="cm-mergeView",this.editorDOM=this.dom.appendChild(document.createElement("div")),this.editorDOM.className="cm-mergeViewEditors";let l=e.orientation||"a-b",f=document.createElement("div");f.className="cm-mergeViewEditor";let d=document.createElement("div");d.className="cm-mergeViewEditor",this.editorDOM.appendChild(l=="a-b"?f:d),this.editorDOM.appendChild(l=="a-b"?d:f),this.a=new O({state:i,parent:f,root:e.root,dispatchTransactions:a=>this.dispatch(a,this.a)}),this.b=new O({state:r,parent:d,root:e.root,dispatchTransactions:a=>this.dispatch(a,this.b)}),this.setupRevertControls(!!e.revertControls,e.revertControls=="b-to-a",e.renderRevertControl),e.parent&&e.parent.appendChild(this.dom),this.scheduleMeasure()}dispatch(e,t){if(e.some(o=>o.docChanged)){let o=e[e.length-1],i=e.reduce((r,s)=>r.compose(s.changes),ue.empty(e[0].startState.doc.length));this.chunks=t==this.a?S.updateA(this.chunks,o.newDoc,this.b.state.doc,i,this.diffConf):S.updateB(this.chunks,this.a.state.doc,o.newDoc,i,this.diffConf),t.update([...e,o.state.update({effects:ne.of(this.chunks)})]);let n=t==this.a?this.b:this.a;n.update([n.state.update({effects:ne.of(this.chunks)})]),this.scheduleMeasure()}else t.update(e)}reconfigure(e){if("diffConfig"in e&&(this.diffConf=e.diffConfig),"orientation"in e){let n=e.orientation!="b-a";if(n!=(this.editorDOM.firstChild==this.a.dom.parentNode)){let r=this.a.dom.parentNode,s=this.b.dom.parentNode;r.remove(),s.remove(),this.editorDOM.insertBefore(n?r:s,this.editorDOM.firstChild),this.editorDOM.appendChild(n?s:r),this.revertToLeft=!this.revertToLeft,this.revertDOM&&(this.revertDOM.textContent="")}}if("revertControls"in e||"renderRevertControl"in e){let n=!!this.revertDOM,r=this.revertToA,s=this.renderRevert;"revertControls"in e&&(n=!!e.revertControls,r=e.revertControls=="b-to-a"),"renderRevertControl"in e&&(s=e.renderRevertControl),this.setupRevertControls(n,r,s)}let t="highlightChanges"in e,o="gutter"in e,i="collapseUnchanged"in e;if(t||o||i){let n=[],r=[];if(t||o){let s=this.a.state.facet(k),l=o?e.gutter!==!1:s.markGutter,f=t?e.highlightChanges!==!1:s.highlightChanges;n.push(J.reconfigure([k.of({side:"a",sibling:()=>this.b,highlightChanges:f,markGutter:l}),l?P:[]])),r.push(J.reconfigure([k.of({side:"b",sibling:()=>this.a,highlightChanges:f,markGutter:l}),l?P:[]]))}if(i){let s=Je.reconfigure(e.collapseUnchanged?se(e.collapseUnchanged):[]);n.push(s),r.push(s)}this.a.dispatch({effects:n}),this.b.dispatch({effects:r})}this.scheduleMeasure()}setupRevertControls(e,t,o){this.revertToA=t,this.revertToLeft=this.revertToA==(this.editorDOM.firstChild==this.a.dom.parentNode),this.renderRevert=o,!e&&this.revertDOM?(this.revertDOM.remove(),this.revertDOM=null):e&&!this.revertDOM?(this.revertDOM=this.editorDOM.insertBefore(document.createElement("div"),this.editorDOM.firstChild.nextSibling),this.revertDOM.addEventListener("mousedown",i=>this.revertClicked(i)),this.revertDOM.className="cm-merge-revert"):this.revertDOM&&(this.revertDOM.textContent="")}scheduleMeasure(){this.measuring<0&&(this.measuring=(this.dom.ownerDocument.defaultView||window).requestAnimationFrame(()=>{this.measuring=-1,this.measure()}))}measure(){Bt(this.a,this.b,this.chunks),this.revertDOM&&this.updateRevertButtons()}updateRevertButtons(){let e=this.revertDOM,t=e.firstChild,o=this.a.viewport,i=this.b.viewport;for(let n=0;n<this.chunks.length;n++){let r=this.chunks[n];if(r.fromA>o.to||r.fromB>i.to)break;if(r.fromA<o.from||r.fromB<i.from)continue;let s=this.a.lineBlockAt(r.fromA).top+"px";for(;t&&+t.dataset.chunk<n;)t=Qe(t);t&&t.dataset.chunk==String(n)?(t.style.top!=s&&(t.style.top=s),t=t.nextSibling):e.insertBefore(this.renderRevertButton(s,n),t)}for(;t;)t=Qe(t)}renderRevertButton(e,t){let o;if(this.renderRevert)o=this.renderRevert();else{o=document.createElement("button");let i=this.a.state.phrase("Revert this chunk");o.setAttribute("aria-label",i),o.setAttribute("title",i),o.textContent=this.revertToLeft?"\u21DC":"\u21DD"}return o.style.top=e,o.setAttribute("data-chunk",String(t)),o}revertClicked(e){let t=e.target,o;for(;t&&t.parentNode!=this.revertDOM;)t=t.parentNode;if(t&&(o=this.chunks[t.dataset.chunk])){let[i,n,r,s,l,f]=this.revertToA?[this.b,this.a,o.fromB,o.toB,o.fromA,o.toA]:[this.a,this.b,o.fromA,o.toA,o.fromB,o.toB],d=i.state.sliceDoc(r,Math.max(r,s-1));r!=s&&f<=n.state.doc.length&&(d+=i.state.lineBreak),n.dispatch({changes:{from:l,to:Math.min(n.state.doc.length,f),insert:d},userEvent:"revert"}),e.preventDefault()}}destroy(){this.a.destroy(),this.b.destroy(),this.measuring>-1&&(this.dom.ownerDocument.defaultView||window).cancelAnimationFrame(this.measuring),this.dom.remove()}};function Qe(e){let t=e.nextSibling;return e.remove(),t}var Dt=new class extends X{constructor(){super(...arguments),this.elementClass="cm-deletedLineGutter"}},Ot=q.low(ge({class:"cm-changeGutter",markers:e=>{var t;return((t=e.plugin(F))==null?void 0:t.gutter)||de.empty},widgetMarker:(e,t)=>t instanceof Ze?Dt:null}));function Lt(e){let t=typeof e.original=="string"?pe.of(e.original.split(/\r?\n/)):e.original,o=e.diffConfig||ze;return[q.low(F),Tt,$e,O.editorAttributes.of({class:"cm-merge-b"}),Re.of((i,n)=>{let r=n.effects.find(s=>s.is(le));return r&&(i=S.updateA(i,r.value.doc,n.startState.doc,r.value.changes,o)),n.docChanged&&(i=S.updateB(i,n.state.field(R),n.newDoc,n.changes,o)),i}),k.of({highlightChanges:e.highlightChanges!==!1,markGutter:e.gutter!==!1,syntaxHighlightDeletions:e.syntaxHighlightDeletions!==!1,syntaxHighlightDeletionsMaxLength:3e3,mergeControls:e.mergeControls??!0,overrideChunk:e.allowInlineDiffs?Vt:void 0,side:"b"}),R.init(()=>t),e.gutter===!1?[]:Ot,e.collapseUnchanged?se(e.collapseUnchanged):[],M.init(i=>S.build(t,i.doc,o))]}var le=T.define(),R=H.define({create:()=>pe.empty,update(e,t){for(let o of t.effects)o.is(le)&&(e=o.value.doc);return e}}),Xe=new WeakMap,Ze=class extends z{constructor(e){super(),this.buildDOM=e,this.dom=null}eq(e){return this.dom==e.dom}toDOM(e){return this.dom||(this.dom=this.buildDOM(e))}};function Et(e,t,o){let i=Xe.get(t.changes);if(i)return i;let n=w.widget({block:!0,side:-1,widget:new Ze(r=>{let{highlightChanges:s,syntaxHighlightDeletions:l,syntaxHighlightDeletionsMaxLength:f,mergeControls:d}=e.facet(k),a=document.createElement("div");if(a.className="cm-deletedChunk",d){let C=a.appendChild(document.createElement("div"));C.className="cm-chunkButtons";let v=B=>{B.preventDefault(),yt(r,r.posAtDOM(a))},L=B=>{B.preventDefault(),St(r,r.posAtDOM(a))};if(typeof d=="function")C.appendChild(d("accept",v)),C.appendChild(d("reject",L));else{let B=C.appendChild(document.createElement("button"));B.name="accept",B.textContent=e.phrase("Accept"),B.onmousedown=v;let x=C.appendChild(document.createElement("button"));x.name="reject",x.textContent=e.phrase("Reject"),x.onmousedown=L}}if(o||t.fromA>=t.toA)return a;let c=r.state.field(R).sliceString(t.fromA,t.endA),h=l&&e.facet(nt),u=A(),g=t.changes,p=0,m=!1;function A(){let C=a.appendChild(document.createElement("div"));return C.className="cm-deletedLine",C.appendChild(document.createElement("del"))}function D(C,v,L){for(let B=C;B<v;){if(c.charAt(B)==`
`){u.firstChild||u.appendChild(document.createElement("br")),u=A(),B++;continue}let x=v,ae=L+(m?" cm-deletedText":""),fe=!1,Q=c.indexOf(`
`,B);if(Q>-1&&Q<v&&(x=Q),s&&p<g.length){let V=Math.max(0,m?g[p].toA:g[p].fromA);V<=x&&(x=V,m&&p++,fe=!0)}if(x>B){let V=document.createTextNode(c.slice(B,x));if(ae){let ce=u.appendChild(document.createElement("span"));ce.className=ae,ce.appendChild(V)}else u.appendChild(V);B=x}fe&&(m=!m)}}if(h&&t.toA-t.fromA<=f){let C=h.parser.parse(c),v=0;it(C,{style:L=>st(e,L)},(L,B,x)=>{L>v&&D(v,L,""),D(L,B,x),v=B}),D(v,c.length,"")}else D(0,c.length,"");return u.firstChild||u.appendChild(document.createElement("br")),a})});return Xe.set(t.changes,n),n}function yt(e,t){let{state:o}=e,i=t??o.selection.main.head,n=e.state.field(M).find(f=>f.fromB<=i&&f.endB>=i);if(!n)return!1;let r=e.state.sliceDoc(n.fromB,Math.max(n.fromB,n.toB-1)),s=e.state.field(R);n.fromB!=n.toB&&n.toA<=s.length&&(r+=e.state.lineBreak);let l=ue.of({from:n.fromA,to:Math.min(s.length,n.toA),insert:r},s.length);return e.dispatch({effects:le.of({doc:l.apply(s),changes:l}),userEvent:"accept"}),!0}function St(e,t){let{state:o}=e,i=t??o.selection.main.head,n=o.field(M).find(s=>s.fromB<=i&&s.endB>=i);if(!n)return!1;let r=o.field(R).sliceString(n.fromA,Math.max(n.fromA,n.toA-1));return n.fromA!=n.toA&&n.toB<=o.doc.length&&(r+=o.lineBreak),e.dispatch({changes:{from:n.fromB,to:Math.min(o.doc.length,n.toB),insert:r},userEvent:"revert"}),!0}function _e(e){let t=new G;for(let o of e.field(M)){let i=e.facet(k).overrideChunk&&tt(e,o);t.add(o.fromB,o.fromB,Et(e,o,!!i))}return t.finish()}var Tt=H.define({create:e=>_e(e),update(e,t){return t.state.field(M,!1)==t.startState.field(M,!1)?e:_e(t.state)},provide:e=>O.decorations.from(e)}),et=new WeakMap;function tt(e,t){let o=et.get(t);if(o!==void 0)return o;o=null;let i=e.field(R),n=e.doc,r=i.lineAt(t.endA).number-i.lineAt(t.fromA).number+1,s=n.lineAt(t.endB).number-n.lineAt(t.fromB).number+1;e:if(r==s&&r<10){let l=[],f=0,d=t.fromA,a=t.fromB;for(let c of t.changes){if(c.fromA<c.toA){f+=c.toA-c.fromA;let h=i.sliceString(d+c.fromA,d+c.toA);if(/\n/.test(h))break e;l.push(w.widget({widget:new Gt(h),side:-1}).range(a+c.fromB))}c.fromB<c.toB&&l.push(Fe.range(a+c.fromB,a+c.toB))}f<t.endA-t.fromA-r*2&&(o=l)}return et.set(t,o),o}var Gt=class extends z{constructor(e){super(),this.text=e}eq(e){return this.text==e.text}toDOM(e){let t=document.createElement("del");return t.className="cm-deletedText",t.textContent=this.text,t}},Nt=new class extends X{constructor(){super(...arguments),this.elementClass="cm-inlineChangedLineGutter"}},Rt=w.line({class:"cm-inlineChangedLine"});function Vt(e,t,o,i){let n=tt(e,t),r=0;if(!n)return!1;for(let s=e.doc.lineAt(t.fromB);;){for(i&&i.add(s.from,s.from,Nt),o.add(s.from,s.from,Rt);r<n.length&&n[r].to<=s.to;){let l=n[r++];o.add(l.from,l.to,l.value)}if(s.to>=t.endB)break;s=e.doc.lineAt(s.to+1)}return!0}export{Lt as n,Mt as t};
