var g;import{s as V}from"./chunk-DZLz74EQ.js";import{t as $}from"./memoize-CAcr7Wct.js";import{t as Z}from"./merge-BgA7kxZb.js";import{u as tt}from"./src-D-O4qgKm.js";import{_ as et,a as rt,c as it,d as nt,f as at,g as ot,h as st,i as lt,l as ct,m as ht,n as ut,o as ft,p as dt,r as gt,s as xt,t as pt,u as yt,v as mt}from"./step-DCnHyPDa.js";import{n as s,r as y}from"./src-Ci62OB0C.js";import{F as vt,f as _t,m as v,r as A,s as M}from"./chunk-ABZYJK2D-D-T6tPym.js";import{t as $t}from"./dist-D3R7S_yk.js";var E=class{constructor(e,t){this._context=e,this._x=t}areaStart(){this._line=0}areaEnd(){this._line=NaN}lineStart(){this._point=0}lineEnd(){(this._line||this._line!==0&&this._point===1)&&this._context.closePath(),this._line=1-this._line}point(e,t){switch(e=+e,t=+t,this._point){case 0:this._point=1,this._line?this._context.lineTo(e,t):this._context.moveTo(e,t);break;case 1:this._point=2;default:this._x?this._context.bezierCurveTo(this._x0=(this._x0+e)/2,this._y0,this._x0,t,e,t):this._context.bezierCurveTo(this._x0,this._y0=(this._y0+t)/2,e,this._y0,e,t);break}this._x0=e,this._y0=t}};function N(e){return new E(e,!0)}function P(e){return new E(e,!1)}var Mt=V($t(),1),bt="\u200B",wt={curveBasis:et,curveBasisClosed:ot,curveBasisOpen:st,curveBumpX:N,curveBumpY:P,curveBundle:ht,curveCardinalClosed:at,curveCardinalOpen:nt,curveCardinal:dt,curveCatmullRomClosed:ct,curveCatmullRomOpen:it,curveCatmullRom:yt,curveLinear:mt,curveLinearClosed:xt,curveMonotoneX:rt,curveMonotoneY:ft,curveNatural:lt,curveStep:gt,curveStepAfter:pt,curveStepBefore:ut},St=/\s*(?:(\w+)(?=:):|(\w+))\s*(?:(\w+)|((?:(?!}%{2}).|\r?\n)*))?\s*(?:}%{2})?/gi,Ct=s(function(e,t){let r=D(e,/(?:init\b)|(?:initialize\b)/),i={};if(Array.isArray(r)){let o=r.map(l=>l.args);vt(o),i=A(i,[...o])}else i=r.args;if(!i)return;let a=_t(e,t),n="config";return i[n]!==void 0&&(a==="flowchart-v2"&&(a="flowchart"),i[a]=i[n],delete i[n]),i},"detectInit"),D=s(function(e,t=null){var r,i;try{let a=RegExp(`[%]{2}(?![{]${St.source})(?=[}][%]{2}).*
`,"ig");e=e.trim().replace(a,"").replace(/'/gm,'"'),y.debug(`Detecting diagram directive${t===null?"":" type:"+t} based on the text:${e}`);let n,o=[];for(;(n=v.exec(e))!==null;)if(n.index===v.lastIndex&&v.lastIndex++,n&&!t||t&&((r=n[1])==null?void 0:r.match(t))||t&&((i=n[2])==null?void 0:i.match(t))){let l=n[1]?n[1]:n[2],c=n[3]?n[3].trim():n[4]?JSON.parse(n[4].trim()):null;o.push({type:l,args:c})}return o.length===0?{type:e,args:null}:o.length===1?o[0]:o}catch(a){return y.error(`ERROR: ${a.message} - Unable to parse directive type: '${t}' based on the text: '${e}'`),{type:void 0,args:null}}},"detectDirective"),It=s(function(e){return e.replace(v,"")},"removeDirectives"),Tt=s(function(e,t){for(let[r,i]of t.entries())if(i.match(e))return r;return-1},"isSubstringInArray");function b(e,t){return e?wt[`curve${e.charAt(0).toUpperCase()+e.slice(1)}`]??t:t}s(b,"interpolateToCurve");function H(e,t){let r=e.trim();if(r)return t.securityLevel==="loose"?r:(0,Mt.sanitizeUrl)(r)}s(H,"formatUrl");var Bt=s((e,...t)=>{let r=e.split("."),i=r.length-1,a=r[i],n=window;for(let o=0;o<i;o++)if(n=n[r[o]],!n){y.error(`Function name: ${e} not found in window`);return}n[a](...t)},"runFunc");function w(e,t){return!e||!t?0:Math.sqrt((t.x-e.x)**2+(t.y-e.y)**2)}s(w,"distance");function L(e){let t,r=0;return e.forEach(i=>{r+=w(i,t),t=i}),S(e,r/2)}s(L,"traverseEdge");function R(e){return e.length===1?e[0]:L(e)}s(R,"calcLabelPosition");var O=s((e,t=2)=>{let r=10**t;return Math.round(e*r)/r},"roundNumber"),S=s((e,t)=>{let r,i=t;for(let a of e){if(r){let n=w(a,r);if(n===0)return r;if(n<i)i-=n;else{let o=i/n;if(o<=0)return r;if(o>=1)return{x:a.x,y:a.y};if(o>0&&o<1)return{x:O((1-o)*r.x+o*a.x,5),y:O((1-o)*r.y+o*a.y,5)}}}r=a}throw Error("Could not find a suitable point for the given distance")},"calculatePoint"),Wt=s((e,t,r)=>{y.info(`our points ${JSON.stringify(t)}`),t[0]!==r&&(t=t.reverse());let i=S(t,25),a=e?10:5,n=Math.atan2(t[0].y-i.y,t[0].x-i.x),o={x:0,y:0};return o.x=Math.sin(n)*a+(t[0].x+i.x)/2,o.y=-Math.cos(n)*a+(t[0].y+i.y)/2,o},"calcCardinalityPosition");function j(e,t,r){let i=structuredClone(r);y.info("our points",i),t!=="start_left"&&t!=="start_right"&&i.reverse();let a=S(i,25+e),n=10+e*.5,o=Math.atan2(i[0].y-a.y,i[0].x-a.x),l={x:0,y:0};return t==="start_left"?(l.x=Math.sin(o+Math.PI)*n+(i[0].x+a.x)/2,l.y=-Math.cos(o+Math.PI)*n+(i[0].y+a.y)/2):t==="end_right"?(l.x=Math.sin(o-Math.PI)*n+(i[0].x+a.x)/2-5,l.y=-Math.cos(o-Math.PI)*n+(i[0].y+a.y)/2-5):t==="end_left"?(l.x=Math.sin(o)*n+(i[0].x+a.x)/2-5,l.y=-Math.cos(o)*n+(i[0].y+a.y)/2-5):(l.x=Math.sin(o)*n+(i[0].x+a.x)/2,l.y=-Math.cos(o)*n+(i[0].y+a.y)/2),l}s(j,"calcTerminalLabelPosition");function C(e){let t="",r="";for(let i of e)i!==void 0&&(i.startsWith("color:")||i.startsWith("text-align:")?r=r+i+";":t=t+i+";");return{style:t,labelStyle:r}}s(C,"getStylesFromArray");var k=0,U=s(()=>(k++,"id-"+Math.random().toString(36).substr(2,12)+"-"+k),"generateId");function G(e){let t="";for(let r=0;r<e;r++)t+="0123456789abcdef".charAt(Math.floor(Math.random()*16));return t}s(G,"makeRandomHex");var J=s(e=>G(e.length),"random"),Ft=s(function(){return{x:0,y:0,fill:void 0,anchor:"start",style:"#666",width:100,height:100,textMargin:0,rx:0,ry:0,valign:void 0,text:""}},"getTextObj"),zt=s(function(e,t){let r=t.text.replace(M.lineBreakRegex," "),[,i]=_(t.fontSize),a=e.append("text");a.attr("x",t.x),a.attr("y",t.y),a.style("text-anchor",t.anchor),a.style("font-family",t.fontFamily),a.style("font-size",i),a.style("font-weight",t.fontWeight),a.attr("fill",t.fill),t.class!==void 0&&a.attr("class",t.class);let n=a.append("tspan");return n.attr("x",t.x+t.textMargin*2),n.attr("fill",t.fill),n.text(r),a},"drawSimpleText"),X=$((e,t,r)=>{if(!e||(r=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",joinWith:"<br/>"},r),M.lineBreakRegex.test(e)))return e;let i=e.split(" ").filter(Boolean),a=[],n="";return i.forEach((o,l)=>{let c=d(`${o} `,r),h=d(n,r);if(c>t){let{hyphenatedStrings:u,remainingWord:x}=At(o,t,"-",r);a.push(n,...u),n=x}else h+c>=t?(a.push(n),n=o):n=[n,o].filter(Boolean).join(" ");l+1===i.length&&a.push(n)}),a.filter(o=>o!=="").join(r.joinWith)},(e,t,r)=>`${e}${t}${r.fontSize}${r.fontWeight}${r.fontFamily}${r.joinWith}`),At=$((e,t,r="-",i)=>{i=Object.assign({fontSize:12,fontWeight:400,fontFamily:"Arial",margin:0},i);let a=[...e],n=[],o="";return a.forEach((l,c)=>{let h=`${o}${l}`;if(d(h,i)>=t){let u=c+1,x=a.length===u,p=`${h}${r}`;n.push(x?h:p),o=""}else o=h}),{hyphenatedStrings:n,remainingWord:o}},(e,t,r="-",i)=>`${e}${t}${r}${i.fontSize}${i.fontWeight}${i.fontFamily}`);function I(e,t){return T(e,t).height}s(I,"calculateTextHeight");function d(e,t){return T(e,t).width}s(d,"calculateTextWidth");var T=$((e,t)=>{let{fontSize:r=12,fontFamily:i="Arial",fontWeight:a=400}=t;if(!e)return{width:0,height:0};let[,n]=_(r),o=["sans-serif",i],l=e.split(M.lineBreakRegex),c=[],h=tt("body");if(!h.remove)return{width:0,height:0,lineHeight:0};let u=h.append("svg");for(let x of o){let p=0,f={width:0,height:0,lineHeight:0};for(let Q of l){let F=Ft();F.text=Q||"\u200B";let z=zt(u,F).style("font-size",n).style("font-weight",a).style("font-family",x),m=(z._groups||z)[0][0].getBBox();if(m.width===0&&m.height===0)throw Error("svg element not in render tree");f.width=Math.round(Math.max(f.width,m.width)),p=Math.round(m.height),f.height+=p,f.lineHeight=Math.round(Math.max(f.lineHeight,p))}c.push(f)}return u.remove(),c[isNaN(c[1].height)||isNaN(c[1].width)||isNaN(c[1].lineHeight)||c[0].height>c[1].height&&c[0].width>c[1].width&&c[0].lineHeight>c[1].lineHeight?0:1]},(e,t)=>`${e}${t.fontSize}${t.fontWeight}${t.fontFamily}`),Et=(g=class{constructor(t=!1,r){this.count=0,this.count=r?r.length:0,this.next=t?()=>this.count++:()=>Date.now()}},s(g,"InitIDGenerator"),g),B,Nt=s(function(e){return B||(B=document.createElement("div")),e=escape(e).replace(/%26/g,"&").replace(/%23/g,"#").replace(/%3B/g,";"),B.innerHTML=e,unescape(B.textContent)},"entityDecode");function Y(e){return"str"in e}s(Y,"isDetailedError");var Pt=s((e,t,r,i)=>{var n;if(!i)return;let a=(n=e.node())==null?void 0:n.getBBox();a&&e.append("text").text(i).attr("text-anchor","middle").attr("x",a.x+a.width/2).attr("y",-r).attr("class",t)},"insertTitle"),_=s(e=>{if(typeof e=="number")return[e,e+"px"];let t=parseInt(e??"",10);return Number.isNaN(t)?[void 0,void 0]:e===String(t)?[t,e+"px"]:[t,e]},"parseFontSize");function W(e,t){return Z({},e,t)}s(W,"cleanAndMerge");var Dt={assignWithDepth:A,wrapLabel:X,calculateTextHeight:I,calculateTextWidth:d,calculateTextDimensions:T,cleanAndMerge:W,detectInit:Ct,detectDirective:D,isSubstringInArray:Tt,interpolateToCurve:b,calcLabelPosition:R,calcCardinalityPosition:Wt,calcTerminalLabelPosition:j,formatUrl:H,getStylesFromArray:C,generateId:U,random:J,runFunc:Bt,entityDecode:Nt,insertTitle:Pt,isLabelCoordinateInPath:K,parseFontSize:_,InitIDGenerator:Et},Ht=s(function(e){let t=e;return t=t.replace(/style.*:\S*#.*;/g,function(r){return r.substring(0,r.length-1)}),t=t.replace(/classDef.*:\S*#.*;/g,function(r){return r.substring(0,r.length-1)}),t=t.replace(/#\w+;/g,function(r){let i=r.substring(1,r.length-1);return/^\+?\d+$/.test(i)?"\uFB02\xB0\xB0"+i+"\xB6\xDF":"\uFB02\xB0"+i+"\xB6\xDF"}),t},"encodeEntities"),Lt=s(function(e){return e.replace(/ﬂ°°/g,"&#").replace(/ﬂ°/g,"&").replace(/¶ß/g,";")},"decodeEntities"),Rt=s((e,t,{counter:r=0,prefix:i,suffix:a},n)=>n||`${i?`${i}_`:""}${e}_${t}_${r}${a?`_${a}`:""}`,"getEdgeId");function q(e){return e??null}s(q,"handleUndefinedAttr");function K(e,t){let r=Math.round(e.x),i=Math.round(e.y),a=t.replace(/(\d+\.\d+)/g,n=>Math.round(parseFloat(n)).toString());return a.includes(r.toString())||a.includes(i.toString())}s(K,"isLabelCoordinateInPath");export{X as _,Lt as a,Rt as c,b as d,Y as f,Dt as g,It as h,W as i,C as l,J as m,I as n,Ht as o,_ as p,d as r,U as s,bt as t,q as u,N as v,P as y};
