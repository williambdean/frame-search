import{s as Y}from"./chunk-DZLz74EQ.js";import{t as yt}from"./react-BcIddLXZ.js";import{n as pt}from"./jsx-runtime-DvsdsEjx.js";import{t as wt}from"./_baseIsEqual-BF8660ot.js";var $=(t,e)=>t.unstable_is?t.unstable_is(e):e===t,Q=t=>"init"in t,X=t=>!!t.write,Z=t=>"v"in t||"e"in t,T=t=>{if("e"in t)throw t.e;return t.v},I=new WeakMap,x=t=>{var e;return N(t)&&!!((e=I.get(t))!=null&&e[0])},mt=t=>{let e=I.get(t);e!=null&&e[0]&&(e[0]=!1,e[1].forEach(r=>r()))},C=(t,e)=>{let r=I.get(t);if(!r){r=[!0,new Set],I.set(t,r);let l=()=>{r[0]=!1};t.then(l,l)}r[1].add(e)},N=t=>typeof(t==null?void 0:t.then)=="function",tt=(t,e,r)=>{r.p.has(t)||(r.p.add(t),e.then(()=>{r.p.delete(t)},()=>{r.p.delete(t)}))},H=(t,e,r)=>{let l=r(t),u="v"in l,d=l.v;if(N(e))for(let g of l.d.keys())tt(t,e,r(g));l.v=e,delete l.e,(!u||!Object.is(d,l.v))&&(++l.n,N(d)&&mt(d))},et=(t,e,r)=>{var u;let l=new Set;for(let d of((u=r.get(t))==null?void 0:u.t)||[])r.has(d)&&l.add(d);for(let d of e.p)l.add(d);return l},rt=Symbol(),bt=t=>t[rt],nt=(t=new WeakMap,e=new WeakMap,r=new WeakMap,l=new Set,u=new Set,d=new Set,g={},E=(h,...m)=>h.read(...m),M=(h,...m)=>h.write(...m),c=(h,m)=>{var v;return(v=h.unstable_onInit)==null?void 0:v.call(h,m)},w=(h,m)=>{var v;return(v=h.onMount)==null?void 0:v.call(h,m)},...b)=>{let h=b[0]||(n=>{let f=t.get(n);return f||(f={d:new Map,p:new Set,n:0},t.set(n,f),c==null||c(n,F)),f}),m=b[1]||(()=>{let n=[],f=i=>{try{i()}catch(o){n.push(o)}};do{g.f&&f(g.f);let i=new Set,o=i.add.bind(i);l.forEach(s=>{var a;return(a=e.get(s))==null?void 0:a.l.forEach(o)}),l.clear(),d.forEach(o),d.clear(),u.forEach(o),u.clear(),i.forEach(f),l.size&&v()}while(l.size||d.size||u.size);if(n.length)throw AggregateError(n)}),v=b[2]||(()=>{let n=[],f=new WeakSet,i=new WeakSet,o=Array.from(l);for(;o.length;){let s=o[o.length-1],a=h(s);if(i.has(s)){o.pop();continue}if(f.has(s)){r.get(s)===a.n&&n.push([s,a]),i.add(s),o.pop();continue}f.add(s);for(let y of et(s,a,e))f.has(y)||o.push(y)}for(let s=n.length-1;s>=0;--s){let[a,y]=n[s],S=!1;for(let j of y.d.keys())if(j!==a&&l.has(j)){S=!0;break}S&&(W(a),O(a)),r.delete(a)}}),W=b[3]||(n=>{var f;let i=h(n);if(Z(i)&&(e.has(n)&&r.get(n)!==i.n||Array.from(i.d).every(([p,R])=>W(p).n===R)))return i;i.d.clear();let o=!0,s=()=>{e.has(n)&&(O(n),v(),m())},a=p=>{var R;if($(n,p)){let U=h(p);if(!Z(U))if(Q(p))H(p,p.init,h);else throw Error("no atom init");return T(U)}let G=W(p);try{return T(G)}finally{i.d.set(p,G.n),x(i.v)&&tt(n,i.v,G),(R=e.get(p))==null||R.t.add(n),o||s()}},y,S,j={get signal(){return y||(y=new AbortController),y.signal},get setSelf(){return!S&&X(n)&&(S=(...p)=>{if(!o)try{return A(n,...p)}finally{v(),m()}}),S}},D=i.n;try{let p=E(n,a,j);return H(n,p,h),N(p)&&(C(p,()=>y==null?void 0:y.abort()),p.then(s,s)),i}catch(p){return delete i.v,i.e=p,++i.n,i}finally{o=!1,D!==i.n&&r.get(n)===D&&(r.set(n,i.n),l.add(n),(f=g.c)==null||f.call(g,n))}}),B=b[4]||(n=>{let f=[n];for(;f.length;){let i=f.pop(),o=h(i);for(let s of et(i,o,e)){let a=h(s);r.set(s,a.n),f.push(s)}}}),A=b[5]||((n,...f)=>{let i=!0,o=a=>T(W(a)),s=(a,...y)=>{var S;let j=h(a);try{if($(n,a)){if(!Q(a))throw Error("atom not writable");let D=j.n,p=y[0];H(a,p,h),O(a),D!==j.n&&(l.add(a),(S=g.c)==null||S.call(g,a),B(a));return}else return A(a,...y)}finally{i||(v(),m())}};try{return M(n,o,s,...f)}finally{i=!1}}),O=b[6]||(n=>{var s;var f;let i=h(n),o=e.get(n);if(o&&!x(i.v)){for(let[a,y]of i.d)if(!o.d.has(a)){let S=h(a);P(a).t.add(n),o.d.add(a),y!==S.n&&(l.add(a),(f=g.c)==null||f.call(g,a),B(a))}for(let a of o.d||[])i.d.has(a)||(o.d.delete(a),(s=_(a))==null||s.t.delete(n))}}),P=b[7]||(n=>{var f;let i=h(n),o=e.get(n);if(!o){W(n);for(let s of i.d.keys())P(s).t.add(n);o={l:new Set,d:new Set(i.d.keys()),t:new Set},e.set(n,o),(f=g.m)==null||f.call(g,n),X(n)&&u.add(()=>{let s=!0,a=(...y)=>{try{return A(n,...y)}finally{s||(v(),m())}};try{let y=w(n,a);y&&(o.u=()=>{s=!0;try{y()}finally{s=!1}})}finally{s=!1}})}return o}),_=b[8]||(n=>{var s;var f;let i=h(n),o=e.get(n);if(o&&!o.l.size&&!Array.from(o.t).some(a=>{var y;return(y=e.get(a))==null?void 0:y.d.has(n)})){o.u&&d.add(o.u),o=void 0,e.delete(n),(f=g.u)==null||f.call(g,n);for(let a of i.d.keys())(s=_(a))==null||s.t.delete(n);return}return o}),gt=[t,e,r,l,u,d,g,E,M,c,w,h,m,v,W,B,A,O,P,_],F={get:n=>T(W(n)),set:(n,...f)=>{try{return A(n,...f)}finally{v(),m()}},sub:(n,f)=>{let i=P(n).l;return i.add(f),m(),()=>{i.delete(f),_(n),m()}}};return Object.defineProperty(F,rt,{value:gt}),F},vt=bt,lt=C,St=0;function at(t,e){let r=`atom${++St}`,l={toString(){return r}};return typeof t=="function"?l.read=t:(l.init=t,l.read=kt,l.write=Et),e&&(l.write=e),l}function kt(t){return t(this)}function Et(t,e,r){return e(this,typeof r=="function"?r(t(this)):r)}var it;function V(){return it?it():nt()}var ot;function Mt(){return ot||(ot=V()),ot}var k=Y(yt(),1),ut=(0,k.createContext)(void 0);function q(t){let e=(0,k.useContext)(ut);return(t==null?void 0:t.store)||e||Mt()}function Wt({children:t,store:e}){let r=(0,k.useRef)(void 0);return!e&&!r.current&&(r.current=V()),(0,k.createElement)(ut.Provider,{value:e||r.current},t)}var J=t=>typeof(t==null?void 0:t.then)=="function",K=t=>{t.status||(t.status="pending",t.then(e=>{t.status="fulfilled",t.value=e},e=>{t.status="rejected",t.reason=e}))},jt=k.use||(t=>{if(t.status==="pending")throw t;if(t.status==="fulfilled")return t.value;throw t.status==="rejected"?t.reason:(K(t),t)}),L=new WeakMap,st=(t,e)=>{let r=L.get(t);return r||(r=new Promise((l,u)=>{let d=t,g=c=>w=>{d===c&&l(w)},E=c=>w=>{d===c&&u(w)},M=()=>{try{let c=e();J(c)?(L.set(c,r),d=c,c.then(g(c),E(c)),lt(c,M)):l(c)}catch(c){u(c)}};t.then(g(t),E(t)),lt(t,M)}),L.set(t,r)),r};function ft(t,e){let{delay:r,unstable_promiseStatus:l=!k.use}=e||{},u=q(e),[[d,g,E],M]=(0,k.useReducer)(w=>{let b=u.get(t);return Object.is(w[0],b)&&w[1]===u&&w[2]===t?w:[b,u,t]},void 0,()=>[u.get(t),u,t]),c=d;if((g!==u||E!==t)&&(M(),c=u.get(t)),(0,k.useEffect)(()=>{let w=u.sub(t,()=>{if(l)try{let b=u.get(t);J(b)&&K(st(b,()=>u.get(t)))}catch{}if(typeof r=="number"){setTimeout(M,r);return}M()});return M(),w},[u,t,r,l]),(0,k.useDebugValue)(c),J(c)){let w=st(c,()=>u.get(t));return l&&K(w),jt(w)}return c}function dt(t,e){let r=q(e);return(0,k.useCallback)((...l)=>r.set(t,...l),[r,t])}function At(t,e){return[ft(t,e),dt(t,e)]}function zt(t,e){return wt(t,e)}var ct=zt,Ot=Y(pt(),1);const z=V();async function Pt(t,e){return e(z.get(t))?z.get(t):new Promise(r=>{let l=z.sub(t,()=>{let u=z.get(t);e(u)&&(l(),r(u))})})}function _t(t,e){let r=(0,Ot.c)(5),l=q(),u,d;r[0]!==t||r[1]!==e||r[2]!==l?(u=()=>{let g=l.get(t);l.sub(t,()=>{let E=l.get(t);e(E,g),g=E})},d=[t,e,l],r[0]=t,r[1]=e,r[2]=l,r[3]=u,r[4]=d):(u=r[3],d=r[4]),(0,k.useEffect)(u,d)}var ht=Symbol("sentinel");function Dt(t,e=ct){let r=ht;return at(l=>{let u=l(t);return(r===ht||!e(r,u))&&(r=u),r})}export{ct as a,ft as c,at as d,V as f,Pt as i,dt as l,vt as m,z as n,Wt as o,nt as p,_t as r,At as s,Dt as t,q as u};
